define("app",[],function(){var t,e=function(t){var e,o={};for(e in t)if(t.hasOwnProperty(e))try{o[e]=JSON.parse(t[e])}catch(a){}return o},o=function(t){try{return JSON.parse(t)}catch(e){}return null},a=function(t){try{return JSON.stringify(t)}catch(e){}return""},r={LOBBY:1,CHOOSE_COLOR:2,PLAY:3,CONGRATULATIONS:4};return t=angular.module("app",[]),t.run(["$rootScope",function(t){function n(t){var e,o,a=t.length,r=t[0].length,n=0,s=0,i=[];for(o=0;r>o;o++){for(e=a-1;e>=0;e--)i[n]||(i[n]=[]),i[n][s]=t[e][o],s++;n++,s=0}return i}function s(t){var e,o,a=t.length,r=t[0].length,n=0,s=0,i=[];for(o=r-1;o>=0;o--){for(e=0;a>e;e++)i[n]||(i[n]=[]),i[n][s]=t[e][o],s++;n++,s=0}return i}function i(t){var e,o,a=t.length,r=t[0].length,n=0,s=0,i=[];for(e=a-1;e>=0;e--){for(o=0;r>o;o++)i[n]||(i[n]=[]),i[n][s]=t[e][o],s++;n++,s=0}return i}function l(t){var e,o,a=t.length,r=t[0].length,n=0,s=0,i=[];for(e=0;a>e;e++){for(o=r-1;o>=0;o--)i[n]||(i[n]=[]),i[n][s]=t[e][o],s++;n++,s=0}return i}function u(t,e,o){var a,r,n,s,i=t.userData.layout,l=i.length,u=i[0].length,c=!0,d=!0,p=!1,y=!1;for(a=0,r=l;r>a;a++){for(n=0,s=u;s>n;n++){if(tt[e+a]&&tt[e+a][o+n]||(c=!1),tt[e+a]&&tt[e+a][o+n]&&tt[e+a][o+n].userData.block&&i[a][n]){d=!1;break}e+a!==0&&e+a!==19||o+n!==0&&o+n!==19||!i[a]||!i[a][n]||(y=!0),tt[e+a]&&tt[e+a][o+n]&&i[a]&&i[a][n]&&(tt[e+a-1]&&tt[e+a-1][o+n-1]&&tt[e+a-1][o+n-1].userData.block&&tt[e+a-1][o+n-1].userData.block.userData.color===t.userData.color||tt[e+a+1]&&tt[e+a+1][o+n-1]&&tt[e+a+1][o+n-1].userData.block&&tt[e+a+1][o+n-1].userData.block.userData.color===t.userData.color||tt[e+a-1]&&tt[e+a-1][o+n+1]&&tt[e+a-1][o+n+1].userData.block&&tt[e+a-1][o+n+1].userData.block.userData.color===t.userData.color||tt[e+a+1]&&tt[e+a+1][o+n+1]&&tt[e+a+1][o+n+1].userData.block&&tt[e+a+1][o+n+1].userData.block.userData.color===t.userData.color)&&(y=!0),tt[e+a]&&tt[e+a][o+n]&&i[a]&&i[a][n]&&(tt[e+a-1]&&tt[e+a-1][o+n]&&tt[e+a-1][o+n].userData.block&&tt[e+a-1][o+n].userData.block.userData.color===t.userData.color||tt[e+a+1]&&tt[e+a+1][o+n]&&tt[e+a+1][o+n].userData.block&&tt[e+a+1][o+n].userData.block.userData.color===t.userData.color||tt[e+a]&&tt[e+a][o+n-1]&&tt[e+a][o+n-1].userData.block&&tt[e+a][o+n-1].userData.block.userData.color===t.userData.color||tt[e+a]&&tt[e+a][o+n+1]&&tt[e+a][o+n+1].userData.block&&tt[e+a][o+n+1].userData.block.userData.color===t.userData.color)&&(p=!0)}if(!c||!d||p)break}return c&&d&&!p&&y}function c(t){var e,o,a;for(e=0,o=gt.length;o>e;e++)if(a=gt[e],a.userData.id===t)return a;return!1}function d(t){if("block.mousemove"!==t.name||!ct)try{gapi.hangout.data.sendMessage(a(t)),ct=setTimeout(function(){ct=null},500)}catch(e){}}function p(){ft=$(yt).outerWidth(!0),Et=$(yt).outerHeight(!0),D.aspect=ft/Et,D.updateProjectionMatrix(),B.setSize(ft,Et)}function y(t){dt.focus()}function m(e){var o,a,r,n;e.preventDefault(),N.x=e.clientX/ft*2-1,N.y=2*-(e.clientY/Et)+1,st=null,it=null,z.setFromCamera(N,D),w.remove(et),rt&&nt?z.ray.intersectPlane(M,H)&&(nt.position.copy(H.sub(S)),r=nt.userData.layout.length,n=nt.userData.layout[0].length,st=Math.floor((H.x+Dt*bt/2-r*bt/2+bt/2)/bt),it=Math.floor((H.z+Tt*kt/2-n*kt/2+kt/2)/kt),tt[st]&&tt[st][it]&&t.state.game.currentColor&&nt.userData.color===t.state.game.currentColor&&t.state.colors[t.state.game.currentColor]&&t.state.colors[t.state.game.currentColor].id&&t.me.person.id===t.state.colors[t.state.game.currentColor].id&&(ot=tt[st][it],u(nt,st,it)&&(et=nt.clone(),et.position.copy(ot.position),et.position.x=et.position.x+r*bt/2-bt/2,et.position.z=et.position.z+n*kt/2-kt/2,et.position.y=et.position.y+wt/2,w.add(et))),d({name:"block.mousemove",b:{id:nt.userData.id,p:[nt.position.x,nt.position.y,nt.position.z]}})):(a=z.intersectObjects(gt,!0),a.length>0?(o=a[0],at=o.object.parent?o.object.parent:o.object,at.userData.isPlaced||t.state.colors[at.userData.color]&&t.state.colors[at.userData.color].id&&t.state.colors[at.userData.color].id!==t.me.person.id?yt.style.cursor="auto":yt.style.cursor="move"):(at=null,yt.style.cursor="auto"))}function g(e){var o,a;if(e.preventDefault(),z.setFromCamera(N,D),a=z.intersectObjects(gt,!0),a.length>0){if(o=a[0],I.enabled=!1,rt=o.object,o.object.parent&&(nt=o.object.parent),nt.userData.isPlaced||t.state.colors[nt.userData.color]&&t.state.colors[nt.userData.color].id&&t.state.colors[nt.userData.color].id!==t.me.person.id)return nt=null,void(rt=null);z.ray.intersectPlane(M,H)&&S.copy(H).sub(nt.position)}yt.style.cursor="move"}function h(e){var o,a,r,n,s,i;if(e.preventDefault(),I.enabled=!0,rt&&nt)if(i=nt,void 0!==st&&null!==st&&void 0!==it&&null!==it&&t.state.game.currentColor&&nt.userData.color===t.state.game.currentColor&&t.state.colors[t.state.game.currentColor]&&t.state.colors[t.state.game.currentColor].id&&t.me.person.id===t.state.colors[t.state.game.currentColor].id&&u(nt,st,it)){for(ot=tt[st][it],o=0,a=nt.userData.layout.length;a>o;o++)for(U=0,_=nt.userData.layout[o].length;_>U;U++)nt.userData.layout[o][U]&&(tt[st+o][it+U].userData.block=nt,t.syncBoardSquare(t.state.board[st+o][it+U],tt[st+o][it+U],!1));r=nt.userData.layout.length,n=nt.userData.layout[0].length,F=new TWEEN.Tween(nt.position).to({x:ot.position.x+r*bt/2-bt/2,z:ot.position.z+n*kt/2-kt/2,y:ot.position.y+wt/2},200).easing(TWEEN.Easing.Bounce.Out).onComplete(function(){F=null,t.syncBlock(t.getBlockById(i.userData.id),i,!1),t.droppedBlock=i,t.showConfirmDropModal=!0,t.$apply()}).start(),t.droppebBlockXIndex=st,t.droppebBlockZIndex=it,rt=null,nt=null,w.remove(et)}else nt.position.x>nt.lowerBoundary.x&&nt.position.x<nt.upperBoundary.x&&nt.position.z>nt.lowerBoundary.z&&nt.position.z<nt.upperBoundary.z&&(nt.startPosition.x=nt.position.x,nt.startPosition.z=nt.position.z),s=nt.startPosition,F=new TWEEN.Tween(nt.position).to({x:s.x,z:s.z,y:s.y},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){F=null,t.syncBlock(t.getBlockById(i.userData.id),i,!1)}).start(),w.remove(et);at&&(rt=null,nt=null)}function f(e){var o,a,r;e.preventDefault(),nt&&!J&&(r=nt,37===e.keyCode||65===e.keyCode?(r.isRotated=!r.isRotated,r.userData.layout=n(r.userData.layout),a=r.rotation.y,J=new TWEEN.Tween(r.rotation).to({y:a+Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(r.userData.id),r,!1),J=null,r=null}).start(),d({name:"block.keydown.left",b:{id:r.userData.id,r:a+Math.PI/2}})):38===e.keyCode||87===e.keyCode?(r.isRotated?r.userData.layout=l(r.userData.layout):r.userData.layout=i(r.userData.layout),o=r.rotation.z,J=new TWEEN.Tween(r.rotation).to({z:o+Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(r.userData.id),r,!1),J=null,r=null}).start(),d({name:"block.keydown.up",b:{id:r.userData.id,r:o+Math.PI}})):39===e.keyCode||68===e.keyCode?(r.isRotated=!r.isRotated,r.userData.layout=s(r.userData.layout),a=r.rotation.y,J=new TWEEN.Tween(r.rotation).to({y:a-Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(r.userData.id),r,!1),J=null,r=null}).start(),d({name:"block.keydown.right",b:{id:r.userData.id,r:a-Math.PI/2}})):(40===e.keyCode||83===e.keyCode)&&(r.isRotated?r.userData.layout=l(r.userData.layout):r.userData.layout=i(r.userData.layout),o=r.rotation.z,J=new TWEEN.Tween(r.rotation).to({z:o-Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(r.userData.id),r,!1),J=null,r=null}).start(),d({name:"block.keydown.down",b:{id:r.userData.id,r:o-Math.PI}})))}function E(){I.update(),B.render(w,D)}function b(e){requestAnimationFrame(b),TWEEN.update(e),t&&t.state&&t.state.game&&t.state.game.currentStage&&(t.state.game.currentStage===r.PLAY||t.state.game.currentStage===r.CONGRATULATIONS)&&E()}var k={game:!1,players:!1,host:!1,colors:!1,board:!1,blocksBlue:!1,blocksGreen:!1,blocksRed:!1,blocksYellow:!1};t.me=gapi.hangout.getLocalParticipant(),t.state=e(gapi.hangout.data.getState())||{},t.metadata=gapi.hangout.data.getStateMetadata()||{},t.state.game||(t.state.game={}),t.state.game.currentStage||(t.state.game.currentStage=r.LOBBY),t.state.players||(t.state.players=[]),gapi.hangout.data.onStateChanged.add(function(o){var r,n,s,i,l=function(t){return function(){k[t]&&(k[t]=!1)}};i=e(o.state),"{}"===a(i)&&(t.state={});for(r in i)n=i[r],s=o.metadata[r],s.lastWriter!==t.me.id?"game"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n):"players"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n):"host"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n):"colors"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n):"board"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n,t.syncBoardWithState()):"blocksBlue"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n,t.syncBlocksWithState(t.state[r])):"blocksGreen"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n,t.syncBlocksWithState(t.state[r])):"blocksRed"===r&&s?t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n,t.syncBlocksWithState(t.state[r])):"blocksYellow"===r&&s&&(t.metadata[r]&&t.metadata[r].timestamp===s.timestamp||(k[r]=!0,setTimeout(l(r),0),t.metadata[r]=s,t.state[r]=n,t.syncBlocksWithState(t.state[r]))):t.metadata[r]=s;window.state=i,t.$apply()}),t.$watch("state.game.currentColor",function(e,o,a){setTimeout(function(){t.state&&t.state.game&&t.state.game.currentColor&&t.state.colors[t.state.game.currentColor]&&t.state.colors[t.state.game.currentColor].id&&(t.me.person.id===t.state.colors[t.state.game.currentColor].id&&(t.canTakeTurn(t.state.game.currentColor)?gapi.hangout.layout.displayNotice("It is your turn!"):(gapi.hangout.layout.displayNotice("Sorry, you don't have any more moves left."),t.nextColor())),t.me.person.id!==t.state.host.id||t.canAnyoneTakeTurn()||(t.state.game.currentStage=r.CONGRATULATIONS))},100)}),t.$watch("state.game",function(e,o,r){console.log("----------$watch--state.game----------"),k.game?(console.log("supressSubmitDelta"),console.log(JSON.stringify(t.state.game)),k.game=!1):(console.log("submitDelta"),console.log(JSON.stringify(t.state.game)),t.state&&t.state.game&&gapi.hangout.data.submitDelta({game:a(t.state.game)}))},!0),t.$watch("state.players",function(e,o,r){k.players?k.players=!1:t.state&&t.state.players&&gapi.hangout.data.submitDelta({players:a(t.state.players)})},!0),t.$watch("state.host",function(e,o,r){k.host?k.host=!1:t.state&&t.state.host&&gapi.hangout.data.submitDelta({host:a(t.state.host)})},!0),t.$watch("state.colors",function(e,o,r){k.colors?k.colors=!1:t.state&&t.state.colors&&gapi.hangout.data.submitDelta({colors:a(t.state.colors)})},!0),t.$watch("state.board",function(e,o,r){k.board?k.board=!1:t.state&&t.state.board&&gapi.hangout.data.submitDelta({board:a(t.state.board)})},!0),t.$watch("state.blocksBlue",function(e,o,r){k.blocksBlue?k.blocksBlue=!1:t.state&&t.state.blocksBlue&&gapi.hangout.data.submitDelta({blocksBlue:a(t.state.blocksBlue)})},!0),t.$watch("state.blocksGreen",function(e,o,r){k.blocksGreen?k.blocksGreen=!1:t.state&&t.state.blocksGreen&&gapi.hangout.data.submitDelta({blocksGreen:a(t.state.blocksGreen)})},!0),t.$watch("state.blocksRed",function(e,o,r){k.blocksRed?k.blocksRed=!1:t.state&&t.state.blocksRed&&gapi.hangout.data.submitDelta({blocksRed:a(t.state.blocksRed)})},!0),t.$watch("state.blocksYellow",function(e,o,r){k.blocksYellow?k.blocksYellow=!1:t.state&&t.state.blocksYellow&&gapi.hangout.data.submitDelta({blocksYellow:a(t.state.blocksYellow)})},!0),t.computers=0,t.addPlayer=function(e){var o,a;if(a=t.state.players,e.player&&e.player.id&&a.length<4&&!t.findPlayerById(e.player.id)){if(o={},!e.player.type)throw new Error("config.player.type was not provided");if(o.type=e.player.type,"human"===o.type){if(!e.player.id)throw new Error("config.player.id was not provided");if(o.id=e.player.id,!e.player.name)throw new Error("config.player.name was not provided");o.name=e.player.name,e.player.image&&(o.image=e.player.image)}else{if("computer"!==o.type)throw new Error('config.player.type is not a supported type (either "human", or "computer")');o.id="computer-"+Math.floor(1e4*Math.random()),o.name="Computer "+t.computers+1}return a.push(o),t.state.host||"human"!==o.type||(t.state.host=o),!0}return!1},t.findPlayerById=function(e){var o,a,r,n;if(n=t.state.players,!n)return null;for(o=0,a=n.length;a>o;o++)if(r=n[o],r.id===e)return r;return null},t.removePlayer=function(e){var o,a,r;if(r=t.state.players,!e.player)return!1;for(o=r.length-1;o>=0;o--)if(r[o]===e.player)return a=r.splice(o,1),!0;return!1},t.showLeaveModal=!1,t.leave=function(){var e,o,a,r,n=!1;if(r=t.state.players,t.state.host&&t.state.host.id===t.me.person.id&&(n=!0),n)for(t.state.host=null,e=0,o=r.length;o>e;e++)if(a=r[e],t.me.person.id!==a.id&&"human"===a.type){t.state.host=a;break}t.removePlayer({player:t.findPlayerById(t.me.person.id)})},gapi.hangout.onParticipantsDisabled.add(function(e){var o,a,r,n,s,i,l=!1,u=!1;if(i=t.state.players,t.state.host)for(o=0,a=e.disabledParticipants.length;a>o;o++)if(n=e.disabledParticipants[o],n.person.id===t.state.host.id){l=!0;break}if(l)for(o=0,a=i.length;a>o;o++)if(s=i[o],t.me.person.id===s.id&&"human"===s.type&&t.state.host.id!==s.id){t.state.host=s;break}if(t.state.host&&t.state.host.id===t.me.person.id&&(u=!0),u)for(o=0,a=e.disabledParticipants.length;a>o;o++)for(n=e.disabledParticipants[o],r=i.length-1;r>=0;r--)if(s=i[r],n.person.id===s.id){t.removePlayer({player:s});break}t.$apply()}),t.join=function(){t.addPlayer({player:{type:"human",id:t.me.person.id,name:t.me.person.displayName,image:t.me.person.image.url}})},t.begin=function(){t.state.game.currentStage=r.CHOOSE_COLOR},t.isPlayer=function(){var e,o,a,r;for(o=t.state.players,a=0,r=o.length;r>a;a++)if(e=o[a],t.me.person.id===e.id)return!0;return!1},t.state.colors||(t.state.colors={blue:{i:"b",color:"blue",label:"Blue",hex:255},green:{i:"g",color:"green",label:"Green",hex:65280},yellow:{i:"y",color:"yellow",label:"Yellow",hex:16776960},red:{i:"r",color:"red",label:"Red",hex:16711680}}),t.chooseColor=function(e){var o,a,r,n,s,i,l,u;if(r=t.state.colors,o=t.state.players,t.myRemainingColors()&&!r[e].id&&(a=r[e],a.type=1,a.id=t.me.person.id),3===o.length&&3===t.displayChoosenColors().length){for(e in r)if(a=r[e],!a.id)break;for(i=[],l=0,u=o.length;u>l;l++){s=o[l];do n=Math.floor(3*Math.random());while(i[n]);i[n]=s.id}a.type=2,a.id=i[0],a.order=i,a.current=0}},t.myRemainingColors=function(){var e,o,a,r,n=0;if(a=t.state.colors,r=t.state.players,t.isPlayer()){2===r.length?n=2:(3===r.length||4===r.length)&&(n=1);for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&n--}return n},t.getMyColors=function(){var e,o,a,r=[];a=t.state.colors;for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&r.push(e);return r},t.getSharedColor=function(){var e,o,a,r;if(r=t.state.players,3===r.length){a=t.state.colors;for(o in a)if(e=a[o],2===e.type)return e}return null},t.displayColors=function(){var e="",o=t.getMyColors(!0);return o[0]&&o[0].label&&(e=o[0].label,o[1]&&o[1].label&&(e+=" and "+o[1].label)),e},t.displayChoosenColors=function(){var e,o,a,r=[];o=t.state.colors;for(e in o)a=o[e],a.id&&r.push(a.color);return r},t.displaySharedColor=function(){var e=t.getSharedColor();return e&&e.label?e.label:!1},t.start=function(){t.state.game.currentColor=Object.keys(t.state.colors)[Math.floor(4*Math.random())],t.state.game.currentStage=r.PLAY},t.state.board?setTimeout(function(){t.syncBoardWithState()},100):t.state.board=[],t.state.blocksBlue?setTimeout(function(){t.syncBlocksWithState(t.state.blocksBlue)},100):t.state.blocksBlue=[],t.state.blocksGreen?setTimeout(function(){t.syncBlocksWithState(t.state.blocksGreen)},100):t.state.blocksGreen=[],t.state.blocksRed?setTimeout(function(){t.syncBlocksWithState(t.state.blocksRed)},100):t.state.blocksRed=[],t.state.blocksYellow?setTimeout(function(){t.syncBlocksWithState(t.state.blocksYellow)},100):t.state.blocksYellow=[];var w,D,T,P,R,B,C,x,v,z,M,S,H,N,I,W,O,V,q,L,A,G,Y,j,J,F,X,Z,U,_,K,Q,tt,et,ot,at,rt,nt,st,it,lt,ut,ct,dt=window,pt=document,yt=pt.getElementById("canvas-container"),mt=new THREE.JSONLoader,gt=[],ht=[{id:21,startPosition:new THREE.Vector3(2.2,.1,1.5),squareCount:5,layout:[[1,1,1,1,1]]},{id:20,startPosition:new THREE.Vector3(2.6,.1,1.5),squareCount:5,layout:[[1,1,1,1],[1,0,0,0]]},{id:19,startPosition:new THREE.Vector3(3.1,.1,1.5),squareCount:5,layout:[[1,1,1,1],[0,1,0,0]]},{id:18,startPosition:new THREE.Vector3(3.6,.1,1.5),squareCount:5,layout:[[0,1,1,1],[1,1,0,0]]},{id:17,startPosition:new THREE.Vector3(2.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,0],[1,0,0]]},{id:16,startPosition:new THREE.Vector3(3.1,.1,.6),squareCount:5,layout:[[0,1,1],[1,1,0],[1,0,0]]},{id:15,startPosition:new THREE.Vector3(3.8,.1,.6),squareCount:5,layout:[[0,1,1],[0,1,0],[1,1,0]]},{id:14,startPosition:new THREE.Vector3(2.4,.1,-.1),squareCount:5,layout:[[1,1,1],[0,1,0],[0,1,0]]},{id:13,startPosition:new THREE.Vector3(3.1,.1,-.1),squareCount:5,layout:[[0,1,1],[1,1,0],[0,1,0]]},{id:12,startPosition:new THREE.Vector3(3.8,.1,-.1),squareCount:5,layout:[[0,1,0],[1,1,1],[0,1,0]]},{id:11,startPosition:new THREE.Vector3(4.1,.1,1.5),squareCount:5,layout:[[1,1,1],[1,1,0]]},{id:10,startPosition:new THREE.Vector3(4.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,1]]},{id:9,startPosition:new THREE.Vector3(2.2,.1,-.9),squareCount:4,layout:[[1,1,1,1]]},{id:8,startPosition:new THREE.Vector3(2.6,.1,-.9),squareCount:4,layout:[[1,1,1],[1,0,0]]},{id:7,startPosition:new THREE.Vector3(3.1,.1,-.9),squareCount:4,layout:[[1,1,1],[0,1,0]]},{id:6,startPosition:new THREE.Vector3(3.6,.1,-.9),squareCount:4,layout:[[1,1,0],[0,1,1]]},{id:5,startPosition:new THREE.Vector3(4.1,.1,-.9),squareCount:4,layout:[[1,1],[1,1]]},{id:4,startPosition:new THREE.Vector3(2.2,.1,-1.7),squareCount:3,layout:[[1,1,1]]},{id:3,startPosition:new THREE.Vector3(2.6,.1,-1.7),squareCount:3,layout:[[1,1],[1,0]]},{id:2,startPosition:new THREE.Vector3(3,.1,-1.7),squareCount:2,layout:[[1,1]]},{id:1,startPosition:new THREE.Vector3(3.3,.1,-1.7),squareCount:1,layout:[[1]]}],ft=$(yt).outerWidth(!0),Et=$(yt).outerHeight(!0),bt=.2,kt=.2,wt=.04,Dt=20,Tt=20,Pt=.6;for(gapi.hangout.data.onMessageReceived.add(function(e){var a,r;return e.senderId===t.me.id?void console.log("from me"):(r=o(e.message),void("block.mousemove"===r.name?(a=c(r.b.id),F=new TWEEN.Tween(a.position).to({x:r.b.p[0],y:r.b.p[1],z:r.b.p[2]},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){F=null}).start()):"block.keydown.left"===r.name?(a=c(r.b.id),J=new TWEEN.Tween(a.rotation).to({y:r.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start()):"block.keydown.up"===r.name?(a=c(r.b.id),J=new TWEEN.Tween(a.rotation).to({z:r.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start()):"block.keydown.right"===r.name?(a=c(r.b.id),J=new TWEEN.Tween(a.rotation).to({y:r.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start()):"block.keydown.down"===r.name&&(a=c(r.b.id),J=new TWEEN.Tween(a.rotation).to({z:r.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start())))}),t.getBlockById=function(e){var o,a,r,n;for(n=t.state.blocksBlue,o=0,a=n.length;a>o;o++)if(r=n[o],r.id===e)return r;for(n=t.state.blocksGreen,o=0,a=n.length;a>o;o++)if(r=n[o],r.id===e)return r;for(n=t.state.blocksRed,o=0,a=n.length;a>o;o++)if(r=n[o],r.id===e)return r;for(n=t.state.blocksYellow,o=0,a=n.length;a>o;o++)if(r=n[o],r.id===e)return r;return null},t.syncBoardWithState=function(){var e,o,a,r,n,s;for(s=t.state.board,e=0,o=s.length;o>e;e++)for(a=0,r=s[e].length;r>a;a++)n=s[e][a],t.syncBoardSquare(tt[e][a],n,!0)},t.syncBoardSquare=function(t,e,o){o?e.b?t.userData.block=c(e.b):t.userData.block=null:e.userData.block?t.b=e.userData.block.userData.id:t.b=null},t.syncBlocksWithState=function(e){var o,a,r;if(e)for(o=0,a=e.length;a>o;o++)r=e[o],t.syncBlock(c(r.id),r,!0)},t.syncBlock=function(e,o,a){a?(e.userData.layout=o.l,e.position.x=o.p[0],e.position.y=o.p[1],e.position.z=o.p[2],e.rotation.x=o.r[0],e.rotation.y=o.r[1],e.rotation.z=o.r[2],e.startPosition.x=o.sp[0],e.startPosition.y=o.sp[1],e.startPosition.z=o.sp[2],e.startRotation.x=o.sr[0],e.startRotation.y=o.sr[1],e.startRotation.z=o.sr[2],e.isRotated=o.ir,e.userData.isPlaced=o.ip):(e.l=o.userData.layout,e.p[0]=Math.round(1e3*o.position.x)/1e3,e.p[1]=Math.round(1e3*o.position.y)/1e3,e.p[2]=Math.round(1e3*o.position.z)/1e3,e.r[0]=Math.round(1e3*o.rotation.x)/1e3,e.r[1]=Math.round(1e3*o.rotation.y)/1e3,e.r[2]=Math.round(1e3*o.rotation.z)/1e3,e.sp[0]=Math.round(1e3*o.startPosition.x)/1e3,e.sp[1]=Math.round(1e3*o.startPosition.y)/1e3,e.sp[2]=Math.round(1e3*o.startPosition.z)/1e3,e.sr[0]=Math.round(1e3*o.startRotation.x)/1e3,e.sr[1]=Math.round(1e3*o.startRotation.y)/1e3,e.sr[2]=Math.round(1e3*o.startRotation.z)/1e3,e.ir=o.isRotated,e.ip=o.userData.isPlaced,t.$apply())},B=new THREE.WebGLRenderer,B.setSize(ft,Et),B.setClearColor(16777215),B.shadowMap.enabled=!0,w=new THREE.Scene,D=new THREE.PerspectiveCamera(45,ft/Et,.1,1e3),D.position.x=6,D.position.y=6,D.position.z=6,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0)),T=pt.getElementById("view-1"),P=pt.getElementById("view-2"),R=pt.getElementById("view-3"),T.addEventListener("click",function(t){D.position.x=0,D.position.y=10,D.position.z=0,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),P.addEventListener("click",function(t){D.position.x=0,D.position.y=6,D.position.z=9,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),R.addEventListener("click",function(t){D.position.x=6,D.position.y=6,D.position.z=6,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),dt.addEventListener("resize",p,!1),I=new THREE.TrackballControls(D),I.rotateSpeed=1,I.zoomSpeed=1.2,I.panSpeed=.3,I.noZoom=!1,I.noPan=!1,I.noRotate=!1,I.staticMoving=!1,I.dynamicDampingFactor=.3,C=[],x=0,C[x]=new THREE.DirectionalLight(16777215,.25),C[x].position.x=-50,C[x].position.y=50,C[x].position.z=-50,C[x].castShadow=!0,w.add(C[x]),x=1,C[x]=new THREE.DirectionalLight(16777215,.25),C[x].position.x=50,C[x].position.y=50,C[x].position.z=50,C[x].castShadow=!0,w.add(C[x]),x=2,C[x]=new THREE.DirectionalLight(16777215,.25),C[x].position.x=-50,C[x].position.y=50,C[x].position.z=50,C[x].castShadow=!0,w.add(C[x]),x=3,C[x]=new THREE.DirectionalLight(16777215,.25),C[x].position.x=50,C[x].position.y=50,C[x].position.z=-50,C[x].castShadow=!0,w.add(C[x]),x=4,C[x]=new THREE.DirectionalLight(16777215,.25),C[x].position.x=0,C[x].position.y=-50,C[x].position.z=0,C[x].castShadow=!0,w.add(C[x]),v=new THREE.AmbientLight(5263440),w.add(v),tt=[],O=mt.parse({metadata:{},scale:1,materials:[],vertices:[-.1,0,.1,-.1,.01,.1,-.1,0,-.1,-.1,.01,-.1,.1,0,.1,.1,.01,.1,.1,0,-.1,.1,.01,-.1,.0975,.01,.0975,-.0975,.01,.0975,.0975,.01,-.0975,-.0975,.01,-.0975,.095,0,.095,-.095,0,.095,.095,0,-.095,-.095,0,-.095],morphTargets:[],morphColors:[],normals:[-1,0,0,0,0,-1,1,0,0,0,0,1,0,-1,0,0,1,0,-.9701,.2425,0,0,.2425,.9701,0,.2425,-.9701,.9701,.2425,0],colors:[],uvs:[[]],faces:[35,1,3,2,0,0,0,0,0,0,35,3,7,6,2,0,1,1,1,1,35,7,5,4,6,0,2,2,2,2,35,5,1,0,4,0,3,3,3,3,35,0,2,6,4,0,4,4,4,4,35,9,11,3,1,0,5,5,5,5,35,5,8,9,1,0,5,5,5,5,35,5,7,10,8,0,5,5,5,5,35,8,10,14,12,0,6,6,6,6,35,10,7,3,11,0,5,5,5,5,35,12,14,15,13,0,5,5,5,5,35,10,11,15,14,0,7,7,7,7,35,9,8,12,13,0,8,8,8,8,35,11,9,13,15,0,9,9,9,9]}).geometry,X=0,Z=Dt;Z>X;X++)for(tt[X]=[],U=0,_=Tt;_>U;U++)V=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),W=new THREE.Mesh(O,V),W.position.x=X*bt-Dt*bt/2+bt/2,W.position.z=U*kt-Tt*kt/2+kt/2,W.castShadow=!0,W.receiveShadow=!1,W.userData.xIndex=X,W.userData.zIndex=U,W.userData.block=null,W.userData.square=null,tt[X][U]=W,w.add(W),t.state.board[X]||(t.state.board[X]=[]),t.state.board[X][U]||(t.state.board[X][U]={b:null});q=new THREE.BoxGeometry(Dt*bt,Pt,Tt*kt),L=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),A=new THREE.Mesh(q,L),A.position.y=-(Pt/2)-1e-4,w.add(A);var Rt,Bt,Ct,xt,vt,zt,Mt;for(lt in t.state.colors)for(ut=t.state.colors[lt],K=0,Q=ht.length;Q>K;K++){for(Bt=ht[K],Rt=new THREE.Group,Rt.userData.id=ut.i+"-"+Bt.id,Rt.userData.layout=JSON.parse(JSON.stringify(Bt.layout)),Rt.userData.squareCount=Bt.squareCount,Rt.userData.colorAgent=ut,Rt.userData.color=lt,Rt.userData.isPlaced=!1,Ct=Rt.userData.layout.length,xt=Rt.userData.layout[0].length,X=0,Z=Bt.layout.length;Z>X;X++)for(vt=Bt.layout[X],U=0,_=vt.length;_>U;U++)zt=vt[U],zt&&(Y=mt.parse({metadata:{},scale:1,materials:[],vertices:[.1,.01,-.1,-.1,.01,.1,.1,.01,.1,-.1,.01,-.1,-.1,.03,.1,.1,.03,.1,-.1,.03,-.1,.1,.03,-.1,-.0925,.03,.0925,-.0925,.03,-.0925,.0925,.03,.0925,.0925,.03,-.0925,-.0925,.04,.0925,-.0925,.04,-.0925,.0925,.04,.0925,.0925,.04,-.0925,-.0925,.01,.0925,.0925,.01,.0925,-.0925,.01,-.0925,.0925,.01,-.0925,-.0925,0,.0925,.0925,0,.0925,-.0925,0,-.0925,.0925,0,-.0925,-.065,.04,.065,-.065,.04,-.065,.065,.04,.065,.065,.04,-.065,-.065,.03,.065,-.065,.03,-.065,.065,.03,.065,.065,.03,-.065,-.065,0,.065,.065,0,.065,-.065,0,-.065,.065,0,-.065,-.065,.01,.065,.065,.01,.065,-.065,.01,-.065,.065,.01,-.065],morphTargets:[],morphColors:[],normals:[0,0,-1,0,0,1,1,0,0,-1,0,0,0,1,0,0,-1,0],colors:[],uvs:[[]],faces:[35,0,3,6,7,0,0,0,0,0,35,1,2,5,4,0,1,1,1,1,35,2,0,7,5,0,2,2,2,2,35,3,1,4,6,0,3,3,3,3,35,9,11,7,6,0,4,4,4,4,35,4,8,9,6,0,4,4,4,4,35,4,5,10,8,0,4,4,4,4,35,11,9,13,15,0,0,0,0,0,35,10,5,7,11,0,4,4,4,4,35,10,11,15,14,0,2,2,2,2,35,9,8,12,13,0,3,3,3,3,35,8,10,14,12,0,1,1,1,1,35,17,19,0,2,0,5,5,5,5,35,1,16,17,2,0,5,5,5,5,35,1,3,18,16,0,5,5,5,5,35,17,16,20,21,0,1,1,1,1,35,18,3,0,19,0,5,5,5,5,35,16,18,22,20,0,3,3,3,3,35,19,17,21,23,0,2,2,2,2,35,18,19,23,22,0,0,0,0,0,35,25,27,15,13,0,4,4,4,4,35,12,24,25,13,0,4,4,4,4,35,12,14,26,24,0,4,4,4,4,35,24,26,30,28,0,0,0,0,0,35,26,14,15,27,0,4,4,4,4,35,28,30,31,29,0,4,4,4,4,35,26,27,31,30,0,3,3,3,3,35,27,25,29,31,0,1,1,1,1,35,25,24,28,29,0,2,2,2,2,35,33,35,23,21,0,5,5,5,5,35,20,32,33,21,0,5,5,5,5,35,20,22,34,32,0,5,5,5,5,35,33,32,36,37,0,0,0,0,0,35,34,22,23,35,0,5,5,5,5,35,36,38,39,37,0,5,5,5,5,35,32,34,38,36,0,2,2,2,2,35,34,35,39,38,0,1,1,1,1,35,35,33,37,39,0,3,3,3,3]}).geometry,j=new THREE.MeshPhongMaterial({color:Rt.userData.colorAgent.hex,transparent:!0,opacity:.7,shininess:85,side:THREE.DoubleSide}),G=new THREE.Mesh(Y,j),G.position.x=X*bt-Ct*bt/2+bt/2,G.position.z=U*kt-xt*kt/2+kt/2,G.position.y=-wt/2,G.userData.xIndex=X,G.userData.zIndex=U,Rt.add(G));Rt.startPosition=new THREE.Vector3,Rt.startRotation=new THREE.Vector3,Rt.upperBoundary=new THREE.Vector3,Rt.lowerBoundary=new THREE.Vector3,Rt.isRotated=!1,"blue"===lt?(Rt.startPosition.x=Bt.startPosition.x,Rt.startPosition.y=Bt.startPosition.y,Rt.startPosition.z=Bt.startPosition.z,Rt.upperBoundary.x=8,Rt.lowerBoundary.x=2.2,Rt.upperBoundary.z=2.4,Rt.lowerBoundary.z=-2.4,Rt.startRotation.y=0):"green"===lt?(Rt.startPosition.x=-Bt.startPosition.x,Rt.startPosition.y=Bt.startPosition.y,Rt.startPosition.z=-Bt.startPosition.z,Rt.upperBoundary.x=-2.2,Rt.lowerBoundary.x=-8,Rt.upperBoundary.z=2.4,Rt.lowerBoundary.z=-2.4,Rt.startRotation.y=Math.PI,Rt.userData.layout=n(n(Rt.userData.layout))):"red"===lt?(Rt.startPosition.x=-Bt.startPosition.z,Rt.startPosition.y=Bt.startPosition.y,Rt.startPosition.z=Bt.startPosition.x,Rt.upperBoundary.x=2.4,Rt.lowerBoundary.x=-2.4,Rt.upperBoundary.z=8,Rt.lowerBoundary.z=2.2,Rt.startRotation.y=Math.PI+Math.PI/2,Rt.userData.layout=s(Rt.userData.layout),Rt.isRotated=!0):"yellow"===lt&&(Rt.startPosition.x=Bt.startPosition.z,Rt.startPosition.y=Bt.startPosition.y,Rt.startPosition.z=-Bt.startPosition.x,Rt.upperBoundary.x=2.4,Rt.lowerBoundary.x=-2.4,Rt.upperBoundary.z=-2.2,Rt.lowerBoundary.z=-8,Rt.startRotation.y=Math.PI/2,Rt.userData.layout=n(Rt.userData.layout),Rt.isRotated=!0),Rt.position.x=Rt.startPosition.x,Rt.position.y=Rt.startPosition.y,Rt.position.z=Rt.startPosition.z,Rt.rotation.y=Rt.startRotation.y,Rt.castShadow=!0,Rt.receiveShadow=!1,gt.push(Rt),w.add(Rt),window.blocks=gt,t.getBlockById(Rt.userData.id)||("blue"===lt?Mt=t.state.blocksBlue:"green"===lt?Mt=t.state.blocksGreen:"red"===lt?Mt=t.state.blocksRed:"yellow"===lt&&(Mt=t.state.blocksYellow),Mt.push({id:Rt.userData.id,l:Rt.userData.layout,sp:[Math.round(1e3*Rt.startPosition.x)/1e3,Math.round(1e3*Rt.startPosition.y)/1e3,Math.round(1e3*Rt.startPosition.z)/1e3],sr:[Math.round(1e3*Rt.startRotation.x)/1e3,Math.round(1e3*Rt.startRotation.y)/1e3,Math.round(1e3*Rt.startRotation.z)/1e3],p:[Math.round(1e3*Rt.position.x)/1e3,Math.round(1e3*Rt.position.y)/1e3,Math.round(1e3*Rt.position.z)/1e3],r:[Math.round(1e3*Rt.rotation.x)/1e3,Math.round(1e3*Rt.rotation.y)/1e3,Math.round(1e3*Rt.rotation.z)/1e3],ir:Rt.isRotated,ip:!1}))}z=new THREE.Raycaster,N=new THREE.Vector2,M=new THREE.Plane(new THREE.Vector3(0,1,0)),S=new THREE.Vector3,H=new THREE.Vector3,B.domElement.addEventListener("mouseenter",y,!1),B.domElement.addEventListener("mousemove",m,!1),B.domElement.addEventListener("mousedown",g,!1),B.domElement.addEventListener("mouseup",h,!1),document.addEventListener("keydown",f,!1),t.showConfirmDropModal=!1,t.droppedBlock=null,t.confirmDrop=function(){var e;e=t.droppedBlock,e.userData.isPlaced=!0,t.nextColor(),t.droppedBlock=null},t.cancelDrop=function(){var e,o,a,r,n,s,i,l;for(s=t.droppedBlock,i=t.droppebBlockXIndex,l=t.droppebBlockZIndex,e=0,o=s.userData.layout.length;o>e;e++)for(a=0,r=s.userData.layout[e].length;r>a;a++)s.userData.layout[e][a]&&(tt[i+e][l+a].userData.block=null,t.syncBoardSquare(t.state.board[i+e][l+a],tt[i+e][l+a],!1));n=s.startPosition,F=new TWEEN.Tween(s.position).to({x:n.x,y:n.y,z:n.z},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){F=null,t.syncBlock(t.getBlockById(s.userData.id),s,!1),t.droppedBlock=null,t.droppebBlockXIndex=null,t.droppebBlockZIndex=null}).start()},t.nextColor=function(){var e,o;e=t.state.game.currentColor,"blue"===e?t.state.game.currentColor="yellow":"yellow"===e?t.state.game.currentColor="red":"red"===e?t.state.game.currentColor="green":"green"===e&&(t.state.game.currentColor="blue"),o=t.state.colors[e],2===o.type&&(o.current===o.length-1?o.current=0:o.order++,o.id=o.order[o.current])},t.canTakeTurn=function(t){var e,r,s,i,l,c,d,p,y,m,g=!1;for(e=0,r=gt.length;r>e;e++)if(y=gt[e],y.userData.color===t&&!y.userData.isPlaced){for(m={userData:{layout:o(a(y.userData.layout)),color:y.userData.color}},d=0,p=4;p>d;d++){for(m.userData.layout=n(m.userData.layout),s=0,i=Dt;i>s;s++){for(l=0,c=Tt;c>l&&!(g=g||u(m,s,l));l++);if(g)break}if(g)break}if(g)break;for(m.userData.layout=n(m.userData.layout),d=0,p=4;p>d;d++){for(m.userData.layout=n(m.userData.layout),s=0,i=Dt;i>s;s++){for(l=0,c=Tt;c>l&&!(g=g||u(m,s,l));l++);if(g)break}if(g)break}if(g)break}return g},t.canAnyoneTakeTurn=function(){var e,o=!1;for(e in t.state.colors)if(o=o||t.canTakeTurn(e))break;return o},yt.appendChild(B.domElement),p(),b()}]),t}),define("events",[],function(){var t={},e={};return{on:function(o,a,r){if(e[o]){if(!r)return;try{a(e[o])}catch(n){console.error(n)}}t[o]||(t[o]=[]),t[o].push(a)},off:function(e,o){var a;if(t[e]&&t[e].length)for(a=t[e].length-1;a>=0;a--)t[e][a]===o&&t[e][a].splice(a,1)},trigger:function(o,a){var r,n,s;if(e[o]=a,t[o]&&t[o].length)for(r=0,n=t[o].length;n>r;r++)if(s=t[o][r])try{s(a)}catch(i){console.error(i)}return!0}}}),require(["app","events"],function(t,e){var o=new Promise(function(t,e){gapi.hangout.onApiReady.add(function(e){e.isApiReady&&t()})});document.body.style.opacity=0,o.then(function(){angular.bootstrap(document,["app"]),new TWEEN.Tween(document.body.style).to({opacity:1},1e3).easing(TWEEN.Easing.Exponential.Out).start()})}),define("main",function(){});