define("app",[],function(){var t,e=function(t){var e,o={};for(e in t)if(t.hasOwnProperty(e))try{o[e]=JSON.parse(t[e])}catch(a){}return o},o=function(t){try{return JSON.parse(t)}catch(e){}return null},a=function(t){try{return JSON.stringify(t)}catch(e){}return""},n={LOBBY:1,CHOOSE_COLOR:2,PLAY:3,DETERMINE_WINNER:4,CONGRATULATIONS:5};return t=angular.module("app",[]),t.run(["$rootScope",function(t){function r(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(o=0;n>o;o++){for(e=a-1;e>=0;e--)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function s(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(o=n-1;o>=0;o--){for(e=0;a>e;e++)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function i(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(e=a-1;e>=0;e--){for(o=0;n>o;o++)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function l(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(e=0;a>e;e++){for(o=n-1;o>=0;o--)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function u(t,e,o){var a,n,r,s,i=t.userData.layout,l=i.length,u=i[0].length,d=!0,c=!0,p=!1,y=!1;for(a=0,n=l;n>a;a++){for(r=0,s=u;s>r;r++){if(X[e+a]&&X[e+a][o+r]||(d=!1),X[e+a]&&X[e+a][o+r]&&X[e+a][o+r].userData.block&&i[a][r]){c=!1;break}e+a!==0&&e+a!==19||o+r!==0&&o+r!==19||!i[a]||!i[a][r]||(y=!0),X[e+a]&&X[e+a][o+r]&&i[a]&&i[a][r]&&(X[e+a-1]&&X[e+a-1][o+r-1]&&X[e+a-1][o+r-1].userData.block&&X[e+a-1][o+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||X[e+a+1]&&X[e+a+1][o+r-1]&&X[e+a+1][o+r-1].userData.block&&X[e+a+1][o+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||X[e+a-1]&&X[e+a-1][o+r+1]&&X[e+a-1][o+r+1].userData.block&&X[e+a-1][o+r+1].userData.block.userData.colorAgent===t.userData.colorAgent||X[e+a+1]&&X[e+a+1][o+r+1]&&X[e+a+1][o+r+1].userData.block&&X[e+a+1][o+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(y=!0),X[e+a]&&X[e+a][o+r]&&i[a]&&i[a][r]&&(X[e+a-1]&&X[e+a-1][o+r]&&X[e+a-1][o+r].userData.block&&X[e+a-1][o+r].userData.block.userData.colorAgent===t.userData.colorAgent||X[e+a+1]&&X[e+a+1][o+r]&&X[e+a+1][o+r].userData.block&&X[e+a+1][o+r].userData.block.userData.colorAgent===t.userData.colorAgent||X[e+a]&&X[e+a][o+r-1]&&X[e+a][o+r-1].userData.block&&X[e+a][o+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||X[e+a]&&X[e+a][o+r+1]&&X[e+a][o+r+1].userData.block&&X[e+a][o+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(p=!0)}if(!d||!c||p)break}return d&&c&&!p&&y}function d(t){var e,o,a;for(e=0,o=dt.length;o>e;e++)if(a=dt[e],a.userData.id===t)return a;return!1}function c(t){var e,o,n,r;t.preventDefault(),M.x=t.clientX/pt*2-1,M.y=2*-(t.clientY/yt)+1,ot=null,at=null,B.setFromCamera(M,w),tt&&et?B.ray.intersectPlane(v,C)&&(et.position.copy(C.sub(z)),n=et.userData.layout.length,r=et.userData.layout[0].length,ot=Math.floor((C.x+ft*ht/2-n*ht/2+ht/2)/ht),at=Math.floor((C.z+bt*gt/2-r*gt/2+gt/2)/gt),b.remove(Z),X[ot]&&X[ot][at]&&(K=X[ot][at],u(et,ot,at)&&(Z=et.clone(),Z.position.copy(K.position),Z.position.x=Z.position.x+n*ht/2-ht/2,Z.position.z=Z.position.z+r*gt/2-gt/2,Z.position.y=Z.position.y+Et/2,b.add(Z))),gapi.hangout.data.sendMessage(a({name:"block.mousemove",b:{id:et.userData.id,p:[et.position.x,et.position.y,et.position.z]}}))):(o=B.intersectObjects(dt,!0),o.length>0?(e=o[0],Q=e.object.parent?e.object.parent:e.object,Q.userData.isPlaced?lt.style.cursor="auto":lt.style.cursor="move"):(Q=null,lt.style.cursor="auto"))}function p(t){var e,o;if(t.preventDefault(),B.setFromCamera(M,w),o=B.intersectObjects(dt,!0),o.length>0){if(e=o[0],H.enabled=!1,tt=e.object,e.object.parent&&(et=e.object.parent),et.userData.isPlaced)return et=null,void(tt=null);B.ray.intersectPlane(v,C)&&z.copy(C).sub(et.position)}lt.style.cursor="move"}function y(e){var o,a,n,r,s,i,l;if(e.preventDefault(),H.enabled=!0,tt&&et)if(l=et,ot&&at&&u(et,ot,at)){for(K=X[ot][at],o=0,a=et.userData.layout.length;a>o;o++)for(J=0,F=et.userData.layout[o].length;F>J;J++)et.userData.layout[o][J]&&(X[ot+o][at+J].userData.block=et,t.syncBoardSquare(t.state.board[ot+o][at+J],X[ot+o][at+J],!1));n=et.userData.layout.length,r=et.userData.layout[0].length,G=new TWEEN.Tween(et.position).to({x:K.position.x+n*ht/2-ht/2,z:K.position.z+r*gt/2-gt/2,y:K.position.y+Et/2},200).easing(TWEEN.Easing.Bounce.Out).onComplete(function(){G=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start(),et.userData.isPlaced=!0,tt=null,et=null,b.remove(Z)}else et.position.x>et.lowerBoundary.x&&et.position.x<et.upperBoundary.x&&et.position.z>et.lowerBoundary.z&&et.position.z<et.upperBoundary.z&&(et.startPosition.x=et.position.x,et.startPosition.z=et.position.z,et.startRotation=et.rotation),s=et.startPosition,i=et.startRotation,G=new TWEEN.Tween(et.position).to({x:s.x,z:s.z,y:s.y},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){G=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start(),new TWEEN.Tween(et.rotation).to({y:i.y,z:i.z},200).easing(TWEEN.Easing.Exponential.Out).start();Q&&(tt=null,et=null)}function h(e){var o,n,u;e.preventDefault(),et&&!Y&&(u=et,37===e.keyCode||65===e.keyCode?(u.isRotated=!u.isRotated,u.userData.layout=r(u.userData.layout),n=u.rotation.y,Y=new TWEEN.Tween(u.rotation).to({y:n+Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(u.userData.id),u,!1),Y=null,u=null}).start(),gapi.hangout.data.sendMessage(a({name:"block.keydown.left",b:{id:u.userData.id,r:n+Math.PI/2}}))):38===e.keyCode||87===e.keyCode?(u.isRotated?u.userData.layout=l(u.userData.layout):u.userData.layout=i(u.userData.layout),o=u.rotation.z,Y=new TWEEN.Tween(u.rotation).to({z:o+Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(u.userData.id),u,!1),Y=null,u=null}).start(),gapi.hangout.data.sendMessage(a({name:"block.keydown.up",b:{id:u.userData.id,r:o+Math.PI}}))):39===e.keyCode||83===e.keyCode?(u.isRotated=!u.isRotated,u.userData.layout=s(u.userData.layout),n=u.rotation.y,Y=new TWEEN.Tween(u.rotation).to({y:n-Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(u.userData.id),u,!1),Y=null,u=null}).start(),gapi.hangout.data.sendMessage(a({name:"block.keydown.right",b:{id:u.userData.id,r:n-Math.PI/2}}))):(40===e.keyCode||68===e.keyCode)&&(u.isRotated?u.userData.layout=l(u.userData.layout):u.userData.layout=i(u.userData.layout),o=u.rotation.z,Y=new TWEEN.Tween(u.rotation).to({z:o-Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(u.userData.id),u,!1),Y=null,u=null}).start(),gapi.hangout.data.sendMessage(a({name:"block.keydown.down",b:{id:u.userData.id,r:o-Math.PI}}))))}function g(){H.update(),R.render(b,w)}function E(e){requestAnimationFrame(E),t&&t.state&&t.state.game&&t.state.game.currentStage&&t.state.game.currentStage===n.PLAY&&(TWEEN.update(e),g())}var f=!1;t.me=gapi.hangout.getLocalParticipant(),t.state=e(gapi.hangout.data.getState())||{},t.state.game||(t.state.game={}),t.state.game.currentStage||(t.state.game.currentStage=n.LOBBY),t.state.players||(t.state.players=[]),gapi.hangout.data.onStateChanged.add(function(o){var a;a=e(o.state),f=!0,setTimeout(function(){f&&(f=!1)},0),t.state=a,a.board&&t.syncBoardWithState(),(a.blocksBlue||a.blocksGreen||a.blocksRed||a.blocksYellow)&&t.syncBlocksWithState(),window.state=a,t.$apply()}),t.$watch("state.game",function(e,o,n){f?f=!1:t.state&&t.state.game&&gapi.hangout.data.submitDelta({game:a(t.state.game)})},!0),t.$watch("state.players",function(e,o,n){f?f=!1:t.state&&t.state.players&&gapi.hangout.data.submitDelta({players:a(t.state.players)})},!0),t.$watch("state.host",function(e,o,n){f?f=!1:t.state&&t.state.host&&gapi.hangout.data.submitDelta({host:a(t.state.host)})},!0),t.$watch("state.colors",function(e,o,n){f?f=!1:t.state&&t.state.colors&&gapi.hangout.data.submitDelta({colors:a(t.state.colors)})},!0),t.$watch("state.board",function(e,o,n){f?f=!1:t.state&&t.state.board&&gapi.hangout.data.submitDelta({board:a(t.state.board)})},!0),t.$watch("state.blocksBlue",function(e,o,n){f?f=!1:t.state&&t.state.blocksBlue&&gapi.hangout.data.submitDelta({blocksBlue:a(t.state.blocksBlue)})},!0),t.$watch("state.blocksGreen",function(e,o,n){f?f=!1:t.state&&t.state.blocksGreen&&gapi.hangout.data.submitDelta({blocksGreen:a(t.state.blocksGreen)})},!0),t.$watch("state.blocksRed",function(e,o,n){f?f=!1:t.state&&t.state.blocksRed&&gapi.hangout.data.submitDelta({blocksRed:a(t.state.blocksRed)})},!0),t.$watch("state.blocksYellow",function(e,o,n){f?f=!1:t.state&&t.state.blocksYellow&&gapi.hangout.data.submitDelta({blocksYellow:a(t.state.blocksYellow)})},!0),t.computers=0,t.addPlayer=function(e){var o,a;if(a=t.state.players,e.player&&e.player.id&&a.length<4&&!t.findPlayerById(e.player.id)){if(o={},!e.player.type)throw new Error("config.player.type was not provided");if(o.type=e.player.type,"human"===o.type){if(!e.player.id)throw new Error("config.player.id was not provided");if(o.id=e.player.id,!e.player.name)throw new Error("config.player.name was not provided");o.name=e.player.name,e.player.image&&(o.image=e.player.image)}else{if("computer"!==o.type)throw new Error('config.player.type is not a supported type (either "human", or "computer")');o.id="computer-"+Math.floor(1e4*Math.random()),o.name="Computer "+t.computers+1}return a.push(o),t.state.host||"human"!==o.type||(t.state.host=o),!0}return!1},t.findPlayerById=function(e){var o,a,n,r;if(r=t.state.players,!r)return null;for(o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;return null},t.removePlayer=function(e){var o,a,n;if(n=t.state.players,!e.player)return!1;for(o=n.length-1;o>=0;o--)if(n[o]===e.player)return a=n.splice(o,1),!0;return!1},t.showLeaveModal=!1,t.leave=function(){var e,o,a,n,r=!1;if(n=t.state.players,t.state.host&&t.state.host.id===t.me.person.id&&(r=!0),r)for(t.state.host=null,e=0,o=n.length;o>e;e++)if(a=n[e],t.me.person.id!==a.id&&"human"===a.type){t.state.host=a;break}t.removePlayer({player:t.findPlayerById(t.me.person.id)})},gapi.hangout.onParticipantsDisabled.add(function(e){var o,a,n,r,s,i,l=!1,u=!1;if(i=t.state.players,t.state.host)for(o=0,a=e.disabledParticipants.length;a>o;o++)if(r=e.disabledParticipants[o],r.person.id===t.state.host.id){l=!0;break}if(l)for(o=0,a=i.length;a>o;o++)if(s=i[o],t.me.person.id===s.id&&"human"===s.type&&t.state.host.id!==s.id){t.state.host=s;break}if(t.state.host&&t.state.host.id===t.me.person.id&&(u=!0),u)for(o=0,a=e.disabledParticipants.length;a>o;o++)for(r=e.disabledParticipants[o],n=i.length-1;n>=0;n--)if(s=i[n],r.person.id===s.id){t.removePlayer({player:s});break}t.$apply()}),t.join=function(){t.addPlayer({player:{type:"human",id:t.me.person.id,name:t.me.person.displayName,image:t.me.person.image.url}})},t.begin=function(){t.state.game.currentStage=n.CHOOSE_COLOR},t.isPlayer=function(){var e,o,a,n;for(o=t.state.players,a=0,n=o.length;n>a;a++)if(e=o[a],t.me.person.id===e.id)return!0;return!1},t.state.colors||(t.state.colors={blue:{i:"b",color:"blue",label:"Blue",hex:255},green:{i:"g",color:"green",label:"Green",hex:65280},yellow:{i:"y",color:"yellow",label:"Yellow",hex:16776960},red:{i:"r",color:"red",label:"Red",hex:16711680}}),t.chooseColor=function(e){var o,a,n,r,s,i,l,u;if(n=t.state.colors,o=t.state.players,t.myRemainingColors()&&!n[e].id&&(a=n[e],a.type=1,a.id=t.me.person.id),3===o.length&&3===Object.keys(n).length){for(e in n)if(a=n[e],!a.id)break;for(i=[],l=0,u=o.length;u>l;l++){s=o[l];do r=Math.floor(3*Math.random());while(i[r]);i[r]=s.id}a.type=2,a.id=i[0],a.order=i,a.current=0}},t.myRemainingColors=function(){var e,o,a,n,r=0;if(a=t.state.colors,n=t.state.players,t.isPlayer()){2===n.length?r=2:(3===n.length||4===n.length)&&(r=1);for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&r--}return r},t.getMyColors=function(){var e,o,a,n=[];a=t.state.colors;for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&n.push(e);return n},t.getSharedColor=function(){var e,o,a,n;if(n=t.state.players,3===n.length){a=t.state.colors;for(o in a)if(e=a[o],2===e.type)return e}return null},t.displayColors=function(){var e="",o=t.getMyColors(!0);return o[0]&&o[0].label&&(e=o[0].label,o[1]&&o[1].label&&(e+=" and "+o[1].label)),e},t.displayChoosenColors=function(){var e,o,a,n=[];o=t.state.colors;for(e in o)a=o[e],a.id&&n.push(a.color);return n},t.displaySharedColor=function(){var e=t.getSharedColor();return e&&e.label?e.label:!1},t.start=function(){t.state.game.currentStage=n.PLAY},t.state.board?setTimeout(function(){t.syncBoardWithState()},100):t.state.board=[],t.state.blocksBlue||(t.state.blocksBlue=[]),t.state.blocksGreen||(t.state.blocksGreen=[]),t.state.blocksRed||(t.state.blocksRed=[]),t.state.blocksYellow?setTimeout(function(){t.syncBlocksWithState()},100):t.state.blocksYellow=[];var b,w,m,k,D,R,P,T,x,B,v,z,C,M,H,S,N,W,I,O,V,A,q,L,Y,G,$,j,J,F,_,U,X,Z,K,Q,tt,et,ot,at,nt,rt,st=window,it=document,lt=it.getElementById("canvas-container"),ut=new THREE.JSONLoader,dt=[],ct=[{id:21,startPosition:new THREE.Vector3(2.2,.1,1.5),squareCount:5,layout:[[1,1,1,1,1]]},{id:20,startPosition:new THREE.Vector3(2.6,.1,1.5),squareCount:5,layout:[[1,1,1,1],[1,0,0,0]]},{id:19,startPosition:new THREE.Vector3(3.1,.1,1.5),squareCount:5,layout:[[1,1,1,1],[0,1,0,0]]},{id:18,startPosition:new THREE.Vector3(3.6,.1,1.5),squareCount:5,layout:[[0,1,1,1],[1,1,0,0]]},{id:17,startPosition:new THREE.Vector3(2.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,0],[1,0,0]]},{id:16,startPosition:new THREE.Vector3(3.1,.1,.6),squareCount:5,layout:[[0,1,1],[1,1,0],[1,0,0]]},{id:15,startPosition:new THREE.Vector3(3.8,.1,.6),squareCount:5,layout:[[0,1,1],[0,1,0],[1,1,0]]},{id:14,startPosition:new THREE.Vector3(2.4,.1,-.1),squareCount:5,layout:[[1,1,1],[0,1,0],[0,1,0]]},{id:13,startPosition:new THREE.Vector3(3.1,.1,-.1),squareCount:5,layout:[[0,1,1],[1,1,0],[0,1,0]]},{id:12,startPosition:new THREE.Vector3(3.8,.1,-.1),squareCount:5,layout:[[0,1,0],[1,1,1],[0,1,0]]},{id:11,startPosition:new THREE.Vector3(4.1,.1,1.5),squareCount:5,layout:[[1,1,1],[1,1,0]]},{id:10,startPosition:new THREE.Vector3(4.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,1]]},{id:9,startPosition:new THREE.Vector3(2.2,.1,-.9),squareCount:4,layout:[[1,1,1,1]]},{id:8,startPosition:new THREE.Vector3(2.6,.1,-.9),squareCount:4,layout:[[1,1,1],[1,0,0]]},{id:7,startPosition:new THREE.Vector3(3.1,.1,-.9),squareCount:4,layout:[[1,1,1],[0,1,0]]},{id:6,startPosition:new THREE.Vector3(3.6,.1,-.9),squareCount:4,layout:[[1,1,0],[0,1,1]]},{id:5,startPosition:new THREE.Vector3(4.1,.1,-.9),squareCount:4,layout:[[1,1],[1,1]]},{id:4,startPosition:new THREE.Vector3(2.2,.1,-1.7),squareCount:3,layout:[[1,1,1]]},{id:3,startPosition:new THREE.Vector3(2.6,.1,-1.7),squareCount:3,layout:[[1,1],[1,0]]},{id:2,startPosition:new THREE.Vector3(3,.1,-1.7),squareCount:2,layout:[[1,1]]},{id:1,startPosition:new THREE.Vector3(3.3,.1,-1.7),squareCount:1,layout:[[1]]}],pt=lt.offsetWidth,yt=lt.offsetHeight,ht=.2,gt=.2,Et=.04,ft=20,bt=20,wt=.6;for(gapi.hangout.data.onMessageReceived.add(function(t){var e;t=o(t),"block.mousemove"===t.name?(e=d(t.b.id),G=new TWEEN.Tween(e.position).to({x:t.b.p[0],y:t.b.p[1],z:t.b.p[2]},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){G=null}).start()):"block.keydown.left"===t.name?(e=d(t.b.id),Y=new TWEEN.Tween(e.rotation).to({y:t.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){Y=null}).start()):"block.keydown.up"===t.name?(e=d(t.b.id),Y=new TWEEN.Tween(e.rotation).to({z:t.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){Y=null}).start()):"block.keydown.right"===t.name?(e=d(t.b.id),Y=new TWEEN.Tween(e.rotation).to({y:t.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){Y=null}).start()):"block.keydown.down"===t.name&&(e=d(t.b.id),Y=new TWEEN.Tween(e.rotation).to({z:t.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){Y=null}).start())}),t.getBlockById=function(e){var o,a,n,r;for(r=t.state.blocksBlue,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;for(r=t.state.blocksGreen,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;for(r=t.state.blocksRed,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;for(r=t.state.blocksYellow,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;return null},t.syncBoardWithState=function(){var e,o,a,n,r,s;for(s=t.state.board,e=0,o=s.length;o>e;e++)for(a=0,n=s[e].length;n>a;a++)r=s[e][a],t.syncBoardSquare(X[e][a],r,!0)},t.syncBoardSquare=function(t,e,o){o?t.userData.block=d(e.b):t.b=e.userData.block.userData.id},t.syncBlocksWithState=function(){var e,o,a,n;if(n=t.state.blocksBlue)for(e=0,o=n.length;o>e;e++)a=n[e],t.syncBlock(d(a.id),a,!0);if(n=t.state.blocksGreen)for(e=0,o=n.length;o>e;e++)a=n[e],t.syncBlock(d(a.id),a,!0);if(n=t.state.blocksRed)for(e=0,o=n.length;o>e;e++)a=n[e],t.syncBlock(d(a.id),a,!0);if(n=t.state.blocksYellow)for(e=0,o=n.length;o>e;e++)a=n[e],t.syncBlock(d(a.id),a,!0)},t.syncBlock=function(e,o,a){a?(e.userData.layout=o.l,e.position.x=o.p[0],e.position.y=o.p[1],e.position.z=o.p[2],e.rotation.x=o.r[0],e.rotation.y=o.r[1],e.rotation.z=o.r[2],e.startPosition.x=o.sp[0],e.startPosition.y=o.sp[1],e.startPosition.z=o.sp[2],e.startRotation.x=o.sr[0],e.startRotation.y=o.sr[1],e.startRotation.z=o.sr[2],e.isRotated=o.ir,e.userData.isPlaced=o.ip):(e.l=o.userData.layout,e.p[0]=Math.round(1e3*o.position.x)/1e3,e.p[1]=Math.round(1e3*o.position.y)/1e3,e.p[2]=Math.round(1e3*o.position.z)/1e3,e.r[0]=Math.round(1e3*o.rotation.x)/1e3,e.r[1]=Math.round(1e3*o.rotation.y)/1e3,e.r[2]=Math.round(1e3*o.rotation.z)/1e3,e.sp[0]=Math.round(1e3*o.startPosition.x)/1e3,e.sp[1]=Math.round(1e3*o.startPosition.y)/1e3,e.sp[2]=Math.round(1e3*o.startPosition.z)/1e3,e.sr[0]=Math.round(1e3*o.startRotation.x)/1e3,e.sr[1]=Math.round(1e3*o.startRotation.y)/1e3,e.sr[2]=Math.round(1e3*o.startRotation.z)/1e3,e.ir=o.isRotated,e.ip=o.userData.isPlaced,t.$apply())},R=new THREE.WebGLRenderer,R.setSize(pt,yt),R.setClearColor(16777215),R.shadowMap.enabled=!0,b=new THREE.Scene,w=new THREE.PerspectiveCamera(45,pt/yt,.1,1e3),w.position.x=6,w.position.y=6,w.position.z=6,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0)),m=it.getElementById("view-1"),k=it.getElementById("view-2"),D=it.getElementById("view-3"),m.addEventListener("click",function(t){w.position.x=0,w.position.y=10,w.position.z=0,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),k.addEventListener("click",function(t){w.position.x=0,w.position.y=6,w.position.z=9,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),D.addEventListener("click",function(t){w.position.x=6,w.position.y=6,w.position.z=6,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),st.addEventListener("resize",function(){pt=lt.offsetWidth,yt=lt.offsetHeight,w.aspect=pt/yt,w.updateProjectionMatrix(),R.setSize(pt,yt)},!1),H=new THREE.TrackballControls(w),H.rotateSpeed=1,H.zoomSpeed=1.2,H.panSpeed=.3,H.noZoom=!1,H.noPan=!1,H.noRotate=!1,H.staticMoving=!1,H.dynamicDampingFactor=.3,P=[],T=0,P[T]=new THREE.DirectionalLight(16777215,.25),P[T].position.x=-50,P[T].position.y=50,P[T].position.z=-50,P[T].castShadow=!0,b.add(P[T]),T=1,P[T]=new THREE.DirectionalLight(16777215,.25),P[T].position.x=50,P[T].position.y=50,P[T].position.z=50,P[T].castShadow=!0,b.add(P[T]),T=2,P[T]=new THREE.DirectionalLight(16777215,.25),P[T].position.x=-50,P[T].position.y=50,P[T].position.z=50,P[T].castShadow=!0,b.add(P[T]),T=3,P[T]=new THREE.DirectionalLight(16777215,.25),P[T].position.x=50,P[T].position.y=50,P[T].position.z=-50,P[T].castShadow=!0,b.add(P[T]),T=4,P[T]=new THREE.DirectionalLight(16777215,.25),P[T].position.x=0,P[T].position.y=-50,P[T].position.z=0,P[T].castShadow=!0,b.add(P[T]),x=new THREE.AmbientLight(5263440),b.add(x),X=[],N=ut.parse({metadata:{},scale:1,materials:[],vertices:[-.1,0,.1,-.1,.01,.1,-.1,0,-.1,-.1,.01,-.1,.1,0,.1,.1,.01,.1,.1,0,-.1,.1,.01,-.1,.0975,.01,.0975,-.0975,.01,.0975,.0975,.01,-.0975,-.0975,.01,-.0975,.095,0,.095,-.095,0,.095,.095,0,-.095,-.095,0,-.095],morphTargets:[],morphColors:[],normals:[-1,0,0,0,0,-1,1,0,0,0,0,1,0,-1,0,0,1,0,-.9701,.2425,0,0,.2425,.9701,0,.2425,-.9701,.9701,.2425,0],colors:[],uvs:[[]],faces:[35,1,3,2,0,0,0,0,0,0,35,3,7,6,2,0,1,1,1,1,35,7,5,4,6,0,2,2,2,2,35,5,1,0,4,0,3,3,3,3,35,0,2,6,4,0,4,4,4,4,35,9,11,3,1,0,5,5,5,5,35,5,8,9,1,0,5,5,5,5,35,5,7,10,8,0,5,5,5,5,35,8,10,14,12,0,6,6,6,6,35,10,7,3,11,0,5,5,5,5,35,12,14,15,13,0,5,5,5,5,35,10,11,15,14,0,7,7,7,7,35,9,8,12,13,0,8,8,8,8,35,11,9,13,15,0,9,9,9,9]}).geometry,$=0,j=ft;j>$;$++)for(X[$]=[],J=0,F=bt;F>J;J++)W=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),S=new THREE.Mesh(N,W),S.position.x=$*ht-ft*ht/2+ht/2,S.position.z=J*gt-bt*gt/2+gt/2,S.castShadow=!0,S.receiveShadow=!1,S.userData.xIndex=$,S.userData.zIndex=J,S.userData.block=null,S.userData.square=null,X[$][J]=S,b.add(S),t.state.board[$]||(t.state.board[$]=[]),t.state.board[$][J]||(t.state.board[$][J]={b:null});I=new THREE.BoxGeometry(ft*ht,wt,bt*gt),O=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),V=new THREE.Mesh(I,O),V.position.y=-(wt/2)-1e-4,b.add(V);var mt,kt,Dt,Rt,Pt,Tt,xt;for(nt in t.state.colors)for(rt=t.state.colors[nt],_=0,U=ct.length;U>_;_++){for(kt=ct[_],mt=new THREE.Group,mt.userData.id=rt.i+"-"+kt.id,mt.userData.layout=JSON.parse(JSON.stringify(kt.layout)),mt.userData.squareCount=kt.squareCount,mt.userData.colorAgent=rt,mt.userData.color=nt,mt.userData.isPlaced=!1,Dt=mt.userData.layout.length,Rt=mt.userData.layout[0].length,$=0,j=kt.layout.length;j>$;$++)for(Pt=kt.layout[$],J=0,F=Pt.length;F>J;J++)Tt=Pt[J],Tt&&(q=ut.parse({metadata:{},scale:1,materials:[],vertices:[.1,.01,-.1,-.1,.01,.1,.1,.01,.1,-.1,.01,-.1,-.1,.03,.1,.1,.03,.1,-.1,.03,-.1,.1,.03,-.1,-.0925,.03,.0925,-.0925,.03,-.0925,.0925,.03,.0925,.0925,.03,-.0925,-.0925,.04,.0925,-.0925,.04,-.0925,.0925,.04,.0925,.0925,.04,-.0925,-.0925,.01,.0925,.0925,.01,.0925,-.0925,.01,-.0925,.0925,.01,-.0925,-.0925,0,.0925,.0925,0,.0925,-.0925,0,-.0925,.0925,0,-.0925,-.065,.04,.065,-.065,.04,-.065,.065,.04,.065,.065,.04,-.065,-.065,.03,.065,-.065,.03,-.065,.065,.03,.065,.065,.03,-.065,-.065,0,.065,.065,0,.065,-.065,0,-.065,.065,0,-.065,-.065,.01,.065,.065,.01,.065,-.065,.01,-.065,.065,.01,-.065],morphTargets:[],morphColors:[],normals:[0,0,-1,0,0,1,1,0,0,-1,0,0,0,1,0,0,-1,0],colors:[],uvs:[[]],faces:[35,0,3,6,7,0,0,0,0,0,35,1,2,5,4,0,1,1,1,1,35,2,0,7,5,0,2,2,2,2,35,3,1,4,6,0,3,3,3,3,35,9,11,7,6,0,4,4,4,4,35,4,8,9,6,0,4,4,4,4,35,4,5,10,8,0,4,4,4,4,35,11,9,13,15,0,0,0,0,0,35,10,5,7,11,0,4,4,4,4,35,10,11,15,14,0,2,2,2,2,35,9,8,12,13,0,3,3,3,3,35,8,10,14,12,0,1,1,1,1,35,17,19,0,2,0,5,5,5,5,35,1,16,17,2,0,5,5,5,5,35,1,3,18,16,0,5,5,5,5,35,17,16,20,21,0,1,1,1,1,35,18,3,0,19,0,5,5,5,5,35,16,18,22,20,0,3,3,3,3,35,19,17,21,23,0,2,2,2,2,35,18,19,23,22,0,0,0,0,0,35,25,27,15,13,0,4,4,4,4,35,12,24,25,13,0,4,4,4,4,35,12,14,26,24,0,4,4,4,4,35,24,26,30,28,0,0,0,0,0,35,26,14,15,27,0,4,4,4,4,35,28,30,31,29,0,4,4,4,4,35,26,27,31,30,0,3,3,3,3,35,27,25,29,31,0,1,1,1,1,35,25,24,28,29,0,2,2,2,2,35,33,35,23,21,0,5,5,5,5,35,20,32,33,21,0,5,5,5,5,35,20,22,34,32,0,5,5,5,5,35,33,32,36,37,0,0,0,0,0,35,34,22,23,35,0,5,5,5,5,35,36,38,39,37,0,5,5,5,5,35,32,34,38,36,0,2,2,2,2,35,34,35,39,38,0,1,1,1,1,35,35,33,37,39,0,3,3,3,3]}).geometry,L=new THREE.MeshPhongMaterial({color:mt.userData.colorAgent.hex,transparent:!0,opacity:.75,shininess:75,side:THREE.DoubleSide}),A=new THREE.Mesh(q,L),A.position.x=$*ht-Dt*ht/2+ht/2,A.position.z=J*gt-Rt*gt/2+gt/2,A.position.y=-Et/2,A.userData.xIndex=$,A.userData.zIndex=J,mt.add(A));mt.startPosition=new THREE.Vector3,mt.startRotation=new THREE.Vector3,mt.upperBoundary=new THREE.Vector3,mt.lowerBoundary=new THREE.Vector3,mt.isRotated=!1,"blue"===nt?(mt.startPosition.x=kt.startPosition.x,mt.startPosition.y=kt.startPosition.y,mt.startPosition.z=kt.startPosition.z,mt.upperBoundary.x=8,mt.lowerBoundary.x=2.2,mt.upperBoundary.z=2.4,mt.lowerBoundary.z=-2.4,mt.startRotation.y=0):"green"===nt?(mt.startPosition.x=-kt.startPosition.x,mt.startPosition.y=kt.startPosition.y,mt.startPosition.z=-kt.startPosition.z,mt.upperBoundary.x=-2.2,mt.lowerBoundary.x=-8,mt.upperBoundary.z=2.4,mt.lowerBoundary.z=-2.4,mt.startRotation.y=Math.PI,mt.userData.layout=r(r(mt.userData.layout))):"red"===nt?(mt.startPosition.x=-kt.startPosition.z,mt.startPosition.y=kt.startPosition.y,mt.startPosition.z=kt.startPosition.x,mt.upperBoundary.x=2.4,mt.lowerBoundary.x=-2.4,mt.upperBoundary.z=8,mt.lowerBoundary.z=2.2,mt.startRotation.y=Math.PI+Math.PI/2,mt.userData.layout=s(mt.userData.layout),mt.isRotated=!0):"yellow"===nt&&(mt.startPosition.x=kt.startPosition.z,mt.startPosition.y=kt.startPosition.y,mt.startPosition.z=-kt.startPosition.x,mt.upperBoundary.x=2.4,mt.lowerBoundary.x=-2.4,mt.upperBoundary.z=-2.2,mt.lowerBoundary.z=-8,mt.startRotation.y=Math.PI/2,mt.userData.layout=r(mt.userData.layout),mt.isRotated=!0),mt.position.x=mt.startPosition.x,mt.position.y=mt.startPosition.y,mt.position.z=mt.startPosition.z,mt.rotation.y=mt.startRotation.y,mt.castShadow=!0,mt.receiveShadow=!1,dt.push(mt),b.add(mt),window.blocks=dt,t.getBlockById(mt.userData.id)||("blue"===nt?xt=t.state.blocksBlue:"green"===nt?xt=t.state.blocksGreen:"red"===nt?xt=t.state.blocksRed:"yellow"===nt&&(xt=t.state.blocksYellow),xt.push({id:mt.userData.id,l:mt.userData.layout,sp:[Math.round(1e3*mt.startPosition.x)/1e3,Math.round(1e3*mt.startPosition.y)/1e3,Math.round(1e3*mt.startPosition.z)/1e3],sr:[Math.round(1e3*mt.startRotation.x)/1e3,Math.round(1e3*mt.startRotation.y)/1e3,Math.round(1e3*mt.startRotation.z)/1e3],p:[Math.round(1e3*mt.position.x)/1e3,Math.round(1e3*mt.position.y)/1e3,Math.round(1e3*mt.position.z)/1e3],r:[Math.round(1e3*mt.rotation.x)/1e3,Math.round(1e3*mt.rotation.y)/1e3,Math.round(1e3*mt.rotation.z)/1e3],ir:mt.isRotated,ip:!1}))}B=new THREE.Raycaster,M=new THREE.Vector2,v=new THREE.Plane(new THREE.Vector3(0,1,0)),z=new THREE.Vector3,C=new THREE.Vector3,R.domElement.addEventListener("mousemove",c,!1),R.domElement.addEventListener("mousedown",p,!1),R.domElement.addEventListener("mouseup",y,!1),document.addEventListener("keydown",h,!1),lt.appendChild(R.domElement),E()}]),t}),define("events",[],function(){var t={},e={};return{on:function(o,a,n){if(e[o]){if(!n)return;try{a(e[o])}catch(r){console.error(r)}}t[o]||(t[o]=[]),t[o].push(a)},off:function(e,o){var a;if(t[e]&&t[e].length)for(a=t[e].length-1;a>=0;a--)t[e][a]===o&&t[e][a].splice(a,1)},trigger:function(o,a){var n,r,s;if(e[o]=a,t[o]&&t[o].length)for(n=0,r=t[o].length;r>n;n++)if(s=t[o][n])try{s(a)}catch(i){console.error(i)}return!0}}}),require(["app","events"],function(t,e){var o=new Promise(function(t,e){gapi.hangout.onApiReady.add(function(e){e.isApiReady&&t()})});o.then(function(){angular.bootstrap(document,["app"])})}),define("main",function(){});