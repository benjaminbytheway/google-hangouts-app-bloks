define("app",[],function(){var t,e=function(t){var e,o={};for(e in t)if(t.hasOwnProperty(e))try{o[e]=JSON.parse(t[e])}catch(a){}return o},o=function(t){try{return JSON.parse(t)}catch(e){}return null},a=function(t){try{return JSON.stringify(t)}catch(e){}return""},n={LOBBY:1,CHOOSE_COLOR:2,PLAY:3,DETERMINE_WINNER:4,CONGRATULATIONS:5};return t=angular.module("app",[]),t.run(["$rootScope",function(t){function s(t){var e,o,a=t.length,n=t[0].length,s=0,r=0,i=[];for(o=0;n>o;o++){for(e=a-1;e>=0;e--)i[s]||(i[s]=[]),i[s][r]=t[e][o],r++;s++,r=0}return i}function r(t){var e,o,a=t.length,n=t[0].length,s=0,r=0,i=[];for(o=n-1;o>=0;o--){for(e=0;a>e;e++)i[s]||(i[s]=[]),i[s][r]=t[e][o],r++;s++,r=0}return i}function i(t){var e,o,a=t.length,n=t[0].length,s=0,r=0,i=[];for(e=a-1;e>=0;e--){for(o=0;n>o;o++)i[s]||(i[s]=[]),i[s][r]=t[e][o],r++;s++,r=0}return i}function l(t){var e,o,a=t.length,n=t[0].length,s=0,r=0,i=[];for(e=0;a>e;e++){for(o=n-1;o>=0;o--)i[s]||(i[s]=[]),i[s][r]=t[e][o],r++;s++,r=0}return i}function u(t,e,o){var a,n,s,r,i=t.userData.layout,l=i.length,u=i[0].length,c=!0,d=!0,p=!1,y=!1;for(a=0,n=l;n>a;a++){for(s=0,r=u;r>s;s++){if(Q[e+a]&&Q[e+a][o+s]||(c=!1),Q[e+a]&&Q[e+a][o+s]&&Q[e+a][o+s].userData.block&&i[a][s]){d=!1;break}e+a!==0&&e+a!==19||o+s!==0&&o+s!==19||!i[a]||!i[a][s]||(y=!0),Q[e+a]&&Q[e+a][o+s]&&i[a]&&i[a][s]&&(Q[e+a-1]&&Q[e+a-1][o+s-1]&&Q[e+a-1][o+s-1].userData.block&&Q[e+a-1][o+s-1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a+1]&&Q[e+a+1][o+s-1]&&Q[e+a+1][o+s-1].userData.block&&Q[e+a+1][o+s-1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a-1]&&Q[e+a-1][o+s+1]&&Q[e+a-1][o+s+1].userData.block&&Q[e+a-1][o+s+1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a+1]&&Q[e+a+1][o+s+1]&&Q[e+a+1][o+s+1].userData.block&&Q[e+a+1][o+s+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(y=!0),Q[e+a]&&Q[e+a][o+s]&&i[a]&&i[a][s]&&(Q[e+a-1]&&Q[e+a-1][o+s]&&Q[e+a-1][o+s].userData.block&&Q[e+a-1][o+s].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a+1]&&Q[e+a+1][o+s]&&Q[e+a+1][o+s].userData.block&&Q[e+a+1][o+s].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a]&&Q[e+a][o+s-1]&&Q[e+a][o+s-1].userData.block&&Q[e+a][o+s-1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a]&&Q[e+a][o+s+1]&&Q[e+a][o+s+1].userData.block&&Q[e+a][o+s+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(p=!0)}if(!c||!d||p)break}return c&&d&&!p&&y}function c(t){var e,o,a;for(e=0,o=yt.length;o>e;e++)if(a=yt[e],a.userData.id===t)return a;return!1}function d(t){try{gapi.hangout.data.sendMessage(a(t))}catch(e){}}function p(){ht=dt.offsetWidth,mt=dt.offsetHeight,D.aspect=ht/mt,D.updateProjectionMatrix(),B.setSize(ht,mt)}function y(t){ut.focus()}function g(t){var e,o,a,n;t.preventDefault(),N.x=t.clientX/ht*2-1,N.y=2*-(t.clientY/mt)+1,st=null,rt=null,S.setFromCamera(N,D),at&&nt?S.ray.intersectPlane(C,M)&&(nt.position.copy(M.sub(H)),a=nt.userData.layout.length,n=nt.userData.layout[0].length,st=Math.floor((M.x+wt*Et/2-a*Et/2+Et/2)/Et),rt=Math.floor((M.z+kt*ft/2-n*ft/2+ft/2)/ft),k.remove(tt),Q[st]&&Q[st][rt]&&(et=Q[st][rt],u(nt,st,rt)&&(tt=nt.clone(),tt.position.copy(et.position),tt.position.x=tt.position.x+a*Et/2-Et/2,tt.position.z=tt.position.z+n*ft/2-ft/2,tt.position.y=tt.position.y+bt/2,k.add(tt))),d({name:"block.mousemove",b:{id:nt.userData.id,p:[nt.position.x,nt.position.y,nt.position.z]}})):(o=S.intersectObjects(yt,!0),o.length>0?(e=o[0],ot=e.object.parent?e.object.parent:e.object,ot.userData.isPlaced?dt.style.cursor="auto":dt.style.cursor="move"):(ot=null,dt.style.cursor="auto"))}function h(t){var e,o;if(t.preventDefault(),S.setFromCamera(N,D),o=S.intersectObjects(yt,!0),o.length>0){if(e=o[0],O.enabled=!1,at=e.object,e.object.parent&&(nt=e.object.parent),nt.userData.isPlaced)return nt=null,void(at=null);S.ray.intersectPlane(C,M)&&H.copy(M).sub(nt.position)}dt.style.cursor="move"}function m(e){var o,a,n,s,r,i,l;if(e.preventDefault(),O.enabled=!0,at&&nt)if(l=nt,void 0!==st&&null!==st&&void 0!==rt&&null!==rt&&u(nt,st,rt)){for(et=Q[st][rt],o=0,a=nt.userData.layout.length;a>o;o++)for(U=0,X=nt.userData.layout[o].length;X>U;U++)nt.userData.layout[o][U]&&(Q[st+o][rt+U].userData.block=nt,t.syncBoardSquare(t.state.board[st+o][rt+U],Q[st+o][rt+U],!1));n=nt.userData.layout.length,s=nt.userData.layout[0].length,j=new TWEEN.Tween(nt.position).to({x:et.position.x+n*Et/2-Et/2,z:et.position.z+s*ft/2-ft/2,y:et.position.y+bt/2},200).easing(TWEEN.Easing.Bounce.Out).onComplete(function(){j=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start(),nt.userData.isPlaced=!0,at=null,nt=null,k.remove(tt)}else nt.position.x>nt.lowerBoundary.x&&nt.position.x<nt.upperBoundary.x&&nt.position.z>nt.lowerBoundary.z&&nt.position.z<nt.upperBoundary.z&&(nt.startPosition.x=nt.position.x,nt.startPosition.z=nt.position.z,nt.startRotation=nt.rotation),r=nt.startPosition,i=nt.startRotation,j=new TWEEN.Tween(nt.position).to({x:r.x,z:r.z,y:r.y},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start(),new TWEEN.Tween(nt.rotation).to({y:i.y,z:i.z},200).easing(TWEEN.Easing.Exponential.Out).start(),k.remove(tt);ot&&(at=null,nt=null)}function E(e){var o,a,n;e.preventDefault(),nt&&!J&&(n=nt,37===e.keyCode||65===e.keyCode?(n.isRotated=!n.isRotated,n.userData.layout=s(n.userData.layout),a=n.rotation.y,J=new TWEEN.Tween(n.rotation).to({y:a+Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),J=null,n=null}).start(),d({name:"block.keydown.left",b:{id:n.userData.id,r:a+Math.PI/2}})):38===e.keyCode||87===e.keyCode?(n.isRotated?n.userData.layout=l(n.userData.layout):n.userData.layout=i(n.userData.layout),o=n.rotation.z,J=new TWEEN.Tween(n.rotation).to({z:o+Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),J=null,n=null}).start(),d({name:"block.keydown.up",b:{id:n.userData.id,r:o+Math.PI}})):39===e.keyCode||83===e.keyCode?(n.isRotated=!n.isRotated,n.userData.layout=r(n.userData.layout),a=n.rotation.y,J=new TWEEN.Tween(n.rotation).to({y:a-Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),J=null,n=null}).start(),d({name:"block.keydown.right",b:{id:n.userData.id,r:a-Math.PI/2}})):(40===e.keyCode||68===e.keyCode)&&(n.isRotated?n.userData.layout=l(n.userData.layout):n.userData.layout=i(n.userData.layout),o=n.rotation.z,J=new TWEEN.Tween(n.rotation).to({z:o-Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),J=null,n=null}).start(),d({name:"block.keydown.down",b:{id:n.userData.id,r:o-Math.PI}})))}function f(){O.update(),B.render(k,D)}function b(e){requestAnimationFrame(b),t&&t.state&&t.state.game&&t.state.game.currentStage&&t.state.game.currentStage===n.PLAY&&(TWEEN.update(e),f())}var w={game:!1,players:!1,host:!1,colors:!1,board:!1,blocksBlue:!1,blocksGreen:!1,blocksRed:!1,blocksYellow:!1};t.me=gapi.hangout.getLocalParticipant(),t.state=e(gapi.hangout.data.getState())||{},t.metadata=gapi.hangout.data.getStateMetadata()||{},t.state.game||(t.state.game={}),t.state.game.currentStage||(t.state.game.currentStage=n.LOBBY),t.state.players||(t.state.players=[]),gapi.hangout.data.onStateChanged.add(function(o){var a,n,s,r;r=e(o.state),w={game:!0,players:!0,host:!0,colors:!0,board:!0,blocksBlue:!0,blocksGreen:!0,blocksRed:!0,blocksYellow:!0},setTimeout(function(){w&&(w={game:!1,players:!1,host:!1,colors:!1,board:!1,blocksBlue:!1,blocksGreen:!1,blocksRed:!1,blocksYellow:!1})},0),console.log("************ onStateChanged ***********");for(a in r)n=r[a],s=o.metadata[a],s.lastWriter!==t.me.id?"game"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n):"players"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n):"host"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n):"colors"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n):"board"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n,t.syncBoardWithState()):"blocksBlue"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n,t.syncBlocksWithState(t.state[a])):"blocksGreen"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n,t.syncBlocksWithState(t.state[a])):"blocksRed"===a&&s?t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n,t.syncBlocksWithState(t.state[a])):"blocksYellow"===a&&s&&(t.metadata[a]&&t.metadata[a].timestamp===s.timestamp||(console.log(a+" changed to "+JSON.stringify(n)),t.metadata[a]=s,t.state[a]=n,t.syncBlocksWithState(t.state[a]))):t.metadata[a]=s;window.state=r,t.$apply()}),t.$watch("state.game",function(e,o,n){console.log("----------$watch--state.game----------"),w.game?(console.log("supressSubmitDelta"),w.game=!1):(console.log("submitDelta"),t.state&&t.state.game&&gapi.hangout.data.submitDelta({game:a(t.state.game)}))},!0),t.$watch("state.players",function(e,o,n){console.log("----------$watch--state.players----------"),w.players?(console.log("supressSubmitDelta"),w.players=!1):(console.log("submitDelta"),t.state&&t.state.players&&gapi.hangout.data.submitDelta({players:a(t.state.players)}))},!0),t.$watch("state.host",function(e,o,n){console.log("----------$watch--state.host----------"),w.host?(console.log("supressSubmitDelta"),w.host=!1):(console.log("submitDelta"),t.state&&t.state.host&&gapi.hangout.data.submitDelta({host:a(t.state.host)}))},!0),t.$watch("state.colors",function(e,o,n){w.colors?w.colors=!1:t.state&&t.state.colors&&gapi.hangout.data.submitDelta({colors:a(t.state.colors)})},!0),t.$watch("state.board",function(e,o,n){w.board?w.board=!1:t.state&&t.state.board&&gapi.hangout.data.submitDelta({board:a(t.state.board)})},!0),t.$watch("state.blocksBlue",function(e,o,n){console.log("----------$watch--state.blocksBlue----------"),w.blocksBlue?(console.log("supressSubmitDelta"),w.blocksBlue=!1):(console.log("submitDelta"),t.state&&t.state.blocksBlue&&gapi.hangout.data.submitDelta({blocksBlue:a(t.state.blocksBlue)}))},!0),t.$watch("state.blocksGreen",function(e,o,n){console.log("----------$watch--state.blocksGreen----------"),w.blocksGreen?(console.log("supressSubmitDelta"),w.blocksGreen=!1):(console.log("submitDelta"),t.state&&t.state.blocksGreen&&gapi.hangout.data.submitDelta({blocksGreen:a(t.state.blocksGreen)}))},!0),t.$watch("state.blocksRed",function(e,o,n){console.log("----------$watch--state.blocksRed----------"),w.blocksRed?(console.log("supressSubmitDelta"),w.blocksRed=!1):(console.log("submitDelta"),t.state&&t.state.blocksRed&&gapi.hangout.data.submitDelta({blocksRed:a(t.state.blocksRed)}))},!0),t.$watch("state.blocksYellow",function(e,o,n){console.log("----------$watch--state.blocksYellow----------"),w.blocksYellow?(console.log("supressSubmitDelta"),w.blocksYellow=!1):(console.log("submitDelta"),t.state&&t.state.blocksYellow&&gapi.hangout.data.submitDelta({blocksYellow:a(t.state.blocksYellow)}))},!0),t.computers=0,t.addPlayer=function(e){var o,a;if(a=t.state.players,e.player&&e.player.id&&a.length<4&&!t.findPlayerById(e.player.id)){if(o={},!e.player.type)throw new Error("config.player.type was not provided");if(o.type=e.player.type,"human"===o.type){if(!e.player.id)throw new Error("config.player.id was not provided");if(o.id=e.player.id,!e.player.name)throw new Error("config.player.name was not provided");o.name=e.player.name,e.player.image&&(o.image=e.player.image)}else{if("computer"!==o.type)throw new Error('config.player.type is not a supported type (either "human", or "computer")');o.id="computer-"+Math.floor(1e4*Math.random()),o.name="Computer "+t.computers+1}return a.push(o),t.state.host||"human"!==o.type||(t.state.host=o),!0}return!1},t.findPlayerById=function(e){var o,a,n,s;if(s=t.state.players,!s)return null;for(o=0,a=s.length;a>o;o++)if(n=s[o],n.id===e)return n;return null},t.removePlayer=function(e){var o,a,n;if(n=t.state.players,!e.player)return!1;for(o=n.length-1;o>=0;o--)if(n[o]===e.player)return a=n.splice(o,1),!0;return!1},t.showLeaveModal=!1,t.leave=function(){var e,o,a,n,s=!1;if(n=t.state.players,t.state.host&&t.state.host.id===t.me.person.id&&(s=!0),s)for(t.state.host=null,e=0,o=n.length;o>e;e++)if(a=n[e],t.me.person.id!==a.id&&"human"===a.type){t.state.host=a;break}t.removePlayer({player:t.findPlayerById(t.me.person.id)})},gapi.hangout.onParticipantsDisabled.add(function(e){var o,a,n,s,r,i,l=!1,u=!1;if(i=t.state.players,t.state.host)for(o=0,a=e.disabledParticipants.length;a>o;o++)if(s=e.disabledParticipants[o],s.person.id===t.state.host.id){l=!0;break}if(l)for(o=0,a=i.length;a>o;o++)if(r=i[o],t.me.person.id===r.id&&"human"===r.type&&t.state.host.id!==r.id){t.state.host=r;break}if(t.state.host&&t.state.host.id===t.me.person.id&&(u=!0),u)for(o=0,a=e.disabledParticipants.length;a>o;o++)for(s=e.disabledParticipants[o],n=i.length-1;n>=0;n--)if(r=i[n],s.person.id===r.id){t.removePlayer({player:r});break}t.$apply()}),t.join=function(){t.addPlayer({player:{type:"human",id:t.me.person.id,name:t.me.person.displayName,image:t.me.person.image.url}})},t.begin=function(){t.state.game.currentStage=n.CHOOSE_COLOR},t.isPlayer=function(){var e,o,a,n;for(o=t.state.players,a=0,n=o.length;n>a;a++)if(e=o[a],t.me.person.id===e.id)return!0;return!1},t.state.colors||(t.state.colors={blue:{i:"b",color:"blue",label:"Blue",hex:255},green:{i:"g",color:"green",label:"Green",hex:65280},yellow:{i:"y",color:"yellow",label:"Yellow",hex:16776960},red:{i:"r",color:"red",label:"Red",hex:16711680}}),t.chooseColor=function(e){var o,a,n,s,r,i,l,u;if(n=t.state.colors,o=t.state.players,t.myRemainingColors()&&!n[e].id&&(a=n[e],a.type=1,a.id=t.me.person.id),3===o.length&&3===Object.keys(n).length){for(e in n)if(a=n[e],!a.id)break;for(i=[],l=0,u=o.length;u>l;l++){r=o[l];do s=Math.floor(3*Math.random());while(i[s]);i[s]=r.id}a.type=2,a.id=i[0],a.order=i,a.current=0}},t.myRemainingColors=function(){var e,o,a,n,s=0;if(a=t.state.colors,n=t.state.players,t.isPlayer()){2===n.length?s=2:(3===n.length||4===n.length)&&(s=1);for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&s--}return s},t.getMyColors=function(){var e,o,a,n=[];a=t.state.colors;for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&n.push(e);return n},t.getSharedColor=function(){var e,o,a,n;if(n=t.state.players,3===n.length){a=t.state.colors;for(o in a)if(e=a[o],2===e.type)return e}return null},t.displayColors=function(){var e="",o=t.getMyColors(!0);return o[0]&&o[0].label&&(e=o[0].label,o[1]&&o[1].label&&(e+=" and "+o[1].label)),e},t.displayChoosenColors=function(){var e,o,a,n=[];o=t.state.colors;for(e in o)a=o[e],a.id&&n.push(a.color);return n},t.displaySharedColor=function(){var e=t.getSharedColor();return e&&e.label?e.label:!1},t.start=function(){t.state.game.currentStage=n.PLAY},t.state.board?setTimeout(function(){t.syncBoardWithState()},100):t.state.board=[],t.state.blocksBlue?setTimeout(function(){t.syncBlocksWithState(t.state.blocksBlue)},100):t.state.blocksBlue=[],t.state.blocksGreen?setTimeout(function(){t.syncBlocksWithState(t.state.blocksGreen)},100):t.state.blocksGreen=[],t.state.blocksRed?setTimeout(function(){t.syncBlocksWithState(t.state.blocksRed)},100):t.state.blocksRed=[],t.state.blocksYellow?setTimeout(function(){t.syncBlocksWithState(t.state.blocksYellow)},100):t.state.blocksYellow=[];var k,D,R,P,T,B,v,x,z,S,C,H,M,N,O,W,I,V,A,q,L,Y,G,$,J,j,F,_,U,X,Z,K,Q,tt,et,ot,at,nt,st,rt,it,lt,ut=window,ct=document,dt=ct.getElementById("canvas-container"),pt=new THREE.JSONLoader,yt=[],gt=[{id:21,startPosition:new THREE.Vector3(2.2,.1,1.5),squareCount:5,layout:[[1,1,1,1,1]]},{id:20,startPosition:new THREE.Vector3(2.6,.1,1.5),squareCount:5,layout:[[1,1,1,1],[1,0,0,0]]},{id:19,startPosition:new THREE.Vector3(3.1,.1,1.5),squareCount:5,layout:[[1,1,1,1],[0,1,0,0]]},{id:18,startPosition:new THREE.Vector3(3.6,.1,1.5),squareCount:5,layout:[[0,1,1,1],[1,1,0,0]]},{id:17,startPosition:new THREE.Vector3(2.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,0],[1,0,0]]},{id:16,startPosition:new THREE.Vector3(3.1,.1,.6),squareCount:5,layout:[[0,1,1],[1,1,0],[1,0,0]]},{id:15,startPosition:new THREE.Vector3(3.8,.1,.6),squareCount:5,layout:[[0,1,1],[0,1,0],[1,1,0]]},{id:14,startPosition:new THREE.Vector3(2.4,.1,-.1),squareCount:5,layout:[[1,1,1],[0,1,0],[0,1,0]]},{id:13,startPosition:new THREE.Vector3(3.1,.1,-.1),squareCount:5,layout:[[0,1,1],[1,1,0],[0,1,0]]},{id:12,startPosition:new THREE.Vector3(3.8,.1,-.1),squareCount:5,layout:[[0,1,0],[1,1,1],[0,1,0]]},{id:11,startPosition:new THREE.Vector3(4.1,.1,1.5),squareCount:5,layout:[[1,1,1],[1,1,0]]},{id:10,startPosition:new THREE.Vector3(4.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,1]]},{id:9,startPosition:new THREE.Vector3(2.2,.1,-.9),squareCount:4,layout:[[1,1,1,1]]},{id:8,startPosition:new THREE.Vector3(2.6,.1,-.9),squareCount:4,layout:[[1,1,1],[1,0,0]]},{id:7,startPosition:new THREE.Vector3(3.1,.1,-.9),squareCount:4,layout:[[1,1,1],[0,1,0]]},{id:6,startPosition:new THREE.Vector3(3.6,.1,-.9),squareCount:4,layout:[[1,1,0],[0,1,1]]},{id:5,startPosition:new THREE.Vector3(4.1,.1,-.9),squareCount:4,layout:[[1,1],[1,1]]},{id:4,startPosition:new THREE.Vector3(2.2,.1,-1.7),squareCount:3,layout:[[1,1,1]]},{id:3,startPosition:new THREE.Vector3(2.6,.1,-1.7),squareCount:3,layout:[[1,1],[1,0]]},{id:2,startPosition:new THREE.Vector3(3,.1,-1.7),squareCount:2,layout:[[1,1]]},{id:1,startPosition:new THREE.Vector3(3.3,.1,-1.7),squareCount:1,layout:[[1]]}],ht=dt.offsetWidth,mt=dt.offsetHeight,Et=.2,ft=.2,bt=.04,wt=20,kt=20,Dt=.6;for(gapi.hangout.data.onMessageReceived.add(function(e){var a,n;return e.senderId===t.me.id?void console.log("from me"):(n=o(e.message),void("block.mousemove"===n.name?(a=c(n.b.id),j=new TWEEN.Tween(a.position).to({x:n.b.p[0],y:n.b.p[1],z:n.b.p[2]},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null}).start()):"block.keydown.left"===n.name?(a=c(n.b.id),J=new TWEEN.Tween(a.rotation).to({y:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start()):"block.keydown.up"===n.name?(a=c(n.b.id),J=new TWEEN.Tween(a.rotation).to({z:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start()):"block.keydown.right"===n.name?(a=c(n.b.id),J=new TWEEN.Tween(a.rotation).to({y:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start()):"block.keydown.down"===n.name&&(a=c(n.b.id),J=new TWEEN.Tween(a.rotation).to({z:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start())))}),t.getBlockById=function(e){var o,a,n,s;for(s=t.state.blocksBlue,o=0,a=s.length;a>o;o++)if(n=s[o],n.id===e)return n;for(s=t.state.blocksGreen,o=0,a=s.length;a>o;o++)if(n=s[o],n.id===e)return n;for(s=t.state.blocksRed,o=0,a=s.length;a>o;o++)if(n=s[o],n.id===e)return n;for(s=t.state.blocksYellow,o=0,a=s.length;a>o;o++)if(n=s[o],n.id===e)return n;return null},t.syncBoardWithState=function(){var e,o,a,n,s,r;for(r=t.state.board,e=0,o=r.length;o>e;e++)for(a=0,n=r[e].length;n>a;a++)s=r[e][a],t.syncBoardSquare(Q[e][a],s,!0)},t.syncBoardSquare=function(t,e,o){o?t.userData.block=c(e.b):t.b=e.userData.block.userData.id},t.syncBlocksWithState=function(e){var o,a,n;if(e)for(o=0,a=e.length;a>o;o++)n=e[o],t.syncBlock(c(n.id),n,!0)},t.syncBlock=function(e,o,a){a?(e.userData.layout=o.l,e.position.x=o.p[0],e.position.y=o.p[1],e.position.z=o.p[2],e.rotation.x=o.r[0],e.rotation.y=o.r[1],e.rotation.z=o.r[2],e.startPosition.x=o.sp[0],e.startPosition.y=o.sp[1],e.startPosition.z=o.sp[2],e.startRotation.x=o.sr[0],e.startRotation.y=o.sr[1],e.startRotation.z=o.sr[2],e.isRotated=o.ir,e.userData.isPlaced=o.ip):(e.l=o.userData.layout,e.p[0]=Math.round(1e3*o.position.x)/1e3,e.p[1]=Math.round(1e3*o.position.y)/1e3,e.p[2]=Math.round(1e3*o.position.z)/1e3,e.r[0]=Math.round(1e3*o.rotation.x)/1e3,e.r[1]=Math.round(1e3*o.rotation.y)/1e3,e.r[2]=Math.round(1e3*o.rotation.z)/1e3,e.sp[0]=Math.round(1e3*o.startPosition.x)/1e3,e.sp[1]=Math.round(1e3*o.startPosition.y)/1e3,e.sp[2]=Math.round(1e3*o.startPosition.z)/1e3,e.sr[0]=Math.round(1e3*o.startRotation.x)/1e3,e.sr[1]=Math.round(1e3*o.startRotation.y)/1e3,e.sr[2]=Math.round(1e3*o.startRotation.z)/1e3,e.ir=o.isRotated,e.ip=o.userData.isPlaced,t.$apply())},B=new THREE.WebGLRenderer,B.setSize(ht,mt),B.setClearColor(16777215),B.shadowMap.enabled=!0,k=new THREE.Scene,D=new THREE.PerspectiveCamera(45,ht/mt,.1,1e3),D.position.x=6,D.position.y=6,D.position.z=6,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0)),R=ct.getElementById("view-1"),P=ct.getElementById("view-2"),T=ct.getElementById("view-3"),R.addEventListener("click",function(t){D.position.x=0,D.position.y=10,D.position.z=0,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),P.addEventListener("click",function(t){D.position.x=0,D.position.y=6,D.position.z=9,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),T.addEventListener("click",function(t){D.position.x=6,D.position.y=6,D.position.z=6,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),ut.addEventListener("resize",p,!1),O=new THREE.TrackballControls(D),O.rotateSpeed=1,O.zoomSpeed=1.2,O.panSpeed=.3,O.noZoom=!1,O.noPan=!1,O.noRotate=!1,O.staticMoving=!1,O.dynamicDampingFactor=.3,v=[],x=0,v[x]=new THREE.DirectionalLight(16777215,.25),v[x].position.x=-50,v[x].position.y=50,v[x].position.z=-50,v[x].castShadow=!0,k.add(v[x]),x=1,v[x]=new THREE.DirectionalLight(16777215,.25),v[x].position.x=50,v[x].position.y=50,v[x].position.z=50,v[x].castShadow=!0,k.add(v[x]),x=2,v[x]=new THREE.DirectionalLight(16777215,.25),v[x].position.x=-50,v[x].position.y=50,v[x].position.z=50,v[x].castShadow=!0,k.add(v[x]),x=3,v[x]=new THREE.DirectionalLight(16777215,.25),v[x].position.x=50,v[x].position.y=50,v[x].position.z=-50,v[x].castShadow=!0,k.add(v[x]),x=4,v[x]=new THREE.DirectionalLight(16777215,.25),v[x].position.x=0,v[x].position.y=-50,v[x].position.z=0,v[x].castShadow=!0,k.add(v[x]),z=new THREE.AmbientLight(5263440),k.add(z),Q=[],I=pt.parse({metadata:{},scale:1,materials:[],vertices:[-.1,0,.1,-.1,.01,.1,-.1,0,-.1,-.1,.01,-.1,.1,0,.1,.1,.01,.1,.1,0,-.1,.1,.01,-.1,.0975,.01,.0975,-.0975,.01,.0975,.0975,.01,-.0975,-.0975,.01,-.0975,.095,0,.095,-.095,0,.095,.095,0,-.095,-.095,0,-.095],morphTargets:[],morphColors:[],normals:[-1,0,0,0,0,-1,1,0,0,0,0,1,0,-1,0,0,1,0,-.9701,.2425,0,0,.2425,.9701,0,.2425,-.9701,.9701,.2425,0],colors:[],uvs:[[]],faces:[35,1,3,2,0,0,0,0,0,0,35,3,7,6,2,0,1,1,1,1,35,7,5,4,6,0,2,2,2,2,35,5,1,0,4,0,3,3,3,3,35,0,2,6,4,0,4,4,4,4,35,9,11,3,1,0,5,5,5,5,35,5,8,9,1,0,5,5,5,5,35,5,7,10,8,0,5,5,5,5,35,8,10,14,12,0,6,6,6,6,35,10,7,3,11,0,5,5,5,5,35,12,14,15,13,0,5,5,5,5,35,10,11,15,14,0,7,7,7,7,35,9,8,12,13,0,8,8,8,8,35,11,9,13,15,0,9,9,9,9]}).geometry,F=0,_=wt;_>F;F++)for(Q[F]=[],U=0,X=kt;X>U;U++)V=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),W=new THREE.Mesh(I,V),W.position.x=F*Et-wt*Et/2+Et/2,W.position.z=U*ft-kt*ft/2+ft/2,W.castShadow=!0,W.receiveShadow=!1,W.userData.xIndex=F,W.userData.zIndex=U,W.userData.block=null,W.userData.square=null,Q[F][U]=W,k.add(W),t.state.board[F]||(t.state.board[F]=[]),t.state.board[F][U]||(t.state.board[F][U]={b:null});A=new THREE.BoxGeometry(wt*Et,Dt,kt*ft),q=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),L=new THREE.Mesh(A,q),L.position.y=-(Dt/2)-1e-4,k.add(L);var Rt,Pt,Tt,Bt,vt,xt,zt;for(it in t.state.colors)for(lt=t.state.colors[it],Z=0,K=gt.length;K>Z;Z++){for(Pt=gt[Z],Rt=new THREE.Group,Rt.userData.id=lt.i+"-"+Pt.id,Rt.userData.layout=JSON.parse(JSON.stringify(Pt.layout)),Rt.userData.squareCount=Pt.squareCount,Rt.userData.colorAgent=lt,Rt.userData.color=it,Rt.userData.isPlaced=!1,Tt=Rt.userData.layout.length,Bt=Rt.userData.layout[0].length,F=0,_=Pt.layout.length;_>F;F++)for(vt=Pt.layout[F],U=0,X=vt.length;X>U;U++)xt=vt[U],xt&&(G=pt.parse({metadata:{},scale:1,materials:[],vertices:[.1,.01,-.1,-.1,.01,.1,.1,.01,.1,-.1,.01,-.1,-.1,.03,.1,.1,.03,.1,-.1,.03,-.1,.1,.03,-.1,-.0925,.03,.0925,-.0925,.03,-.0925,.0925,.03,.0925,.0925,.03,-.0925,-.0925,.04,.0925,-.0925,.04,-.0925,.0925,.04,.0925,.0925,.04,-.0925,-.0925,.01,.0925,.0925,.01,.0925,-.0925,.01,-.0925,.0925,.01,-.0925,-.0925,0,.0925,.0925,0,.0925,-.0925,0,-.0925,.0925,0,-.0925,-.065,.04,.065,-.065,.04,-.065,.065,.04,.065,.065,.04,-.065,-.065,.03,.065,-.065,.03,-.065,.065,.03,.065,.065,.03,-.065,-.065,0,.065,.065,0,.065,-.065,0,-.065,.065,0,-.065,-.065,.01,.065,.065,.01,.065,-.065,.01,-.065,.065,.01,-.065],morphTargets:[],morphColors:[],normals:[0,0,-1,0,0,1,1,0,0,-1,0,0,0,1,0,0,-1,0],colors:[],uvs:[[]],faces:[35,0,3,6,7,0,0,0,0,0,35,1,2,5,4,0,1,1,1,1,35,2,0,7,5,0,2,2,2,2,35,3,1,4,6,0,3,3,3,3,35,9,11,7,6,0,4,4,4,4,35,4,8,9,6,0,4,4,4,4,35,4,5,10,8,0,4,4,4,4,35,11,9,13,15,0,0,0,0,0,35,10,5,7,11,0,4,4,4,4,35,10,11,15,14,0,2,2,2,2,35,9,8,12,13,0,3,3,3,3,35,8,10,14,12,0,1,1,1,1,35,17,19,0,2,0,5,5,5,5,35,1,16,17,2,0,5,5,5,5,35,1,3,18,16,0,5,5,5,5,35,17,16,20,21,0,1,1,1,1,35,18,3,0,19,0,5,5,5,5,35,16,18,22,20,0,3,3,3,3,35,19,17,21,23,0,2,2,2,2,35,18,19,23,22,0,0,0,0,0,35,25,27,15,13,0,4,4,4,4,35,12,24,25,13,0,4,4,4,4,35,12,14,26,24,0,4,4,4,4,35,24,26,30,28,0,0,0,0,0,35,26,14,15,27,0,4,4,4,4,35,28,30,31,29,0,4,4,4,4,35,26,27,31,30,0,3,3,3,3,35,27,25,29,31,0,1,1,1,1,35,25,24,28,29,0,2,2,2,2,35,33,35,23,21,0,5,5,5,5,35,20,32,33,21,0,5,5,5,5,35,20,22,34,32,0,5,5,5,5,35,33,32,36,37,0,0,0,0,0,35,34,22,23,35,0,5,5,5,5,35,36,38,39,37,0,5,5,5,5,35,32,34,38,36,0,2,2,2,2,35,34,35,39,38,0,1,1,1,1,35,35,33,37,39,0,3,3,3,3]}).geometry,$=new THREE.MeshPhongMaterial({color:Rt.userData.colorAgent.hex,transparent:!0,opacity:.75,shininess:75,side:THREE.DoubleSide}),Y=new THREE.Mesh(G,$),Y.position.x=F*Et-Tt*Et/2+Et/2,Y.position.z=U*ft-Bt*ft/2+ft/2,Y.position.y=-bt/2,Y.userData.xIndex=F,Y.userData.zIndex=U,Rt.add(Y));Rt.startPosition=new THREE.Vector3,Rt.startRotation=new THREE.Vector3,Rt.upperBoundary=new THREE.Vector3,Rt.lowerBoundary=new THREE.Vector3,Rt.isRotated=!1,"blue"===it?(Rt.startPosition.x=Pt.startPosition.x,Rt.startPosition.y=Pt.startPosition.y,Rt.startPosition.z=Pt.startPosition.z,Rt.upperBoundary.x=8,Rt.lowerBoundary.x=2.2,Rt.upperBoundary.z=2.4,Rt.lowerBoundary.z=-2.4,Rt.startRotation.y=0):"green"===it?(Rt.startPosition.x=-Pt.startPosition.x,Rt.startPosition.y=Pt.startPosition.y,Rt.startPosition.z=-Pt.startPosition.z,Rt.upperBoundary.x=-2.2,Rt.lowerBoundary.x=-8,Rt.upperBoundary.z=2.4,Rt.lowerBoundary.z=-2.4,Rt.startRotation.y=Math.PI,Rt.userData.layout=s(s(Rt.userData.layout))):"red"===it?(Rt.startPosition.x=-Pt.startPosition.z,Rt.startPosition.y=Pt.startPosition.y,Rt.startPosition.z=Pt.startPosition.x,Rt.upperBoundary.x=2.4,Rt.lowerBoundary.x=-2.4,Rt.upperBoundary.z=8,Rt.lowerBoundary.z=2.2,Rt.startRotation.y=Math.PI+Math.PI/2,Rt.userData.layout=r(Rt.userData.layout),Rt.isRotated=!0):"yellow"===it&&(Rt.startPosition.x=Pt.startPosition.z,Rt.startPosition.y=Pt.startPosition.y,Rt.startPosition.z=-Pt.startPosition.x,Rt.upperBoundary.x=2.4,Rt.lowerBoundary.x=-2.4,Rt.upperBoundary.z=-2.2,Rt.lowerBoundary.z=-8,Rt.startRotation.y=Math.PI/2,Rt.userData.layout=s(Rt.userData.layout),Rt.isRotated=!0),Rt.position.x=Rt.startPosition.x,Rt.position.y=Rt.startPosition.y,Rt.position.z=Rt.startPosition.z,Rt.rotation.y=Rt.startRotation.y,Rt.castShadow=!0,Rt.receiveShadow=!1,yt.push(Rt),k.add(Rt),window.blocks=yt,t.getBlockById(Rt.userData.id)||("blue"===it?zt=t.state.blocksBlue:"green"===it?zt=t.state.blocksGreen:"red"===it?zt=t.state.blocksRed:"yellow"===it&&(zt=t.state.blocksYellow),zt.push({id:Rt.userData.id,l:Rt.userData.layout,sp:[Math.round(1e3*Rt.startPosition.x)/1e3,Math.round(1e3*Rt.startPosition.y)/1e3,Math.round(1e3*Rt.startPosition.z)/1e3],sr:[Math.round(1e3*Rt.startRotation.x)/1e3,Math.round(1e3*Rt.startRotation.y)/1e3,Math.round(1e3*Rt.startRotation.z)/1e3],p:[Math.round(1e3*Rt.position.x)/1e3,Math.round(1e3*Rt.position.y)/1e3,Math.round(1e3*Rt.position.z)/1e3],r:[Math.round(1e3*Rt.rotation.x)/1e3,Math.round(1e3*Rt.rotation.y)/1e3,Math.round(1e3*Rt.rotation.z)/1e3],ir:Rt.isRotated,ip:!1}))}S=new THREE.Raycaster,N=new THREE.Vector2,C=new THREE.Plane(new THREE.Vector3(0,1,0)),H=new THREE.Vector3,M=new THREE.Vector3,B.domElement.addEventListener("mouseenter",y,!1),B.domElement.addEventListener("mousemove",g,!1),B.domElement.addEventListener("mousedown",h,!1),B.domElement.addEventListener("mouseup",m,!1),document.addEventListener("keydown",E,!1),dt.appendChild(B.domElement),b()}]),t}),define("events",[],function(){var t={},e={};return{on:function(o,a,n){if(e[o]){if(!n)return;try{a(e[o])}catch(s){console.error(s)}}t[o]||(t[o]=[]),t[o].push(a)},off:function(e,o){var a;if(t[e]&&t[e].length)for(a=t[e].length-1;a>=0;a--)t[e][a]===o&&t[e][a].splice(a,1)},trigger:function(o,a){var n,s,r;if(e[o]=a,t[o]&&t[o].length)for(n=0,s=t[o].length;s>n;n++)if(r=t[o][n])try{r(a)}catch(i){console.error(i)}return!0}}}),require(["app","events"],function(t,e){var o=new Promise(function(t,e){gapi.hangout.onApiReady.add(function(e){e.isApiReady&&t()})});o.then(function(){angular.bootstrap(document,["app"]),$("body").fadeIn()})}),define("main",function(){});