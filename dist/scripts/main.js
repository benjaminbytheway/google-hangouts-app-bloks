define("app",[],function(){var t,e=function(t){var e,o={};for(e in t)if(t.hasOwnProperty(e))try{o[e]=JSON.parse(t[e])}catch(a){}return o},o=function(t){try{return JSON.parse(t)}catch(e){}return null},a=function(t){try{return JSON.stringify(t)}catch(e){}return""},n={LOBBY:1,CHOOSE_COLOR:2,PLAY:3,DETERMINE_WINNER:4,CONGRATULATIONS:5};return t=angular.module("app",[]),t.run(["$rootScope",function(t){function r(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(o=0;n>o;o++){for(e=a-1;e>=0;e--)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function s(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(o=n-1;o>=0;o--){for(e=0;a>e;e++)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function i(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(e=a-1;e>=0;e--){for(o=0;n>o;o++)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function l(t){var e,o,a=t.length,n=t[0].length,r=0,s=0,i=[];for(e=0;a>e;e++){for(o=n-1;o>=0;o--)i[r]||(i[r]=[]),i[r][s]=t[e][o],s++;r++,s=0}return i}function u(t,e,o){var a,n,r,s,i=t.userData.layout,l=i.length,u=i[0].length,c=!0,d=!0,p=!1,y=!1;for(a=0,n=l;n>a;a++){for(r=0,s=u;s>r;r++){if(Q[e+a]&&Q[e+a][o+r]||(c=!1),Q[e+a]&&Q[e+a][o+r]&&Q[e+a][o+r].userData.block&&i[a][r]){d=!1;break}e+a!==0&&e+a!==19||o+r!==0&&o+r!==19||!i[a]||!i[a][r]||(y=!0),Q[e+a]&&Q[e+a][o+r]&&i[a]&&i[a][r]&&(Q[e+a-1]&&Q[e+a-1][o+r-1]&&Q[e+a-1][o+r-1].userData.block&&Q[e+a-1][o+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a+1]&&Q[e+a+1][o+r-1]&&Q[e+a+1][o+r-1].userData.block&&Q[e+a+1][o+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a-1]&&Q[e+a-1][o+r+1]&&Q[e+a-1][o+r+1].userData.block&&Q[e+a-1][o+r+1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a+1]&&Q[e+a+1][o+r+1]&&Q[e+a+1][o+r+1].userData.block&&Q[e+a+1][o+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(y=!0),Q[e+a]&&Q[e+a][o+r]&&i[a]&&i[a][r]&&(Q[e+a-1]&&Q[e+a-1][o+r]&&Q[e+a-1][o+r].userData.block&&Q[e+a-1][o+r].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a+1]&&Q[e+a+1][o+r]&&Q[e+a+1][o+r].userData.block&&Q[e+a+1][o+r].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a]&&Q[e+a][o+r-1]&&Q[e+a][o+r-1].userData.block&&Q[e+a][o+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||Q[e+a]&&Q[e+a][o+r+1]&&Q[e+a][o+r+1].userData.block&&Q[e+a][o+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(p=!0)}if(!c||!d||p)break}return c&&d&&!p&&y}function c(t){var e,o,a;for(e=0,o=yt.length;o>e;e++)if(a=yt[e],a.userData.id===t)return a;return!1}function d(t){try{gapi.hangout.data.sendMessage(a(t))}catch(e){}}function p(){gt=dt.offsetWidth,ht=dt.offsetHeight,D.aspect=gt/ht,D.updateProjectionMatrix(),B.setSize(gt,ht)}function y(t){ut.focus()}function m(t){var e,o,a,n;t.preventDefault(),W.x=t.clientX/gt*2-1,W.y=2*-(t.clientY/ht)+1,rt=null,st=null,z.setFromCamera(W,D),at&&nt?z.ray.intersectPlane(M,S)&&(nt.position.copy(S.sub(H)),a=nt.userData.layout.length,n=nt.userData.layout[0].length,rt=Math.floor((S.x+wt*Et/2-a*Et/2+Et/2)/Et),st=Math.floor((S.z+kt*ft/2-n*ft/2+ft/2)/ft),k.remove(tt),Q[rt]&&Q[rt][st]&&(et=Q[rt][st],u(nt,rt,st)&&(tt=nt.clone(),tt.position.copy(et.position),tt.position.x=tt.position.x+a*Et/2-Et/2,tt.position.z=tt.position.z+n*ft/2-ft/2,tt.position.y=tt.position.y+bt/2,k.add(tt))),d({name:"block.mousemove",b:{id:nt.userData.id,p:[nt.position.x,nt.position.y,nt.position.z]}})):(o=z.intersectObjects(yt,!0),o.length>0?(e=o[0],ot=e.object.parent?e.object.parent:e.object,ot.userData.isPlaced?dt.style.cursor="auto":dt.style.cursor="move"):(ot=null,dt.style.cursor="auto"))}function g(t){var e,o;if(t.preventDefault(),z.setFromCamera(W,D),o=z.intersectObjects(yt,!0),o.length>0){if(e=o[0],N.enabled=!1,at=e.object,e.object.parent&&(nt=e.object.parent),nt.userData.isPlaced)return nt=null,void(at=null);z.ray.intersectPlane(M,S)&&H.copy(S).sub(nt.position)}dt.style.cursor="move"}function h(e){var o,a,n,r,s,i;if(e.preventDefault(),N.enabled=!0,at&&nt)if(i=nt,void 0!==rt&&null!==rt&&void 0!==st&&null!==st&&u(nt,rt,st)){for(et=Q[rt][st],o=0,a=nt.userData.layout.length;a>o;o++)for(U=0,X=nt.userData.layout[o].length;X>U;U++)nt.userData.layout[o][U]&&(Q[rt+o][st+U].userData.block=nt,t.syncBoardSquare(t.state.board[rt+o][st+U],Q[rt+o][st+U],!1));n=nt.userData.layout.length,r=nt.userData.layout[0].length,J=new TWEEN.Tween(nt.position).to({x:et.position.x+n*Et/2-Et/2,z:et.position.z+r*ft/2-ft/2,y:et.position.y+bt/2},200).easing(TWEEN.Easing.Bounce.Out).onComplete(function(){J=null,t.syncBlock(t.getBlockById(i.userData.id),i,!1),t.droppedBlock=i,t.showConfirmDropModal=!0,t.$apply()}).start(),nt.userData.isPlaced=!0,at=null,nt=null,k.remove(tt)}else nt.position.x>nt.lowerBoundary.x&&nt.position.x<nt.upperBoundary.x&&nt.position.z>nt.lowerBoundary.z&&nt.position.z<nt.upperBoundary.z&&(nt.startPosition.x=nt.position.x,nt.startPosition.z=nt.position.z),s=nt.startPosition,J=new TWEEN.Tween(nt.position).to({x:s.x,z:s.z,y:s.y},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null,t.syncBlock(t.getBlockById(i.userData.id),i,!1)}).start(),k.remove(tt);ot&&(at=null,nt=null)}function E(e){var o,a,n;e.preventDefault(),nt&&!j&&(n=nt,37===e.keyCode||65===e.keyCode?(n.isRotated=!n.isRotated,n.userData.layout=r(n.userData.layout),a=n.rotation.y,j=new TWEEN.Tween(n.rotation).to({y:a+Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),j=null,n=null}).start(),d({name:"block.keydown.left",b:{id:n.userData.id,r:a+Math.PI/2}})):38===e.keyCode||87===e.keyCode?(n.isRotated?n.userData.layout=l(n.userData.layout):n.userData.layout=i(n.userData.layout),o=n.rotation.z,j=new TWEEN.Tween(n.rotation).to({z:o+Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),j=null,n=null}).start(),d({name:"block.keydown.up",b:{id:n.userData.id,r:o+Math.PI}})):39===e.keyCode||83===e.keyCode?(n.isRotated=!n.isRotated,n.userData.layout=s(n.userData.layout),a=n.rotation.y,j=new TWEEN.Tween(n.rotation).to({y:a-Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),j=null,n=null}).start(),d({name:"block.keydown.right",b:{id:n.userData.id,r:a-Math.PI/2}})):(40===e.keyCode||68===e.keyCode)&&(n.isRotated?n.userData.layout=l(n.userData.layout):n.userData.layout=i(n.userData.layout),o=n.rotation.z,j=new TWEEN.Tween(n.rotation).to({z:o-Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){t.syncBlock(t.getBlockById(n.userData.id),n,!1),j=null,n=null}).start(),d({name:"block.keydown.down",b:{id:n.userData.id,r:o-Math.PI}})))}function f(){N.update(),B.render(k,D)}function b(e){requestAnimationFrame(b),TWEEN.update(e),t&&t.state&&t.state.game&&t.state.game.currentStage&&t.state.game.currentStage===n.PLAY&&f()}var w={game:!1,players:!1,host:!1,colors:!1,board:!1,blocksBlue:!1,blocksGreen:!1,blocksRed:!1,blocksYellow:!1};t.me=gapi.hangout.getLocalParticipant(),t.state=e(gapi.hangout.data.getState())||{},t.metadata=gapi.hangout.data.getStateMetadata()||{},t.state.game||(t.state.game={}),t.state.game.currentStage||(t.state.game.currentStage=n.LOBBY),t.state.players||(t.state.players=[]),gapi.hangout.data.onStateChanged.add(function(o){var n,r,s,i;i=e(o.state),w={game:!0,players:!0,host:!0,colors:!0,board:!0,blocksBlue:!0,blocksGreen:!0,blocksRed:!0,blocksYellow:!0},setTimeout(function(){w&&(w={game:!1,players:!1,host:!1,colors:!1,board:!1,blocksBlue:!1,blocksGreen:!1,blocksRed:!1,blocksYellow:!1})},0),"{}"===a(i)&&(t.state={});for(n in i)r=i[n],s=o.metadata[n],s.lastWriter!==t.me.id?"game"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r,t.state.game.currentColor&&t.state.colors[t.state.game.currentColor]&&t.state.colors[t.state.game.currentColor].id&&t.me.person.id===t.state.colors[t.state.game.currentColor].id&&(t.canTakeTurn(t.state.game.currentColor)?gapi.hangout.layout.displayNotice("It is your turn!"):(gapi.hangout.layout.displayNotice("Sorry, you don't have any more moves left."),t.nextColor()))):"players"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r):"host"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r):"colors"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r):"board"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r,t.syncBoardWithState()):"blocksBlue"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r,t.syncBlocksWithState(t.state[n])):"blocksGreen"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r,t.syncBlocksWithState(t.state[n])):"blocksRed"===n&&s?t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r,t.syncBlocksWithState(t.state[n])):"blocksYellow"===n&&s&&(t.metadata[n]&&t.metadata[n].timestamp===s.timestamp||(t.metadata[n]=s,t.state[n]=r,t.syncBlocksWithState(t.state[n]))):t.metadata[n]=s;window.state=i,t.$apply()}),t.$watch("state.game",function(e,o,n){w.game?w.game=!1:t.state&&t.state.game&&gapi.hangout.data.submitDelta({game:a(t.state.game)})},!0),t.$watch("state.players",function(e,o,n){w.players?w.players=!1:t.state&&t.state.players&&gapi.hangout.data.submitDelta({players:a(t.state.players)})},!0),t.$watch("state.host",function(e,o,n){w.host?w.host=!1:t.state&&t.state.host&&gapi.hangout.data.submitDelta({host:a(t.state.host)})},!0),t.$watch("state.colors",function(e,o,n){w.colors?w.colors=!1:t.state&&t.state.colors&&gapi.hangout.data.submitDelta({colors:a(t.state.colors)})},!0),t.$watch("state.board",function(e,o,n){w.board?w.board=!1:t.state&&t.state.board&&gapi.hangout.data.submitDelta({board:a(t.state.board)})},!0),t.$watch("state.blocksBlue",function(e,o,n){w.blocksBlue?w.blocksBlue=!1:t.state&&t.state.blocksBlue&&gapi.hangout.data.submitDelta({blocksBlue:a(t.state.blocksBlue)})},!0),t.$watch("state.blocksGreen",function(e,o,n){w.blocksGreen?w.blocksGreen=!1:t.state&&t.state.blocksGreen&&gapi.hangout.data.submitDelta({blocksGreen:a(t.state.blocksGreen)})},!0),t.$watch("state.blocksRed",function(e,o,n){w.blocksRed?w.blocksRed=!1:t.state&&t.state.blocksRed&&gapi.hangout.data.submitDelta({blocksRed:a(t.state.blocksRed)})},!0),t.$watch("state.blocksYellow",function(e,o,n){w.blocksYellow?w.blocksYellow=!1:t.state&&t.state.blocksYellow&&gapi.hangout.data.submitDelta({blocksYellow:a(t.state.blocksYellow)})},!0),t.computers=0,t.addPlayer=function(e){var o,a;if(a=t.state.players,e.player&&e.player.id&&a.length<4&&!t.findPlayerById(e.player.id)){if(o={},!e.player.type)throw new Error("config.player.type was not provided");if(o.type=e.player.type,"human"===o.type){if(!e.player.id)throw new Error("config.player.id was not provided");if(o.id=e.player.id,!e.player.name)throw new Error("config.player.name was not provided");o.name=e.player.name,e.player.image&&(o.image=e.player.image)}else{if("computer"!==o.type)throw new Error('config.player.type is not a supported type (either "human", or "computer")');o.id="computer-"+Math.floor(1e4*Math.random()),o.name="Computer "+t.computers+1}return a.push(o),t.state.host||"human"!==o.type||(t.state.host=o),!0}return!1},t.findPlayerById=function(e){var o,a,n,r;if(r=t.state.players,!r)return null;for(o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;return null},t.removePlayer=function(e){var o,a,n;if(n=t.state.players,!e.player)return!1;for(o=n.length-1;o>=0;o--)if(n[o]===e.player)return a=n.splice(o,1),!0;return!1},t.showLeaveModal=!1,t.leave=function(){var e,o,a,n,r=!1;if(n=t.state.players,t.state.host&&t.state.host.id===t.me.person.id&&(r=!0),r)for(t.state.host=null,e=0,o=n.length;o>e;e++)if(a=n[e],t.me.person.id!==a.id&&"human"===a.type){t.state.host=a;break}t.removePlayer({player:t.findPlayerById(t.me.person.id)})},gapi.hangout.onParticipantsDisabled.add(function(e){var o,a,n,r,s,i,l=!1,u=!1;if(i=t.state.players,t.state.host)for(o=0,a=e.disabledParticipants.length;a>o;o++)if(r=e.disabledParticipants[o],r.person.id===t.state.host.id){l=!0;break}if(l)for(o=0,a=i.length;a>o;o++)if(s=i[o],t.me.person.id===s.id&&"human"===s.type&&t.state.host.id!==s.id){t.state.host=s;break}if(t.state.host&&t.state.host.id===t.me.person.id&&(u=!0),u)for(o=0,a=e.disabledParticipants.length;a>o;o++)for(r=e.disabledParticipants[o],n=i.length-1;n>=0;n--)if(s=i[n],r.person.id===s.id){t.removePlayer({player:s});break}t.$apply()}),t.join=function(){t.addPlayer({player:{type:"human",id:t.me.person.id,name:t.me.person.displayName,image:t.me.person.image.url}})},t.begin=function(){t.state.game.currentStage=n.CHOOSE_COLOR},t.isPlayer=function(){var e,o,a,n;for(o=t.state.players,a=0,n=o.length;n>a;a++)if(e=o[a],t.me.person.id===e.id)return!0;return!1},t.state.colors||(t.state.colors={blue:{i:"b",color:"blue",label:"Blue",hex:255},green:{i:"g",color:"green",label:"Green",hex:65280},yellow:{i:"y",color:"yellow",label:"Yellow",hex:16776960},red:{i:"r",color:"red",label:"Red",hex:16711680}}),t.chooseColor=function(e){var o,a,n,r,s,i,l,u;if(n=t.state.colors,o=t.state.players,t.myRemainingColors()&&!n[e].id&&(a=n[e],a.type=1,a.id=t.me.person.id),3===o.length&&3===t.displayChoosenColors().length){for(e in n)if(a=n[e],!a.id)break;for(i=[],l=0,u=o.length;u>l;l++){s=o[l];do r=Math.floor(3*Math.random());while(i[r]);i[r]=s.id}a.type=2,a.id=i[0],a.order=i,a.current=0}},t.myRemainingColors=function(){var e,o,a,n,r=0;if(a=t.state.colors,n=t.state.players,t.isPlayer()){2===n.length?r=2:(3===n.length||4===n.length)&&(r=1);for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&r--}return r},t.getMyColors=function(){var e,o,a,n=[];a=t.state.colors;for(o in a)e=a[o],1===e.type&&t.me.person.id===e.id&&n.push(e);return n},t.getSharedColor=function(){var e,o,a,n;if(n=t.state.players,3===n.length){a=t.state.colors;for(o in a)if(e=a[o],2===e.type)return e}return null},t.displayColors=function(){var e="",o=t.getMyColors(!0);return o[0]&&o[0].label&&(e=o[0].label,o[1]&&o[1].label&&(e+=" and "+o[1].label)),e},t.displayChoosenColors=function(){var e,o,a,n=[];o=t.state.colors;for(e in o)a=o[e],a.id&&n.push(a.color);return n},t.displaySharedColor=function(){var e=t.getSharedColor();return e&&e.label?e.label:!1},t.start=function(){t.state.game.currentColor=Object.keys(t.state.colors)[Math.floor(4*Math.random())],t.state.game.currentStage=n.PLAY},t.state.board?setTimeout(function(){t.syncBoardWithState()},100):t.state.board=[],t.state.blocksBlue?setTimeout(function(){t.syncBlocksWithState(t.state.blocksBlue)},100):t.state.blocksBlue=[],t.state.blocksGreen?setTimeout(function(){t.syncBlocksWithState(t.state.blocksGreen)},100):t.state.blocksGreen=[],t.state.blocksRed?setTimeout(function(){t.syncBlocksWithState(t.state.blocksRed)},100):t.state.blocksRed=[],t.state.blocksYellow?setTimeout(function(){t.syncBlocksWithState(t.state.blocksYellow)},100):t.state.blocksYellow=[];var k,D,R,T,P,B,x,v,C,z,M,H,S,W,N,I,O,V,A,q,L,Y,G,$,j,J,F,_,U,X,Z,K,Q,tt,et,ot,at,nt,rt,st,it,lt,ut=window,ct=document,dt=ct.getElementById("canvas-container"),pt=new THREE.JSONLoader,yt=[],mt=[{id:21,startPosition:new THREE.Vector3(2.2,.1,1.5),squareCount:5,layout:[[1,1,1,1,1]]},{id:20,startPosition:new THREE.Vector3(2.6,.1,1.5),squareCount:5,layout:[[1,1,1,1],[1,0,0,0]]},{id:19,startPosition:new THREE.Vector3(3.1,.1,1.5),squareCount:5,layout:[[1,1,1,1],[0,1,0,0]]},{id:18,startPosition:new THREE.Vector3(3.6,.1,1.5),squareCount:5,layout:[[0,1,1,1],[1,1,0,0]]},{id:17,startPosition:new THREE.Vector3(2.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,0],[1,0,0]]},{id:16,startPosition:new THREE.Vector3(3.1,.1,.6),squareCount:5,layout:[[0,1,1],[1,1,0],[1,0,0]]},{id:15,startPosition:new THREE.Vector3(3.8,.1,.6),squareCount:5,layout:[[0,1,1],[0,1,0],[1,1,0]]},{id:14,startPosition:new THREE.Vector3(2.4,.1,-.1),squareCount:5,layout:[[1,1,1],[0,1,0],[0,1,0]]},{id:13,startPosition:new THREE.Vector3(3.1,.1,-.1),squareCount:5,layout:[[0,1,1],[1,1,0],[0,1,0]]},{id:12,startPosition:new THREE.Vector3(3.8,.1,-.1),squareCount:5,layout:[[0,1,0],[1,1,1],[0,1,0]]},{id:11,startPosition:new THREE.Vector3(4.1,.1,1.5),squareCount:5,layout:[[1,1,1],[1,1,0]]},{id:10,startPosition:new THREE.Vector3(4.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,1]]},{id:9,startPosition:new THREE.Vector3(2.2,.1,-.9),squareCount:4,layout:[[1,1,1,1]]},{id:8,startPosition:new THREE.Vector3(2.6,.1,-.9),squareCount:4,layout:[[1,1,1],[1,0,0]]},{id:7,startPosition:new THREE.Vector3(3.1,.1,-.9),squareCount:4,layout:[[1,1,1],[0,1,0]]},{id:6,startPosition:new THREE.Vector3(3.6,.1,-.9),squareCount:4,layout:[[1,1,0],[0,1,1]]},{id:5,startPosition:new THREE.Vector3(4.1,.1,-.9),squareCount:4,layout:[[1,1],[1,1]]},{id:4,startPosition:new THREE.Vector3(2.2,.1,-1.7),squareCount:3,layout:[[1,1,1]]},{id:3,startPosition:new THREE.Vector3(2.6,.1,-1.7),squareCount:3,layout:[[1,1],[1,0]]},{id:2,startPosition:new THREE.Vector3(3,.1,-1.7),squareCount:2,layout:[[1,1]]},{id:1,startPosition:new THREE.Vector3(3.3,.1,-1.7),squareCount:1,layout:[[1]]}],gt=dt.offsetWidth,ht=dt.offsetHeight,Et=.2,ft=.2,bt=.04,wt=20,kt=20,Dt=.6;for(gapi.hangout.data.onMessageReceived.add(function(e){var a,n;return e.senderId===t.me.id?void console.log("from me"):(n=o(e.message),void("block.mousemove"===n.name?(a=c(n.b.id),J=new TWEEN.Tween(a.position).to({x:n.b.p[0],y:n.b.p[1],z:n.b.p[2]},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null}).start()):"block.keydown.left"===n.name?(a=c(n.b.id),j=new TWEEN.Tween(a.rotation).to({y:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null}).start()):"block.keydown.up"===n.name?(a=c(n.b.id),j=new TWEEN.Tween(a.rotation).to({z:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null}).start()):"block.keydown.right"===n.name?(a=c(n.b.id),j=new TWEEN.Tween(a.rotation).to({y:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null}).start()):"block.keydown.down"===n.name&&(a=c(n.b.id),j=new TWEEN.Tween(a.rotation).to({z:n.b.r},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null}).start())))}),t.getBlockById=function(e){var o,a,n,r;for(r=t.state.blocksBlue,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;for(r=t.state.blocksGreen,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;for(r=t.state.blocksRed,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;for(r=t.state.blocksYellow,o=0,a=r.length;a>o;o++)if(n=r[o],n.id===e)return n;return null},t.syncBoardWithState=function(){var e,o,a,n,r,s;for(s=t.state.board,e=0,o=s.length;o>e;e++)for(a=0,n=s[e].length;n>a;a++)r=s[e][a],t.syncBoardSquare(Q[e][a],r,!0)},t.syncBoardSquare=function(t,e,o){o?t.userData.block=c(e.b):t.b=e.userData.block.userData.id},t.syncBlocksWithState=function(e){var o,a,n;if(e)for(o=0,a=e.length;a>o;o++)n=e[o],t.syncBlock(c(n.id),n,!0)},t.syncBlock=function(e,o,a){a?(e.userData.layout=o.l,e.position.x=o.p[0],e.position.y=o.p[1],e.position.z=o.p[2],e.rotation.x=o.r[0],e.rotation.y=o.r[1],e.rotation.z=o.r[2],e.startPosition.x=o.sp[0],e.startPosition.y=o.sp[1],e.startPosition.z=o.sp[2],e.startRotation.x=o.sr[0],e.startRotation.y=o.sr[1],e.startRotation.z=o.sr[2],e.isRotated=o.ir,e.userData.isPlaced=o.ip):(e.l=o.userData.layout,e.p[0]=Math.round(1e3*o.position.x)/1e3,e.p[1]=Math.round(1e3*o.position.y)/1e3,e.p[2]=Math.round(1e3*o.position.z)/1e3,e.r[0]=Math.round(1e3*o.rotation.x)/1e3,e.r[1]=Math.round(1e3*o.rotation.y)/1e3,e.r[2]=Math.round(1e3*o.rotation.z)/1e3,e.sp[0]=Math.round(1e3*o.startPosition.x)/1e3,e.sp[1]=Math.round(1e3*o.startPosition.y)/1e3,e.sp[2]=Math.round(1e3*o.startPosition.z)/1e3,e.sr[0]=Math.round(1e3*o.startRotation.x)/1e3,e.sr[1]=Math.round(1e3*o.startRotation.y)/1e3,e.sr[2]=Math.round(1e3*o.startRotation.z)/1e3,e.ir=o.isRotated,e.ip=o.userData.isPlaced,t.$apply())},B=new THREE.WebGLRenderer,B.setSize(gt,ht),B.setClearColor(16777215),B.shadowMap.enabled=!0,k=new THREE.Scene,D=new THREE.PerspectiveCamera(45,gt/ht,.1,1e3),D.position.x=6,D.position.y=6,D.position.z=6,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0)),R=ct.getElementById("view-1"),T=ct.getElementById("view-2"),P=ct.getElementById("view-3"),R.addEventListener("click",function(t){D.position.x=0,D.position.y=10,D.position.z=0,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),T.addEventListener("click",function(t){D.position.x=0,D.position.y=6,D.position.z=9,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),P.addEventListener("click",function(t){D.position.x=6,D.position.y=6,D.position.z=6,D.rotation.x=0,D.rotation.y=0,D.rotation.z=0,D.lookAt(new THREE.Vector3(0,0,0))}),ut.addEventListener("resize",p,!1),N=new THREE.TrackballControls(D),N.rotateSpeed=1,N.zoomSpeed=1.2,N.panSpeed=.3,N.noZoom=!1,N.noPan=!1,N.noRotate=!1,N.staticMoving=!1,N.dynamicDampingFactor=.3,x=[],v=0,x[v]=new THREE.DirectionalLight(16777215,.25),x[v].position.x=-50,x[v].position.y=50,x[v].position.z=-50,x[v].castShadow=!0,k.add(x[v]),v=1,x[v]=new THREE.DirectionalLight(16777215,.25),x[v].position.x=50,x[v].position.y=50,x[v].position.z=50,x[v].castShadow=!0,k.add(x[v]),v=2,x[v]=new THREE.DirectionalLight(16777215,.25),x[v].position.x=-50,x[v].position.y=50,x[v].position.z=50,x[v].castShadow=!0,k.add(x[v]),v=3,x[v]=new THREE.DirectionalLight(16777215,.25),x[v].position.x=50,x[v].position.y=50,x[v].position.z=-50,x[v].castShadow=!0,k.add(x[v]),v=4,x[v]=new THREE.DirectionalLight(16777215,.25),x[v].position.x=0,x[v].position.y=-50,x[v].position.z=0,x[v].castShadow=!0,k.add(x[v]),C=new THREE.AmbientLight(5263440),k.add(C),Q=[],O=pt.parse({metadata:{},scale:1,materials:[],vertices:[-.1,0,.1,-.1,.01,.1,-.1,0,-.1,-.1,.01,-.1,.1,0,.1,.1,.01,.1,.1,0,-.1,.1,.01,-.1,.0975,.01,.0975,-.0975,.01,.0975,.0975,.01,-.0975,-.0975,.01,-.0975,.095,0,.095,-.095,0,.095,.095,0,-.095,-.095,0,-.095],morphTargets:[],morphColors:[],normals:[-1,0,0,0,0,-1,1,0,0,0,0,1,0,-1,0,0,1,0,-.9701,.2425,0,0,.2425,.9701,0,.2425,-.9701,.9701,.2425,0],colors:[],uvs:[[]],faces:[35,1,3,2,0,0,0,0,0,0,35,3,7,6,2,0,1,1,1,1,35,7,5,4,6,0,2,2,2,2,35,5,1,0,4,0,3,3,3,3,35,0,2,6,4,0,4,4,4,4,35,9,11,3,1,0,5,5,5,5,35,5,8,9,1,0,5,5,5,5,35,5,7,10,8,0,5,5,5,5,35,8,10,14,12,0,6,6,6,6,35,10,7,3,11,0,5,5,5,5,35,12,14,15,13,0,5,5,5,5,35,10,11,15,14,0,7,7,7,7,35,9,8,12,13,0,8,8,8,8,35,11,9,13,15,0,9,9,9,9]}).geometry,F=0,_=wt;_>F;F++)for(Q[F]=[],U=0,X=kt;X>U;U++)V=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),I=new THREE.Mesh(O,V),I.position.x=F*Et-wt*Et/2+Et/2,I.position.z=U*ft-kt*ft/2+ft/2,I.castShadow=!0,I.receiveShadow=!1,I.userData.xIndex=F,I.userData.zIndex=U,I.userData.block=null,I.userData.square=null,Q[F][U]=I,k.add(I),t.state.board[F]||(t.state.board[F]=[]),t.state.board[F][U]||(t.state.board[F][U]={b:null});A=new THREE.BoxGeometry(wt*Et,Dt,kt*ft),q=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),L=new THREE.Mesh(A,q),L.position.y=-(Dt/2)-1e-4,k.add(L);var Rt,Tt,Pt,Bt,xt,vt,Ct;for(it in t.state.colors)for(lt=t.state.colors[it],Z=0,K=mt.length;K>Z;Z++){for(Tt=mt[Z],Rt=new THREE.Group,Rt.userData.id=lt.i+"-"+Tt.id,Rt.userData.layout=JSON.parse(JSON.stringify(Tt.layout)),Rt.userData.squareCount=Tt.squareCount,Rt.userData.colorAgent=lt,Rt.userData.color=it,Rt.userData.isPlaced=!1,Pt=Rt.userData.layout.length,Bt=Rt.userData.layout[0].length,F=0,_=Tt.layout.length;_>F;F++)for(xt=Tt.layout[F],U=0,X=xt.length;X>U;U++)vt=xt[U],vt&&(G=pt.parse({metadata:{},scale:1,materials:[],vertices:[.1,.01,-.1,-.1,.01,.1,.1,.01,.1,-.1,.01,-.1,-.1,.03,.1,.1,.03,.1,-.1,.03,-.1,.1,.03,-.1,-.0925,.03,.0925,-.0925,.03,-.0925,.0925,.03,.0925,.0925,.03,-.0925,-.0925,.04,.0925,-.0925,.04,-.0925,.0925,.04,.0925,.0925,.04,-.0925,-.0925,.01,.0925,.0925,.01,.0925,-.0925,.01,-.0925,.0925,.01,-.0925,-.0925,0,.0925,.0925,0,.0925,-.0925,0,-.0925,.0925,0,-.0925,-.065,.04,.065,-.065,.04,-.065,.065,.04,.065,.065,.04,-.065,-.065,.03,.065,-.065,.03,-.065,.065,.03,.065,.065,.03,-.065,-.065,0,.065,.065,0,.065,-.065,0,-.065,.065,0,-.065,-.065,.01,.065,.065,.01,.065,-.065,.01,-.065,.065,.01,-.065],morphTargets:[],morphColors:[],normals:[0,0,-1,0,0,1,1,0,0,-1,0,0,0,1,0,0,-1,0],colors:[],uvs:[[]],faces:[35,0,3,6,7,0,0,0,0,0,35,1,2,5,4,0,1,1,1,1,35,2,0,7,5,0,2,2,2,2,35,3,1,4,6,0,3,3,3,3,35,9,11,7,6,0,4,4,4,4,35,4,8,9,6,0,4,4,4,4,35,4,5,10,8,0,4,4,4,4,35,11,9,13,15,0,0,0,0,0,35,10,5,7,11,0,4,4,4,4,35,10,11,15,14,0,2,2,2,2,35,9,8,12,13,0,3,3,3,3,35,8,10,14,12,0,1,1,1,1,35,17,19,0,2,0,5,5,5,5,35,1,16,17,2,0,5,5,5,5,35,1,3,18,16,0,5,5,5,5,35,17,16,20,21,0,1,1,1,1,35,18,3,0,19,0,5,5,5,5,35,16,18,22,20,0,3,3,3,3,35,19,17,21,23,0,2,2,2,2,35,18,19,23,22,0,0,0,0,0,35,25,27,15,13,0,4,4,4,4,35,12,24,25,13,0,4,4,4,4,35,12,14,26,24,0,4,4,4,4,35,24,26,30,28,0,0,0,0,0,35,26,14,15,27,0,4,4,4,4,35,28,30,31,29,0,4,4,4,4,35,26,27,31,30,0,3,3,3,3,35,27,25,29,31,0,1,1,1,1,35,25,24,28,29,0,2,2,2,2,35,33,35,23,21,0,5,5,5,5,35,20,32,33,21,0,5,5,5,5,35,20,22,34,32,0,5,5,5,5,35,33,32,36,37,0,0,0,0,0,35,34,22,23,35,0,5,5,5,5,35,36,38,39,37,0,5,5,5,5,35,32,34,38,36,0,2,2,2,2,35,34,35,39,38,0,1,1,1,1,35,35,33,37,39,0,3,3,3,3]}).geometry,$=new THREE.MeshPhongMaterial({color:Rt.userData.colorAgent.hex,transparent:!0,opacity:.75,shininess:75,side:THREE.DoubleSide}),Y=new THREE.Mesh(G,$),Y.position.x=F*Et-Pt*Et/2+Et/2,Y.position.z=U*ft-Bt*ft/2+ft/2,Y.position.y=-bt/2,Y.userData.xIndex=F,Y.userData.zIndex=U,Rt.add(Y));Rt.startPosition=new THREE.Vector3,Rt.startRotation=new THREE.Vector3,Rt.upperBoundary=new THREE.Vector3,Rt.lowerBoundary=new THREE.Vector3,Rt.isRotated=!1,"blue"===it?(Rt.startPosition.x=Tt.startPosition.x,Rt.startPosition.y=Tt.startPosition.y,Rt.startPosition.z=Tt.startPosition.z,Rt.upperBoundary.x=8,Rt.lowerBoundary.x=2.2,Rt.upperBoundary.z=2.4,Rt.lowerBoundary.z=-2.4,Rt.startRotation.y=0):"green"===it?(Rt.startPosition.x=-Tt.startPosition.x,Rt.startPosition.y=Tt.startPosition.y,Rt.startPosition.z=-Tt.startPosition.z,Rt.upperBoundary.x=-2.2,Rt.lowerBoundary.x=-8,Rt.upperBoundary.z=2.4,Rt.lowerBoundary.z=-2.4,Rt.startRotation.y=Math.PI,Rt.userData.layout=r(r(Rt.userData.layout))):"red"===it?(Rt.startPosition.x=-Tt.startPosition.z,Rt.startPosition.y=Tt.startPosition.y,Rt.startPosition.z=Tt.startPosition.x,Rt.upperBoundary.x=2.4,Rt.lowerBoundary.x=-2.4,Rt.upperBoundary.z=8,Rt.lowerBoundary.z=2.2,Rt.startRotation.y=Math.PI+Math.PI/2,Rt.userData.layout=s(Rt.userData.layout),Rt.isRotated=!0):"yellow"===it&&(Rt.startPosition.x=Tt.startPosition.z,Rt.startPosition.y=Tt.startPosition.y,Rt.startPosition.z=-Tt.startPosition.x,Rt.upperBoundary.x=2.4,Rt.lowerBoundary.x=-2.4,Rt.upperBoundary.z=-2.2,Rt.lowerBoundary.z=-8,Rt.startRotation.y=Math.PI/2,Rt.userData.layout=r(Rt.userData.layout),Rt.isRotated=!0),Rt.position.x=Rt.startPosition.x,Rt.position.y=Rt.startPosition.y,Rt.position.z=Rt.startPosition.z,Rt.rotation.y=Rt.startRotation.y,Rt.castShadow=!0,Rt.receiveShadow=!1,yt.push(Rt),k.add(Rt),window.blocks=yt,t.getBlockById(Rt.userData.id)||("blue"===it?Ct=t.state.blocksBlue:"green"===it?Ct=t.state.blocksGreen:"red"===it?Ct=t.state.blocksRed:"yellow"===it&&(Ct=t.state.blocksYellow),Ct.push({id:Rt.userData.id,l:Rt.userData.layout,sp:[Math.round(1e3*Rt.startPosition.x)/1e3,Math.round(1e3*Rt.startPosition.y)/1e3,Math.round(1e3*Rt.startPosition.z)/1e3],sr:[Math.round(1e3*Rt.startRotation.x)/1e3,Math.round(1e3*Rt.startRotation.y)/1e3,Math.round(1e3*Rt.startRotation.z)/1e3],p:[Math.round(1e3*Rt.position.x)/1e3,Math.round(1e3*Rt.position.y)/1e3,Math.round(1e3*Rt.position.z)/1e3],r:[Math.round(1e3*Rt.rotation.x)/1e3,Math.round(1e3*Rt.rotation.y)/1e3,Math.round(1e3*Rt.rotation.z)/1e3],ir:Rt.isRotated,ip:!1}))}z=new THREE.Raycaster,W=new THREE.Vector2,M=new THREE.Plane(new THREE.Vector3(0,1,0)),H=new THREE.Vector3,S=new THREE.Vector3,B.domElement.addEventListener("mouseenter",y,!1),B.domElement.addEventListener("mousemove",m,!1),B.domElement.addEventListener("mousedown",g,!1),B.domElement.addEventListener("mouseup",h,!1),document.addEventListener("keydown",E,!1),t.showConfirmDropModal=!1,t.droppedBlock=null,t.confirmDrop=function(){t.nextColor()},t.cancelDrop=function(){var e,o;o=t.droppedBlock,e=o.startPosition,J=new TWEEN.Tween(o.position).to({x:e.x,y:e.y,z:e.z},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){J=null,t.syncBlock(t.getBlockById(o.userData.id),o,!1),t.droppedBlock=null}).start()},t.nextColor=function(){var e,o;e=t.state.game.currentColor,"blue"===e?(e="green",t.state.game.currentColor=e,o=t.state.colors[e]):"green"===e?(e="red",t.state.game.currentColor=e,o=t.state.colors[e]):"red"===e?(e="yellow",t.state.game.currentColor=e,o=t.state.colors[e]):"yellow"===e&&(e="blue",t.state.game.currentColor=e,o=t.state.colors[e]),2===o.type&&(o.current===o.length-1?o.current=0:o.order++,o.id=o.order[o.current])},t.canTakeTurn=function(){return!0},dt.appendChild(B.domElement),b()}]),t}),define("events",[],function(){var t={},e={};return{on:function(o,a,n){if(e[o]){if(!n)return;try{a(e[o])}catch(r){console.error(r)}}t[o]||(t[o]=[]),t[o].push(a)},off:function(e,o){var a;if(t[e]&&t[e].length)for(a=t[e].length-1;a>=0;a--)t[e][a]===o&&t[e][a].splice(a,1)},trigger:function(o,a){var n,r,s;if(e[o]=a,t[o]&&t[o].length)for(n=0,r=t[o].length;r>n;n++)if(s=t[o][n])try{s(a)}catch(i){console.error(i)}return!0}}}),require(["app","events"],function(t,e){var o=new Promise(function(t,e){gapi.hangout.onApiReady.add(function(e){e.isApiReady&&t()})});document.body.style.opacity=0,o.then(function(){angular.bootstrap(document,["app"]),new TWEEN.Tween(document.body.style).to({opacity:1},1e3).easing(TWEEN.Easing.Exponential.Out).start()})}),define("main",function(){});