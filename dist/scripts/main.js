define("app",[],function(){var e,t=function(e){var t,r={};for(t in e)if(e.hasOwnProperty(t))try{r[t]=JSON.parse(e[t])}catch(a){}return r},r=function(e){var t,r={};for(t in e)if(e.hasOwnProperty(t))try{r[t]=JSON.stringify(e[t])}catch(a){}return r},a={LOBBY:1,CHOOSE_COLOR:2,PLAY:3,DETERMINE_WINNER:4,CONGRATULATIONS:5};return e=angular.module("app",[]),e.run(["$rootScope",function(e){e.me=gapi.hangout.getLocalParticipant(),e.state=t(gapi.hangout.data.getState())||{},e.state.game||(e.state.game={}),e.state.game.currentStage||(e.state.game.currentStage=a.LOBBY),e.state.players||(e.state.players=[]),e.state.colors||(e.state.colors={}),gapi.hangout.data.onStateChanged.add(function(r){var a,n,i,o;a=t(r.state);for(n in a)i=a[n],o=r.metadata[n];e.state=a,window.state=a,e.$apply()}),e.$watch("state",function(t,a,n){gapi.hangout.data.submitDelta(r(e.state)),window.state=e.state},!0),e.computers=0,e.addPlayer=function(t){var r,a;if(a=e.state.players,t.player&&t.player.id&&a.length<4&&!e.findPlayerById(t.player.id)){if(r={},!t.player.type)throw new Error("config.player.type was not provided");if(r.type=t.player.type,"human"===r.type){if(!t.player.id)throw new Error("config.player.id was not provided");if(r.id=t.player.id,!t.player.name)throw new Error("config.player.name was not provided");r.name=t.player.name,t.player.image&&(r.image=t.player.image)}else{if("computer"!==r.type)throw new Error('config.player.type is not a supported type (either "human", or "computer")');r.id="computer-"+Math.floor(1e4*Math.random()),r.name="Computer "+e.computers+1}return a.push(r),e.state.host||"human"!==r.type||(e.state.host=r),!0}return!1},e.findPlayerById=function(t){var r,a,n,i;for(i=e.state.players,r=0,a=i.length;a>r;r++)if(n=i[r],n.id===t)return n;return null},e.removePlayer=function(t){var r,a,n;if(n=e.state.players,!t.player)return!1;for(r=n.length-1;r>=0;r--)if(n[r]===t.player)return a=n.splice(r,1),!0;return!1},e.showLeaveModal=!1,e.leave=function(){var t,r,a,n,i=!1;if(n=e.state.players,e.state.host&&e.state.host.id===e.me.person.id&&(i=!0),i)for(e.state.host=null,t=0,r=n.length;r>t;t++)if(a=n[t],e.me.person.id!==a.id&&"human"===a.type){e.state.host=a;break}e.removePlayer({player:e.findPlayerById(e.me.person.id)})},gapi.hangout.onParticipantsDisabled.add(function(t){var r,a,n,i,o,s,l=!1,p=!1;if(s=e.state.players,e.state.host)for(r=0,a=t.disabledParticipants.length;a>r;r++)if(i=t.disabledParticipants[r],i.person.id===e.state.host.id){l=!0;break}if(l)for(r=0,a=s.length;a>r;r++)if(o=s[r],e.me.person.id===o.id&&"human"===o.type&&e.state.host.id!==o.id){e.state.host=o;break}if(e.state.host&&e.state.host.id===e.me.person.id&&(p=!0),p)for(r=0,a=t.disabledParticipants.length;a>r;r++)for(i=t.disabledParticipants[r],n=s.length-1;n>=0;n--)if(o=s[n],i.person.id===o.id){e.removePlayer({player:o});break}e.$apply()}),e.join=function(){e.addPlayer({player:{type:"human",id:e.me.person.id,name:e.me.person.displayName,image:e.me.person.image.url}})},e.begin=function(){e.state.game.currentStage=a.CHOOSE_COLOR},e.isPlayer=function(){var t,r,a,n;for(r=e.state.players,a=0,n=r.length;n>a;a++)if(t=r[a],e.me.person.id===t.id)return!0;return!1},e.chooseColor=function(t){var r,a,n,i,o,s,l,p={blue:"Blue",red:"Red",green:"Green",yellow:"Yellow"};if(a=e.state.colors,r=e.state.players,e.myRemainingColors()&&!a[t]&&(a[t]={type:1,id:e.me.person.id,label:p[t]}),3===r.length&&3===Object.keys(a).length){for(t in p)if(!a[t])break;for(o=[],s=0,l=r.length;l>s;s++){i=r[s];do n=Math.floor(3*Math.random());while(o[n]);o[n]=i.id}a[t]={type:2,id:o[0],order:o,current:0,label:p[t]}}},e.myRemainingColors=function(){var t,r,a,n,i=0;if(a=e.state.colors,n=e.state.players,e.isPlayer()){2===n.length?i=2:(3===n.length||4===n.length)&&(i=1);for(r in a)t=a[r],1===t.type&&e.me.person.id===t.id&&i--}return i},e.getMyColors=function(){var t,r,a,n=[];a=e.state.colors;for(r in a)t=a[r],1===t.type&&e.me.person.id===t.id&&n.push(t);return n},e.getSharedColor=function(){var t,r,a,n;if(n=e.state.players,3===n.length){a=e.state.colors;for(r in a)if(t=a[r],2===t.type)return t}return null},e.displayColors=function(){var t="",r=e.getMyColors(!0);return r[0]&&r[0].label&&(t=r[0].label,r[1]&&r[1].label&&(t+=" and "+r[1].label)),t},e.displayChoosenColors=function(){return Object.keys(e.state.colors)},e.displaySharedColor=function(){var t=e.getSharedColor();return t&&t.label?t.label:!1},e.start=function(){e.state.game.currentStage=a.PLAY,e.play(),e.init()},e.play=function(){e.state.board=[]},e.init=function(){var e,t,r,a=document.getElementById("canvas-container");e=new THREE.Scene,t=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4),t.position.z=1e3,window.addEventListener("resize",function(){t.aspect=a.innerWidth/a.innerHeight,t.updateProjectionMatrix(),r.setSize(a.innerWidth,a.innerHeight)},!1)}}]),e}),define("events",[],function(){var e={},t={};return{on:function(r,a,n){if(t[r]){if(!n)return;try{a(t[r])}catch(i){console.error(i)}}e[r]||(e[r]=[]),e[r].push(a)},off:function(t,r){var a;if(e[t]&&e[t].length)for(a=e[t].length-1;a>=0;a--)e[t][a]===r&&e[t][a].splice(a,1)},trigger:function(r,a){var n,i,o;if(t[r]=a,e[r]&&e[r].length)for(n=0,i=e[r].length;i>n;n++)if(o=e[r][n])try{o(a)}catch(s){console.error(s)}return!0}}}),require(["app","events"],function(e,t){var r=new Promise(function(e,t){gapi.hangout.onApiReady.add(function(t){t.isApiReady&&e()})});r.then(function(){angular.bootstrap(document,["app"])})}),define("main",function(){});