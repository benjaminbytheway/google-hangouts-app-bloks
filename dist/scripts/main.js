define("app",[],function(){var t,o=function(t){var o,e={};for(o in t)if(t.hasOwnProperty(o))try{e[o]=JSON.parse(t[o])}catch(a){}return e},e=function(t){var o,e={};for(o in t)if(t.hasOwnProperty(o))try{e[o]=JSON.stringify(t[o])}catch(a){}return e},a={LOBBY:1,CHOOSE_COLOR:2,PLAY:3,DETERMINE_WINNER:4,CONGRATULATIONS:5};return t=angular.module("app",[]),t.run(["$rootScope",function(t){function n(t){var o,e,a=t.length,n=t[0].length,r=0,i=0,s=[];for(e=0;n>e;e++){for(o=a-1;o>=0;o--)s[r]||(s[r]=[]),s[r][i]=t[o][e],i++;r++,i=0}return s}function r(t){var o,e,a=t.length,n=t[0].length,r=0,i=0,s=[];for(e=n-1;e>=0;e--){for(o=0;a>o;o++)s[r]||(s[r]=[]),s[r][i]=t[o][e],i++;r++,i=0}return s}function i(t){var o,e,a=t.length,n=t[0].length,r=0,i=0,s=[];for(o=a-1;o>=0;o--){for(e=0;n>e;e++)s[r]||(s[r]=[]),s[r][i]=t[o][e],i++;r++,i=0}return s}function s(t){var o,e,a=t.length,n=t[0].length,r=0,i=0,s=[];for(o=0;a>o;o++){for(e=n-1;e>=0;e--)s[r]||(s[r]=[]),s[r][i]=t[o][e],i++;r++,i=0}return s}function l(t,o,e){var a,n,r,i,s=t.userData.layout,l=s.length,u=s[0].length,c=!0,d=!0,y=!1,p=!1;for(a=0,n=l;n>a;a++){for(r=0,i=u;i>r;r++){if(U[o+a]&&U[o+a][e+r]||(c=!1),U[o+a]&&U[o+a][e+r]&&U[o+a][e+r].userData.block&&s[a][r]){d=!1;break}o+a!==0&&o+a!==19||e+r!==0&&e+r!==19||!s[a]||!s[a][r]||(p=!0),U[o+a]&&U[o+a][e+r]&&s[a]&&s[a][r]&&(U[o+a-1]&&U[o+a-1][e+r-1]&&U[o+a-1][e+r-1].userData.block&&U[o+a-1][e+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a+1]&&U[o+a+1][e+r-1]&&U[o+a+1][e+r-1].userData.block&&U[o+a+1][e+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a-1]&&U[o+a-1][e+r+1]&&U[o+a-1][e+r+1].userData.block&&U[o+a-1][e+r+1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a+1]&&U[o+a+1][e+r+1]&&U[o+a+1][e+r+1].userData.block&&U[o+a+1][e+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(p=!0),U[o+a]&&U[o+a][e+r]&&s[a]&&s[a][r]&&(U[o+a-1]&&U[o+a-1][e+r]&&U[o+a-1][e+r].userData.block&&U[o+a-1][e+r].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a+1]&&U[o+a+1][e+r]&&U[o+a+1][e+r].userData.block&&U[o+a+1][e+r].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a]&&U[o+a][e+r-1]&&U[o+a][e+r-1].userData.block&&U[o+a][e+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a]&&U[o+a][e+r+1]&&U[o+a][e+r+1].userData.block&&U[o+a][e+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(y=!0)}if(!c||!d||y)break}return c&&d&&!y&&p}function u(t){var o,e,a;for(o=0,e=ut.length;e>o;o++)if(a=ut[o],a.userData.id===t)return a;return!1}function c(t){var o,e,a,n;t.preventDefault(),C.x=t.clientX/dt*2-1,C.y=2*-(t.clientY/yt)+1,ot=null,et=null,z.setFromCamera(C,w),Q&&tt?z.ray.intersectPlane(v,B)&&(tt.position.copy(B.sub(k)),a=tt.userData.layout.length,n=tt.userData.layout[0].length,ot=Math.floor((B.x+gt*pt/2-a*pt/2+pt/2)/pt),et=Math.floor((B.z+ht*Et/2-n*Et/2+Et/2)/Et),h.remove(X),U[ot]&&U[ot][et]&&(Z=U[ot][et],l(tt,ot,et)&&(X=tt.clone(),X.position.copy(Z.position),X.position.x=X.position.x+a*pt/2-pt/2,X.position.z=X.position.z+n*Et/2-Et/2,X.position.y=X.position.y+ft/2,h.add(X)))):(e=z.intersectObjects(ut,!0),e.length>0?(o=e[0],K=o.object.parent?o.object.parent:o.object,st.style.cursor="move"):(K=null,st.style.cursor="auto"))}function d(t){var o,e;t.preventDefault(),z.setFromCamera(C,w),e=z.intersectObjects(ut,!0),e.length>0&&(o=e[0],H.enabled=!1,Q=o.object,o.object.parent&&(tt=o.object.parent),z.ray.intersectPlane(v,B)&&k.copy(B).sub(tt.position)),st.style.cursor="move"}function y(o){var e,a,n,r,i,s;if(o.preventDefault(),H.enabled=!0,Q&&tt){if(l(tt,ot,et)){for(Z=U[ot][et],e=0,a=tt.userData.layout.length;a>e;e++)for(J=0,F=tt.userData.layout[e].length;F>J;J++)tt.userData.layout[e][J]&&(U[ot+e][et+J].userData.block=tt);n=tt.userData.layout.length,r=tt.userData.layout[0].length,j=new TWEEN.Tween(tt.position).to({x:Z.position.x+n*pt/2-pt/2,z:Z.position.z+r*Et/2-Et/2,y:Z.position.y+ft/2},200).easing(TWEEN.Easing.Bounce.Out).onComplete(function(){j=null,t.syncBlock(t.getBlockById(tt.id),tt,!1)}).start(),ut.splice(ut.indexOf(tt),1),Q=null,tt=null,h.remove(X)}else tt.position.x>tt.lowerBoundary.x&&tt.position.x<tt.upperBoundary.x&&tt.position.z>tt.lowerBoundary.z&&tt.position.z<tt.upperBoundary.z&&(tt.startPosition.x=tt.position.x,tt.startPosition.z=tt.position.z,tt.startRotation=tt.rotation),i=tt.startPosition,s=tt.startRotation,j=new TWEEN.Tween(tt.position).to({x:i.x,z:i.z,y:i.y},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null,t.syncBlock(t.getBlockById(tt.id),tt,!1)}).start(),new TWEEN.Tween(tt.rotation).to({y:s.y,z:s.z},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){j=null}).start();t.syncBlock(t.getBlockById(tt.id),tt,!1)}K&&(Q=null,tt=null)}function p(o){var e,a,l;o.preventDefault(),tt&&!W&&(l=tt,37===o.keyCode||65===o.keyCode?(l.isRotated=!l.isRotated,l.userData.layout=n(l.userData.layout),a=l.rotation.y,W=new TWEEN.Tween(l.rotation).to({y:a+Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.id),l,!1)}).start()):38===o.keyCode||87===o.keyCode?(l.isRotated?l.userData.layout=s(l.userData.layout):l.userData.layout=i(l.userData.layout),e=l.rotation.z,W=new TWEEN.Tween(l.rotation).to({z:e+Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.id),l,!1)}).start()):39===o.keyCode||83===o.keyCode?(l.isRotated=!l.isRotated,l.userData.layout=r(l.userData.layout),a=l.rotation.y,W=new TWEEN.Tween(l.rotation).to({y:a-Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.id),l,!1)}).start()):(40===o.keyCode||68===o.keyCode)&&(l.isRotated?l.userData.layout=s(l.userData.layout):l.userData.layout=i(l.userData.layout),e=l.rotation.z,W=new TWEEN.Tween(l.rotation).to({z:e-Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.id),l,!1)}).start()))}function E(){H.update(),D.render(h,w)}function f(o){requestAnimationFrame(f),t&&t.state&&t.state.game&&t.state.game.currentStage&&t.state.game.currentStage===a.PLAY&&(TWEEN.update(o),E())}var g=!1;t.me=gapi.hangout.getLocalParticipant(),t.state=o(gapi.hangout.data.getState())||{},t.state.game||(t.state.game={}),t.state.game.currentStage||(t.state.game.currentStage=a.LOBBY),t.state.players||(t.state.players=[]),t.state.colors||(t.state.colors={}),gapi.hangout.data.onStateChanged.add(function(e){var a;a=o(e.state),g=!0,setTimeout(function(){g&&(g=!1)},0),t.state=a,a.board&&t.syncBoardWithState(),a.blocks&&t.syncBlocksWithState(),window.state=a,t.$apply()}),t.$watch("state",function(o,a,n){g?g=!1:gapi.hangout.data.submitDelta(e(t.state)),window.state=t.state},!0),t.computers=0,t.addPlayer=function(o){var e,a;if(a=t.state.players,o.player&&o.player.id&&a.length<4&&!t.findPlayerById(o.player.id)){if(e={},!o.player.type)throw new Error("config.player.type was not provided");if(e.type=o.player.type,"human"===e.type){if(!o.player.id)throw new Error("config.player.id was not provided");if(e.id=o.player.id,!o.player.name)throw new Error("config.player.name was not provided");e.name=o.player.name,o.player.image&&(e.image=o.player.image)}else{if("computer"!==e.type)throw new Error('config.player.type is not a supported type (either "human", or "computer")');e.id="computer-"+Math.floor(1e4*Math.random()),e.name="Computer "+t.computers+1}return a.push(e),t.state.host||"human"!==e.type||(t.state.host=e),!0}return!1},t.findPlayerById=function(o){var e,a,n,r;for(r=t.state.players,e=0,a=r.length;a>e;e++)if(n=r[e],n.id===o)return n;return null},t.removePlayer=function(o){var e,a,n;if(n=t.state.players,!o.player)return!1;for(e=n.length-1;e>=0;e--)if(n[e]===o.player)return a=n.splice(e,1),!0;return!1},t.showLeaveModal=!1,t.leave=function(){var o,e,a,n,r=!1;if(n=t.state.players,t.state.host&&t.state.host.id===t.me.person.id&&(r=!0),r)for(t.state.host=null,o=0,e=n.length;e>o;o++)if(a=n[o],t.me.person.id!==a.id&&"human"===a.type){t.state.host=a;break}t.removePlayer({player:t.findPlayerById(t.me.person.id)})},gapi.hangout.onParticipantsDisabled.add(function(o){var e,a,n,r,i,s,l=!1,u=!1;if(s=t.state.players,t.state.host)for(e=0,a=o.disabledParticipants.length;a>e;e++)if(r=o.disabledParticipants[e],r.person.id===t.state.host.id){l=!0;break}if(l)for(e=0,a=s.length;a>e;e++)if(i=s[e],t.me.person.id===i.id&&"human"===i.type&&t.state.host.id!==i.id){t.state.host=i;break}if(t.state.host&&t.state.host.id===t.me.person.id&&(u=!0),u)for(e=0,a=o.disabledParticipants.length;a>e;e++)for(r=o.disabledParticipants[e],n=s.length-1;n>=0;n--)if(i=s[n],r.person.id===i.id){t.removePlayer({player:i});break}t.$apply()}),t.join=function(){t.addPlayer({player:{type:"human",id:t.me.person.id,name:t.me.person.displayName,image:t.me.person.image.url}})},t.begin=function(){t.state.game.currentStage=a.CHOOSE_COLOR},t.isPlayer=function(){var o,e,a,n;for(e=t.state.players,a=0,n=e.length;n>a;a++)if(o=e[a],t.me.person.id===o.id)return!0;return!1},t.chooseColor=function(o){var e,a,n,r,i,s,l,u={blue:"Blue",red:"Red",green:"Green",yellow:"Yellow"},c={blue:255,green:65280,yellow:16776960,red:16711680};if(a=t.state.colors,e=t.state.players,t.myRemainingColors()&&!a[o]&&(a[o]={color:o,type:1,id:t.me.person.id,label:u[o],hex:c[o]}),3===e.length&&3===Object.keys(a).length){for(o in u)if(!a[o])break;for(i=[],s=0,l=e.length;l>s;s++){r=e[s];do n=Math.floor(3*Math.random());while(i[n]);i[n]=r.id}a[o]={color:o,type:2,id:i[0],order:i,current:0,label:u[o],hex:c[o]}}},t.myRemainingColors=function(){var o,e,a,n,r=0;if(a=t.state.colors,n=t.state.players,t.isPlayer()){2===n.length?r=2:(3===n.length||4===n.length)&&(r=1);for(e in a)o=a[e],1===o.type&&t.me.person.id===o.id&&r--}return r},t.getMyColors=function(){var o,e,a,n=[];a=t.state.colors;for(e in a)o=a[e],1===o.type&&t.me.person.id===o.id&&n.push(o);return n},t.getSharedColor=function(){var o,e,a,n;if(n=t.state.players,3===n.length){a=t.state.colors;for(e in a)if(o=a[e],2===o.type)return o}return null},t.displayColors=function(){var o="",e=t.getMyColors(!0);return e[0]&&e[0].label&&(o=e[0].label,e[1]&&e[1].label&&(o+=" and "+e[1].label)),o},t.displayChoosenColors=function(){return Object.keys(t.state.colors)},t.displaySharedColor=function(){var o=t.getSharedColor();return o&&o.label?o.label:!1},t.start=function(){t.state.game.currentStage=a.PLAY},t.state.board?setTimeout(function(){t.syncBoardWithState()},100):t.state.board=[],t.state.blocks?setTimeout(function(){t.syncBlocksWithState()},100):t.state.blocks=[];var h,w,m,P,R,D,x,T,b,z,v,k,B,C,H,S,V,A,I,O,M,q,L,N,W,j,Y,G,J,F,$,_,U,X,Z,K,Q,tt,ot,et,at,nt,rt=window,it=document,st=it.getElementById("canvas-container"),lt=new THREE.JSONLoader,ut=[],ct=[{id:21,startPosition:new THREE.Vector3(2.2,.1,1.5),squareCount:5,layout:[[1,1,1,1,1]]},{id:20,startPosition:new THREE.Vector3(2.6,.1,1.5),squareCount:5,layout:[[1,1,1,1],[1,0,0,0]]},{id:19,startPosition:new THREE.Vector3(3.1,.1,1.5),squareCount:5,layout:[[1,1,1,1],[0,1,0,0]]},{id:18,startPosition:new THREE.Vector3(3.6,.1,1.5),squareCount:5,layout:[[0,1,1,1],[1,1,0,0]]},{id:17,startPosition:new THREE.Vector3(2.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,0],[1,0,0]]},{id:16,startPosition:new THREE.Vector3(3.1,.1,.6),squareCount:5,layout:[[0,1,1],[1,1,0],[1,0,0]]},{id:15,startPosition:new THREE.Vector3(3.8,.1,.6),squareCount:5,layout:[[0,1,1],[0,1,0],[1,1,0]]},{id:14,startPosition:new THREE.Vector3(2.4,.1,-.1),squareCount:5,layout:[[1,1,1],[0,1,0],[0,1,0]]},{id:13,startPosition:new THREE.Vector3(3.1,.1,-.1),squareCount:5,layout:[[0,1,1],[1,1,0],[0,1,0]]},{id:12,startPosition:new THREE.Vector3(3.8,.1,-.1),squareCount:5,layout:[[0,1,0],[1,1,1],[0,1,0]]},{id:11,startPosition:new THREE.Vector3(4.1,.1,1.5),squareCount:5,layout:[[1,1,1],[1,1,0]]},{id:10,startPosition:new THREE.Vector3(4.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,1]]},{id:9,startPosition:new THREE.Vector3(2.2,.1,-.9),squareCount:4,layout:[[1,1,1,1]]},{id:8,startPosition:new THREE.Vector3(2.6,.1,-.9),squareCount:4,layout:[[1,1,1],[1,0,0]]},{id:7,startPosition:new THREE.Vector3(3.1,.1,-.9),squareCount:4,layout:[[1,1,1],[0,1,0]]},{id:6,startPosition:new THREE.Vector3(3.6,.1,-.9),squareCount:4,layout:[[1,1,0],[0,1,1]]},{id:5,startPosition:new THREE.Vector3(4.1,.1,-.9),squareCount:4,layout:[[1,1],[1,1]]},{id:4,startPosition:new THREE.Vector3(2.2,.1,-1.7),squareCount:3,layout:[[1,1,1]]},{id:3,startPosition:new THREE.Vector3(2.6,.1,-1.7),squareCount:3,layout:[[1,1],[1,0]]},{id:2,startPosition:new THREE.Vector3(3,.1,-1.7),squareCount:2,layout:[[1,1]]},{id:1,startPosition:new THREE.Vector3(3.3,.1,-1.7),squareCount:1,layout:[[1]]}],dt=st.offsetWidth,yt=st.offsetHeight,pt=.2,Et=.2,ft=.04,gt=20,ht=20,wt=.6;for(t.getBlockById=function(o){var e,a,n,r;for(r=t.state.blocks,e=0,a=r.length;a>e;e++)if(n=r[e],n.id===o)return n;return!1},t.syncBoardWithState=function(){var o,e,a,n,r,i;for(i=t.state.board,o=0,e=i.length;e>o;o++)for(a=0,n=i[o].length;n>a;a++)r=i[o][a],t.syncBoardSquare(U[o][a],r,!0)},t.syncBoardSquare=function(t,o,e){e?t.userData.block=u(o.b):t.b=o.userData.block.id},t.syncBlocksWithState=function(){var o,e,a,n;for(n=t.state.blocks,o=0,e=n.length;e>o;o++)a=n[o],t.syncBlock(u(a.id),a,!0)},t.syncBlock=function(t,o,e){e?(t.userData.layout=o.l,t.position.x=o.p.x,t.position.y=o.p.y,t.position.z=o.p.z,t.rotation.x=o.r.x,t.rotation.y=o.r.y,t.rotation.z=o.r.z,t.startPosition.x=o.sp.x,t.startPosition.y=o.sp.y,t.startPosition.z=o.sp.z,t.startRotation.x=o.sr.x,t.startRotation.y=o.sr.y,t.startRotation.z=o.sr.z,t.isRotated=o.ir):(t.l=o.userData.layout,t.p.x=o.position.x,t.p.y=o.position.y,t.p.z=o.position.z,t.r.x=o.rotation.x,t.r.y=o.rotation.y,t.r.z=o.rotation.z,t.sp.x=o.startPosition.x,t.sp.y=o.startPosition.y,t.sp.z=o.startPosition.z,t.sr.x=o.startRotation.x,t.sr.y=o.startRotation.y,t.sr.z=o.startRotation.z,t.ir=o.isRotated)},D=new THREE.WebGLRenderer,D.setSize(dt,yt),D.setClearColor(16777215),D.shadowMap.enabled=!0,h=new THREE.Scene,w=new THREE.PerspectiveCamera(45,dt/yt,.1,1e3),w.position.x=6,w.position.y=6,w.position.z=6,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0)),m=it.getElementById("view-1"),P=it.getElementById("view-2"),R=it.getElementById("view-3"),m.addEventListener("click",function(t){w.position.x=0,w.position.y=10,w.position.z=0,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),P.addEventListener("click",function(t){w.position.x=0,w.position.y=6,w.position.z=9,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),R.addEventListener("click",function(t){w.position.x=6,w.position.y=6,w.position.z=6,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),rt.addEventListener("resize",function(){dt=st.offsetWidth,yt=st.offsetHeight,w.aspect=dt/yt,w.updateProjectionMatrix(),D.setSize(dt,yt)},!1),H=new THREE.TrackballControls(w),H.rotateSpeed=1,H.zoomSpeed=1.2,H.panSpeed=.3,H.noZoom=!1,H.noPan=!1,H.noRotate=!1,H.staticMoving=!1,H.dynamicDampingFactor=.3,x=[],T=0,x[T]=new THREE.DirectionalLight(16777215,.25),x[T].position.x=-50,x[T].position.y=50,x[T].position.z=-50,x[T].castShadow=!0,h.add(x[T]),T=1,x[T]=new THREE.DirectionalLight(16777215,.25),x[T].position.x=50,x[T].position.y=50,x[T].position.z=50,x[T].castShadow=!0,h.add(x[T]),T=2,x[T]=new THREE.DirectionalLight(16777215,.25),x[T].position.x=-50,x[T].position.y=50,x[T].position.z=50,x[T].castShadow=!0,h.add(x[T]),T=3,x[T]=new THREE.DirectionalLight(16777215,.25),x[T].position.x=50,x[T].position.y=50,x[T].position.z=-50,x[T].castShadow=!0,h.add(x[T]),T=4,x[T]=new THREE.DirectionalLight(16777215,.25),x[T].position.x=0,x[T].position.y=-50,x[T].position.z=0,x[T].castShadow=!0,h.add(x[T]),b=new THREE.AmbientLight(5263440),h.add(b),U=[],V=lt.parse({metadata:{},scale:1,materials:[],vertices:[-.1,0,.1,-.1,.01,.1,-.1,0,-.1,-.1,.01,-.1,.1,0,.1,.1,.01,.1,.1,0,-.1,.1,.01,-.1,.0975,.01,.0975,-.0975,.01,.0975,.0975,.01,-.0975,-.0975,.01,-.0975,.095,0,.095,-.095,0,.095,.095,0,-.095,-.095,0,-.095],morphTargets:[],morphColors:[],normals:[-1,0,0,0,0,-1,1,0,0,0,0,1,0,-1,0,0,1,0,-.9701,.2425,0,0,.2425,.9701,0,.2425,-.9701,.9701,.2425,0],colors:[],uvs:[[]],faces:[35,1,3,2,0,0,0,0,0,0,35,3,7,6,2,0,1,1,1,1,35,7,5,4,6,0,2,2,2,2,35,5,1,0,4,0,3,3,3,3,35,0,2,6,4,0,4,4,4,4,35,9,11,3,1,0,5,5,5,5,35,5,8,9,1,0,5,5,5,5,35,5,7,10,8,0,5,5,5,5,35,8,10,14,12,0,6,6,6,6,35,10,7,3,11,0,5,5,5,5,35,12,14,15,13,0,5,5,5,5,35,10,11,15,14,0,7,7,7,7,35,9,8,12,13,0,8,8,8,8,35,11,9,13,15,0,9,9,9,9]}).geometry,Y=0,G=gt;G>Y;Y++)for(U[Y]=[],J=0,F=ht;F>J;J++)A=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),S=new THREE.Mesh(V,A),S.position.x=Y*pt-gt*pt/2+pt/2,S.position.z=J*Et-ht*Et/2+Et/2,S.castShadow=!0,S.receiveShadow=!1,S.userData.xIndex=Y,S.userData.zIndex=J,S.userData.block=null,S.userData.square=null,U[Y][J]=S,h.add(S),t.state.board[Y]||(t.state.board[Y]=[]),t.state.board[Y][J]||(t.state.board[Y][J]={b:null});I=new THREE.BoxGeometry(gt*pt,wt,ht*Et),O=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),M=new THREE.Mesh(I,O),M.position.y=-(wt/2)-1e-4,h.add(M);var mt,Pt,Rt,Dt,xt,Tt;for(at in t.state.colors)for(nt=t.state.colors[at],$=0,_=ct.length;_>$;$++){for(Pt=ct[$],mt=new THREE.Group,mt.userData.id=at+"-"+ct.id,mt.userData.layout=JSON.parse(JSON.stringify(Pt.layout)),mt.userData.squareCount=Pt.squareCount,mt.userData.colorAgent=nt,mt.userData.color=at,Rt=mt.userData.layout.length,Dt=mt.userData.layout[0].length,Y=0,G=Pt.layout.length;G>Y;Y++)for(xt=Pt.layout[Y],J=0,F=xt.length;F>J;J++)Tt=xt[J],Tt&&(L=lt.parse({metadata:{},scale:1,materials:[],vertices:[.1,.01,-.1,-.1,.01,.1,.1,.01,.1,-.1,.01,-.1,-.1,.03,.1,.1,.03,.1,-.1,.03,-.1,.1,.03,-.1,-.0925,.03,.0925,-.0925,.03,-.0925,.0925,.03,.0925,.0925,.03,-.0925,-.0925,.04,.0925,-.0925,.04,-.0925,.0925,.04,.0925,.0925,.04,-.0925,-.0925,.01,.0925,.0925,.01,.0925,-.0925,.01,-.0925,.0925,.01,-.0925,-.0925,0,.0925,.0925,0,.0925,-.0925,0,-.0925,.0925,0,-.0925,-.065,.04,.065,-.065,.04,-.065,.065,.04,.065,.065,.04,-.065,-.065,.03,.065,-.065,.03,-.065,.065,.03,.065,.065,.03,-.065,-.065,0,.065,.065,0,.065,-.065,0,-.065,.065,0,-.065,-.065,.01,.065,.065,.01,.065,-.065,.01,-.065,.065,.01,-.065],morphTargets:[],morphColors:[],normals:[0,0,-1,0,0,1,1,0,0,-1,0,0,0,1,0,0,-1,0],colors:[],uvs:[[]],faces:[35,0,3,6,7,0,0,0,0,0,35,1,2,5,4,0,1,1,1,1,35,2,0,7,5,0,2,2,2,2,35,3,1,4,6,0,3,3,3,3,35,9,11,7,6,0,4,4,4,4,35,4,8,9,6,0,4,4,4,4,35,4,5,10,8,0,4,4,4,4,35,11,9,13,15,0,0,0,0,0,35,10,5,7,11,0,4,4,4,4,35,10,11,15,14,0,2,2,2,2,35,9,8,12,13,0,3,3,3,3,35,8,10,14,12,0,1,1,1,1,35,17,19,0,2,0,5,5,5,5,35,1,16,17,2,0,5,5,5,5,35,1,3,18,16,0,5,5,5,5,35,17,16,20,21,0,1,1,1,1,35,18,3,0,19,0,5,5,5,5,35,16,18,22,20,0,3,3,3,3,35,19,17,21,23,0,2,2,2,2,35,18,19,23,22,0,0,0,0,0,35,25,27,15,13,0,4,4,4,4,35,12,24,25,13,0,4,4,4,4,35,12,14,26,24,0,4,4,4,4,35,24,26,30,28,0,0,0,0,0,35,26,14,15,27,0,4,4,4,4,35,28,30,31,29,0,4,4,4,4,35,26,27,31,30,0,3,3,3,3,35,27,25,29,31,0,1,1,1,1,35,25,24,28,29,0,2,2,2,2,35,33,35,23,21,0,5,5,5,5,35,20,32,33,21,0,5,5,5,5,35,20,22,34,32,0,5,5,5,5,35,33,32,36,37,0,0,0,0,0,35,34,22,23,35,0,5,5,5,5,35,36,38,39,37,0,5,5,5,5,35,32,34,38,36,0,2,2,2,2,35,34,35,39,38,0,1,1,1,1,35,35,33,37,39,0,3,3,3,3]}).geometry,N=new THREE.MeshPhongMaterial({color:mt.userData.colorAgent.hex,transparent:!0,opacity:.75,shininess:75,side:THREE.DoubleSide}),q=new THREE.Mesh(L,N),q.position.x=Y*pt-Rt*pt/2+pt/2,q.position.z=J*Et-Dt*Et/2+Et/2,q.position.y=-ft/2,q.userData.xIndex=Y,q.userData.zIndex=J,mt.add(q));mt.startPosition=new THREE.Vector3,mt.startRotation=new THREE.Vector3,mt.upperBoundary=new THREE.Vector3,mt.lowerBoundary=new THREE.Vector3,mt.isRotated=!1,"blue"===at?(mt.startPosition.x=Pt.startPosition.x,mt.startPosition.y=Pt.startPosition.y,mt.startPosition.z=Pt.startPosition.z,mt.upperBoundary.x=8,mt.lowerBoundary.x=2.2,mt.upperBoundary.z=2.4,mt.lowerBoundary.z=-2.4,mt.startRotation.y=0):"green"===at?(mt.startPosition.x=-Pt.startPosition.x,mt.startPosition.y=Pt.startPosition.y,mt.startPosition.z=-Pt.startPosition.z,mt.upperBoundary.x=-2.2,mt.lowerBoundary.x=-8,mt.upperBoundary.z=2.4,mt.lowerBoundary.z=-2.4,mt.startRotation.y=Math.PI,mt.userData.layout=n(n(mt.userData.layout))):"red"===at?(mt.startPosition.x=-Pt.startPosition.z,mt.startPosition.y=Pt.startPosition.y,mt.startPosition.z=Pt.startPosition.x,mt.upperBoundary.x=2.4,mt.lowerBoundary.x=-2.4,mt.upperBoundary.z=8,mt.lowerBoundary.z=2.2,mt.startRotation.y=Math.PI+Math.PI/2,mt.userData.layout=r(mt.userData.layout),mt.isRotated=!0):"yellow"===at&&(mt.startPosition.x=Pt.startPosition.z,mt.startPosition.y=Pt.startPosition.y,mt.startPosition.z=-Pt.startPosition.x,mt.upperBoundary.x=2.4,mt.lowerBoundary.x=-2.4,mt.upperBoundary.z=-2.2,mt.lowerBoundary.z=-8,mt.startRotation.y=Math.PI/2,mt.userData.layout=n(mt.userData.layout),mt.isRotated=!0),mt.position.x=mt.startPosition.x,mt.position.y=mt.startPosition.y,mt.position.z=mt.startPosition.z,mt.rotation.y=mt.startRotation.y,mt.castShadow=!0,mt.receiveShadow=!1,ut.push(mt),h.add(mt),t.getBlockById(mt.userData.id)?console.log("found it"):(console.log("didnt find it"),t.state.blocks.push({id:mt.userData.id,l:mt.userData.layout,sp:{x:mt.startPosition.x,y:mt.startPosition.y,z:mt.startPosition.z},sr:{x:mt.startRotation.x,y:mt.startRotation.y,z:mt.startRotation.z},p:{x:mt.position.x,y:mt.position.y,z:mt.position.z},r:{x:mt.rotation.x,y:mt.rotation.y,z:mt.rotation.z},ir:mt.isRotated}))}z=new THREE.Raycaster,C=new THREE.Vector2,v=new THREE.Plane(new THREE.Vector3(0,1,0)),k=new THREE.Vector3,B=new THREE.Vector3,D.domElement.addEventListener("mousemove",c,!1),D.domElement.addEventListener("mousedown",d,!1),D.domElement.addEventListener("mouseup",y,!1),document.addEventListener("keydown",p,!1),st.appendChild(D.domElement),f()}]),t}),define("events",[],function(){var t={},o={};return{on:function(e,a,n){if(o[e]){if(!n)return;try{a(o[e])}catch(r){console.error(r)}}t[e]||(t[e]=[]),t[e].push(a)},off:function(o,e){var a;if(t[o]&&t[o].length)for(a=t[o].length-1;a>=0;a--)t[o][a]===e&&t[o][a].splice(a,1)},trigger:function(e,a){var n,r,i;if(o[e]=a,t[e]&&t[e].length)for(n=0,r=t[e].length;r>n;n++)if(i=t[e][n])try{i(a)}catch(s){console.error(s)}return!0}}}),require(["app","events"],function(t,o){var e=new Promise(function(t,o){gapi.hangout.onApiReady.add(function(o){o.isApiReady&&t()})});e.then(function(){angular.bootstrap(document,["app"])})}),define("main",function(){});