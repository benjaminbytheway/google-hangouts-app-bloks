define("app",[],function(){var t,o=function(t){var o,e={};for(o in t)if(t.hasOwnProperty(o))try{e[o]=JSON.parse(t[o])}catch(a){}return e},e=function(t){try{return JSON.stringify(t)}catch(o){}return""},a={LOBBY:1,CHOOSE_COLOR:2,PLAY:3,DETERMINE_WINNER:4,CONGRATULATIONS:5};return t=angular.module("app",[]),t.run(["$rootScope",function(t){function n(t){var o,e,a=t.length,n=t[0].length,r=0,s=0,i=[];for(e=0;n>e;e++){for(o=a-1;o>=0;o--)i[r]||(i[r]=[]),i[r][s]=t[o][e],s++;r++,s=0}return i}function r(t){var o,e,a=t.length,n=t[0].length,r=0,s=0,i=[];for(e=n-1;e>=0;e--){for(o=0;a>o;o++)i[r]||(i[r]=[]),i[r][s]=t[o][e],s++;r++,s=0}return i}function s(t){var o,e,a=t.length,n=t[0].length,r=0,s=0,i=[];for(o=a-1;o>=0;o--){for(e=0;n>e;e++)i[r]||(i[r]=[]),i[r][s]=t[o][e],s++;r++,s=0}return i}function i(t){var o,e,a=t.length,n=t[0].length,r=0,s=0,i=[];for(o=0;a>o;o++){for(e=n-1;e>=0;e--)i[r]||(i[r]=[]),i[r][s]=t[o][e],s++;r++,s=0}return i}function l(t,o,e){var a,n,r,s,i=t.userData.layout,l=i.length,u=i[0].length,c=!0,d=!0,y=!1,p=!1;for(a=0,n=l;n>a;a++){for(r=0,s=u;s>r;r++){if(U[o+a]&&U[o+a][e+r]||(c=!1),U[o+a]&&U[o+a][e+r]&&U[o+a][e+r].userData.block&&i[a][r]){d=!1;break}o+a!==0&&o+a!==19||e+r!==0&&e+r!==19||!i[a]||!i[a][r]||(p=!0),U[o+a]&&U[o+a][e+r]&&i[a]&&i[a][r]&&(U[o+a-1]&&U[o+a-1][e+r-1]&&U[o+a-1][e+r-1].userData.block&&U[o+a-1][e+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a+1]&&U[o+a+1][e+r-1]&&U[o+a+1][e+r-1].userData.block&&U[o+a+1][e+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a-1]&&U[o+a-1][e+r+1]&&U[o+a-1][e+r+1].userData.block&&U[o+a-1][e+r+1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a+1]&&U[o+a+1][e+r+1]&&U[o+a+1][e+r+1].userData.block&&U[o+a+1][e+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(p=!0),U[o+a]&&U[o+a][e+r]&&i[a]&&i[a][r]&&(U[o+a-1]&&U[o+a-1][e+r]&&U[o+a-1][e+r].userData.block&&U[o+a-1][e+r].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a+1]&&U[o+a+1][e+r]&&U[o+a+1][e+r].userData.block&&U[o+a+1][e+r].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a]&&U[o+a][e+r-1]&&U[o+a][e+r-1].userData.block&&U[o+a][e+r-1].userData.block.userData.colorAgent===t.userData.colorAgent||U[o+a]&&U[o+a][e+r+1]&&U[o+a][e+r+1].userData.block&&U[o+a][e+r+1].userData.block.userData.colorAgent===t.userData.colorAgent)&&(y=!0)}if(!c||!d||y)break}return c&&d&&!y&&p}function u(t){var o,e,a;for(o=0,e=ut.length;e>o;o++)if(a=ut[o],a.userData.id===t)return a;return!1}function c(t){var o,e,a,n;t.preventDefault(),C.x=t.clientX/dt*2-1,C.y=2*-(t.clientY/yt)+1,ot=null,et=null,B.setFromCamera(C,w),Q&&tt?B.ray.intersectPlane(x,z)&&(tt.position.copy(z.sub(v)),a=tt.userData.layout.length,n=tt.userData.layout[0].length,ot=Math.floor((z.x+ft*pt/2-a*pt/2+pt/2)/pt),et=Math.floor((z.z+Et*ht/2-n*ht/2+ht/2)/ht),E.remove(X),U[ot]&&U[ot][et]&&(Z=U[ot][et],l(tt,ot,et)&&(X=tt.clone(),X.position.copy(Z.position),X.position.x=X.position.x+a*pt/2-pt/2,X.position.z=X.position.z+n*ht/2-ht/2,X.position.y=X.position.y+gt/2,E.add(X)))):(e=B.intersectObjects(ut,!0),e.length>0?(o=e[0],K=o.object.parent?o.object.parent:o.object,it.style.cursor="move"):(K=null,it.style.cursor="auto"))}function d(t){var o,e;t.preventDefault(),B.setFromCamera(C,w),e=B.intersectObjects(ut,!0),e.length>0&&(o=e[0],H.enabled=!1,Q=o.object,o.object.parent&&(tt=o.object.parent),B.ray.intersectPlane(x,z)&&v.copy(z).sub(tt.position)),it.style.cursor="move"}function y(o){var e,a,n,r,s,i;if(o.preventDefault(),H.enabled=!0,Q&&tt){if(l(tt,ot,et)){for(Z=U[ot][et],e=0,a=tt.userData.layout.length;a>e;e++)for(j=0,J=tt.userData.layout[e].length;J>j;j++)tt.userData.layout[e][j]&&(U[ot+e][et+j].userData.block=tt);n=tt.userData.layout.length,r=tt.userData.layout[0].length,Y=new TWEEN.Tween(tt.position).to({x:Z.position.x+n*pt/2-pt/2,z:Z.position.z+r*ht/2-ht/2,y:Z.position.y+gt/2},200).easing(TWEEN.Easing.Bounce.Out).onComplete(function(){Y=null,t.syncBlock(t.getBlockById(tt.userData.id),tt,!1)}).start(),ut.splice(ut.indexOf(tt),1),Q=null,tt=null,E.remove(X)}else tt.position.x>tt.lowerBoundary.x&&tt.position.x<tt.upperBoundary.x&&tt.position.z>tt.lowerBoundary.z&&tt.position.z<tt.upperBoundary.z&&(tt.startPosition.x=tt.position.x,tt.startPosition.z=tt.position.z,tt.startRotation=tt.rotation),s=tt.startPosition,i=tt.startRotation,Y=new TWEEN.Tween(tt.position).to({x:s.x,z:s.z,y:s.y},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){Y=null,t.syncBlock(t.getBlockById(tt.userData.id),tt,!1)}).start(),new TWEEN.Tween(tt.rotation).to({y:i.y,z:i.z},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){Y=null}).start();t.syncBlock(t.getBlockById(tt.userData.id),tt,!1)}K&&(Q=null,tt=null)}function p(o){var e,a,l;o.preventDefault(),tt&&!W&&(l=tt,37===o.keyCode||65===o.keyCode?(l.isRotated=!l.isRotated,l.userData.layout=n(l.userData.layout),a=l.rotation.y,W=new TWEEN.Tween(l.rotation).to({y:a+Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start()):38===o.keyCode||87===o.keyCode?(l.isRotated?l.userData.layout=i(l.userData.layout):l.userData.layout=s(l.userData.layout),e=l.rotation.z,W=new TWEEN.Tween(l.rotation).to({z:e+Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start()):39===o.keyCode||83===o.keyCode?(l.isRotated=!l.isRotated,l.userData.layout=r(l.userData.layout),a=l.rotation.y,W=new TWEEN.Tween(l.rotation).to({y:a-Math.PI/2},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start()):(40===o.keyCode||68===o.keyCode)&&(l.isRotated?l.userData.layout=i(l.userData.layout):l.userData.layout=s(l.userData.layout),e=l.rotation.z,W=new TWEEN.Tween(l.rotation).to({z:e-Math.PI},200).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){W=null,l=null,t.syncBlock(t.getBlockById(l.userData.id),l,!1)}).start()))}function h(){H.update(),k.render(E,w)}function g(o){requestAnimationFrame(g),t&&t.state&&t.state.game&&t.state.game.currentStage&&t.state.game.currentStage===a.PLAY&&(TWEEN.update(o),h())}var f=!1;t.me=gapi.hangout.getLocalParticipant(),t.state=o(gapi.hangout.data.getState())||{},t.state.game||(t.state.game={}),t.state.game.currentStage||(t.state.game.currentStage=a.LOBBY),t.state.players||(t.state.players=[]),gapi.hangout.data.onStateChanged.add(function(e){var a;a=o(e.state),f=!0,setTimeout(function(){f&&(f=!1)},0),t.state=a,a.board&&t.syncBoardWithState(),(a.blocksBlue||a.blocksGreen||a.blocksRed||a.blocksYellow)&&t.syncBlocksWithState(),window.state=a,t.$apply()}),t.$watch("state.game",function(o,a,n){f?f=!1:t.state&&t.state.game&&gapi.hangout.data.submitDelta({game:e(t.state.game)})},!0),t.$watch("state.players",function(o,a,n){f?f=!1:t.state&&t.state.players&&gapi.hangout.data.submitDelta({players:e(t.state.players)})},!0),t.$watch("state.host",function(o,a,n){f?f=!1:t.state&&t.state.host&&gapi.hangout.data.submitDelta({host:e(t.state.host)})},!0),t.$watch("state.colors",function(o,a,n){f?f=!1:t.state&&t.state.colors&&gapi.hangout.data.submitDelta({colors:e(t.state.colors)})},!0),t.$watch("state.board",function(o,a,n){f?f=!1:t.state&&t.state.board&&gapi.hangout.data.submitDelta({board:e(t.state.board)})},!0),t.$watch("state.blocksBlue",function(o,a,n){f?f=!1:t.state&&t.state.blocksBlue&&gapi.hangout.data.submitDelta({blocks:e(t.state.blocksBlue)})},!0),t.$watch("state.blocksGreen",function(o,a,n){f?f=!1:t.state&&t.state.blocksGreen&&gapi.hangout.data.submitDelta({blocks:e(t.state.blocksGreen)})},!0),t.$watch("state.blocksRed",function(o,a,n){f?f=!1:t.state&&t.state.blocksRed&&gapi.hangout.data.submitDelta({blocks:e(t.state.blocksRed)})},!0),t.$watch("state.blocksYellow",function(o,a,n){f?f=!1:t.state&&t.state.blocksYellow&&gapi.hangout.data.submitDelta({blocks:e(t.state.blocksYellow)})},!0),t.computers=0,t.addPlayer=function(o){var e,a;if(a=t.state.players,o.player&&o.player.id&&a.length<4&&!t.findPlayerById(o.player.id)){if(e={},!o.player.type)throw new Error("config.player.type was not provided");if(e.type=o.player.type,"human"===e.type){if(!o.player.id)throw new Error("config.player.id was not provided");if(e.id=o.player.id,!o.player.name)throw new Error("config.player.name was not provided");e.name=o.player.name,o.player.image&&(e.image=o.player.image)}else{if("computer"!==e.type)throw new Error('config.player.type is not a supported type (either "human", or "computer")');e.id="computer-"+Math.floor(1e4*Math.random()),e.name="Computer "+t.computers+1}return a.push(e),t.state.host||"human"!==e.type||(t.state.host=e),!0}return!1},t.findPlayerById=function(o){var e,a,n,r;for(r=t.state.players,e=0,a=r.length;a>e;e++)if(n=r[e],n.id===o)return n;return null},t.removePlayer=function(o){var e,a,n;if(n=t.state.players,!o.player)return!1;for(e=n.length-1;e>=0;e--)if(n[e]===o.player)return a=n.splice(e,1),!0;return!1},t.showLeaveModal=!1,t.leave=function(){var o,e,a,n,r=!1;if(n=t.state.players,t.state.host&&t.state.host.id===t.me.person.id&&(r=!0),r)for(t.state.host=null,o=0,e=n.length;e>o;o++)if(a=n[o],t.me.person.id!==a.id&&"human"===a.type){t.state.host=a;break}t.removePlayer({player:t.findPlayerById(t.me.person.id)})},gapi.hangout.onParticipantsDisabled.add(function(o){var e,a,n,r,s,i,l=!1,u=!1;if(i=t.state.players,t.state.host)for(e=0,a=o.disabledParticipants.length;a>e;e++)if(r=o.disabledParticipants[e],r.person.id===t.state.host.id){l=!0;break}if(l)for(e=0,a=i.length;a>e;e++)if(s=i[e],t.me.person.id===s.id&&"human"===s.type&&t.state.host.id!==s.id){t.state.host=s;break}if(t.state.host&&t.state.host.id===t.me.person.id&&(u=!0),u)for(e=0,a=o.disabledParticipants.length;a>e;e++)for(r=o.disabledParticipants[e],n=i.length-1;n>=0;n--)if(s=i[n],r.person.id===s.id){t.removePlayer({player:s});break}t.$apply()}),t.join=function(){t.addPlayer({player:{type:"human",id:t.me.person.id,name:t.me.person.displayName,image:t.me.person.image.url}})},t.begin=function(){t.state.game.currentStage=a.CHOOSE_COLOR},t.isPlayer=function(){var o,e,a,n;for(e=t.state.players,a=0,n=e.length;n>a;a++)if(o=e[a],t.me.person.id===o.id)return!0;return!1},t.state.colors||(t.state.colors={blue:{id:"b",color:"blue",label:"Blue",hex:255},green:{id:"g",color:"green",label:"Green",hex:65280},yellow:{id:"y",color:"yellow",label:"Yellow",hex:16776960},red:{id:"r",color:"red",label:"Red",hex:16711680}}),t.chooseColor=function(o){var e,a,n,r,s,i,l,u;if(n=t.state.colors,e=t.state.players,t.myRemainingColors()&&!n[o].id&&(a=n[o],a.type=1,a.id=t.me.person.id),3===e.length&&3===Object.keys(n).length){for(o in n)if(a=n[o],!a.id)break;for(i=[],l=0,u=e.length;u>l;l++){s=e[l];do r=Math.floor(3*Math.random());while(i[r]);i[r]=s.id}a.type=2,a.id=i[0],a.order=i,a.current=0}},t.myRemainingColors=function(){var o,e,a,n,r=0;if(a=t.state.colors,n=t.state.players,t.isPlayer()){2===n.length?r=2:(3===n.length||4===n.length)&&(r=1);for(e in a)o=a[e],1===o.type&&t.me.person.id===o.id&&r--}return r},t.getMyColors=function(){var o,e,a,n=[];a=t.state.colors;for(e in a)o=a[e],1===o.type&&t.me.person.id===o.id&&n.push(o);return n},t.getSharedColor=function(){var o,e,a,n;if(n=t.state.players,3===n.length){a=t.state.colors;for(e in a)if(o=a[e],2===o.type)return o}return null},t.displayColors=function(){var o="",e=t.getMyColors(!0);return e[0]&&e[0].label&&(o=e[0].label,e[1]&&e[1].label&&(o+=" and "+e[1].label)),o},t.displayChoosenColors=function(){var o,e,a,n=[];e=t.state.colors;for(o in e)a=e[o],a.id&&n.push(a.color);return n},t.displaySharedColor=function(){var o=t.getSharedColor();return o&&o.label?o.label:!1},t.start=function(){t.state.game.currentStage=a.PLAY},t.state.board?setTimeout(function(){t.syncBoardWithState()},100):t.state.board=[],t.state.blocksBlue?setTimeout(function(){t.syncBlocksWithState()},100):t.state.blocksBlue=[],t.state.blocksGreen||(t.state.blocksGreen=[]),t.state.blocksRed||(t.state.blocksRed=[]),t.state.blocksYellow||(t.state.blocksYellow=[]);var E,w,b,m,D,k,R,P,T,B,x,v,z,C,H,M,S,V,A,I,O,q,L,N,W,Y,G,$,j,J,F,_,U,X,Z,K,Q,tt,ot,et,at,nt,rt=window,st=document,it=st.getElementById("canvas-container"),lt=new THREE.JSONLoader,ut=[],ct=[{id:21,startPosition:new THREE.Vector3(2.2,.1,1.5),squareCount:5,layout:[[1,1,1,1,1]]},{id:20,startPosition:new THREE.Vector3(2.6,.1,1.5),squareCount:5,layout:[[1,1,1,1],[1,0,0,0]]},{id:19,startPosition:new THREE.Vector3(3.1,.1,1.5),squareCount:5,layout:[[1,1,1,1],[0,1,0,0]]},{id:18,startPosition:new THREE.Vector3(3.6,.1,1.5),squareCount:5,layout:[[0,1,1,1],[1,1,0,0]]},{id:17,startPosition:new THREE.Vector3(2.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,0],[1,0,0]]},{id:16,startPosition:new THREE.Vector3(3.1,.1,.6),squareCount:5,layout:[[0,1,1],[1,1,0],[1,0,0]]},{id:15,startPosition:new THREE.Vector3(3.8,.1,.6),squareCount:5,layout:[[0,1,1],[0,1,0],[1,1,0]]},{id:14,startPosition:new THREE.Vector3(2.4,.1,-.1),squareCount:5,layout:[[1,1,1],[0,1,0],[0,1,0]]},{id:13,startPosition:new THREE.Vector3(3.1,.1,-.1),squareCount:5,layout:[[0,1,1],[1,1,0],[0,1,0]]},{id:12,startPosition:new THREE.Vector3(3.8,.1,-.1),squareCount:5,layout:[[0,1,0],[1,1,1],[0,1,0]]},{id:11,startPosition:new THREE.Vector3(4.1,.1,1.5),squareCount:5,layout:[[1,1,1],[1,1,0]]},{id:10,startPosition:new THREE.Vector3(4.4,.1,.6),squareCount:5,layout:[[1,1,1],[1,0,1]]},{id:9,startPosition:new THREE.Vector3(2.2,.1,-.9),squareCount:4,layout:[[1,1,1,1]]},{id:8,startPosition:new THREE.Vector3(2.6,.1,-.9),squareCount:4,layout:[[1,1,1],[1,0,0]]},{id:7,startPosition:new THREE.Vector3(3.1,.1,-.9),squareCount:4,layout:[[1,1,1],[0,1,0]]},{id:6,startPosition:new THREE.Vector3(3.6,.1,-.9),squareCount:4,layout:[[1,1,0],[0,1,1]]},{id:5,startPosition:new THREE.Vector3(4.1,.1,-.9),squareCount:4,layout:[[1,1],[1,1]]},{id:4,startPosition:new THREE.Vector3(2.2,.1,-1.7),squareCount:3,layout:[[1,1,1]]},{id:3,startPosition:new THREE.Vector3(2.6,.1,-1.7),squareCount:3,layout:[[1,1],[1,0]]},{id:2,startPosition:new THREE.Vector3(3,.1,-1.7),squareCount:2,layout:[[1,1]]},{id:1,startPosition:new THREE.Vector3(3.3,.1,-1.7),squareCount:1,layout:[[1]]}],dt=it.offsetWidth,yt=it.offsetHeight,pt=.2,ht=.2,gt=.04,ft=20,Et=20,wt=.6;for(t.getBlockById=function(o){var e,a,n,r;for(r=t.state.blocksBlue,e=0,a=r.length;a>e;e++)if(n=r[e],n.id===o)return n;for(r=t.state.blocksGreen,e=0,a=r.length;a>e;e++)if(n=r[e],n.id===o)return n;for(r=t.state.blocksRed,e=0,a=r.length;a>e;e++)if(n=r[e],n.id===o)return n;for(r=t.state.blocksYellow,e=0,a=r.length;a>e;e++)if(n=r[e],n.id===o)return n;return!1},t.syncBoardWithState=function(){var o,e,a,n,r,s;for(s=t.state.board,o=0,e=s.length;e>o;o++)for(a=0,n=s[o].length;n>a;a++)r=s[o][a],t.syncBoardSquare(U[o][a],r,!0)},t.syncBoardSquare=function(t,o,e){e?t.userData.block=u(o.b):t.b=o.userData.block.id},t.syncBlocksWithState=function(){var o,e,a,n;for(n=t.state.blocksBlue,o=0,e=n.length;e>o;o++)a=n[o],t.syncBlock(u(a.id),a,!0);for(n=t.state.blocksGreen,o=0,e=n.length;e>o;o++)a=n[o],t.syncBlock(u(a.id),a,!0);for(n=t.state.blocksRed,o=0,e=n.length;e>o;o++)a=n[o],t.syncBlock(u(a.id),a,!0);for(n=t.state.blocksYellow,o=0,e=n.length;e>o;o++)a=n[o],t.syncBlock(u(a.id),a,!0)},t.syncBlock=function(t,o,e){e?(t.userData.layout=o.l,t.position.x=o.p[0],t.position.y=o.p[1],t.position.z=o.p[2],t.rotation.x=o.r[0],t.rotation.y=o.r[1],t.rotation.z=o.r[2],t.startPosition.x=o.sp[0],t.startPosition.y=o.sp[1],t.startPosition.z=o.sp[2],t.startRotation.x=o.sr[0],t.startRotation.y=o.sr[1],t.startRotation.z=o.sr[2],t.isRotated=o.ir):(t.l=o.userData.layout,t.p[0]=Math.round(1e3*o.position.x)/1e3,t.p[1]=Math.round(1e3*o.position.y)/1e3,t.p[2]=Math.round(1e3*o.position.z)/1e3,t.r[0]=Math.round(1e3*o.rotation.x)/1e3,t.r[1]=Math.round(1e3*o.rotation.y)/1e3,t.r[2]=Math.round(1e3*o.rotation.z)/1e3,t.sp[0]=Math.round(1e3*o.startPosition.x)/1e3,t.sp[1]=Math.round(1e3*o.startPosition.y)/1e3,t.sp[2]=Math.round(1e3*o.startPosition.z)/1e3,t.sr[0]=Math.round(1e3*o.startRotation.x)/1e3,t.sr[1]=Math.round(1e3*o.startRotation.y)/1e3,t.sr[2]=Math.round(1e3*o.startRotation.z)/1e3,t.ir=o.isRotated)},k=new THREE.WebGLRenderer,k.setSize(dt,yt),k.setClearColor(16777215),k.shadowMap.enabled=!0,E=new THREE.Scene,w=new THREE.PerspectiveCamera(45,dt/yt,.1,1e3),w.position.x=6,w.position.y=6,w.position.z=6,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0)),b=st.getElementById("view-1"),m=st.getElementById("view-2"),D=st.getElementById("view-3"),b.addEventListener("click",function(t){w.position.x=0,w.position.y=10,w.position.z=0,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),m.addEventListener("click",function(t){w.position.x=0,w.position.y=6,w.position.z=9,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),D.addEventListener("click",function(t){w.position.x=6,w.position.y=6,w.position.z=6,w.rotation.x=0,w.rotation.y=0,w.rotation.z=0,w.lookAt(new THREE.Vector3(0,0,0))}),rt.addEventListener("resize",function(){dt=it.offsetWidth,yt=it.offsetHeight,w.aspect=dt/yt,w.updateProjectionMatrix(),k.setSize(dt,yt)},!1),H=new THREE.TrackballControls(w),H.rotateSpeed=1,H.zoomSpeed=1.2,H.panSpeed=.3,H.noZoom=!1,H.noPan=!1,H.noRotate=!1,H.staticMoving=!1,H.dynamicDampingFactor=.3,R=[],P=0,R[P]=new THREE.DirectionalLight(16777215,.25),R[P].position.x=-50,R[P].position.y=50,R[P].position.z=-50,R[P].castShadow=!0,E.add(R[P]),P=1,R[P]=new THREE.DirectionalLight(16777215,.25),R[P].position.x=50,R[P].position.y=50,R[P].position.z=50,R[P].castShadow=!0,E.add(R[P]),P=2,R[P]=new THREE.DirectionalLight(16777215,.25),R[P].position.x=-50,R[P].position.y=50,R[P].position.z=50,R[P].castShadow=!0,E.add(R[P]),P=3,R[P]=new THREE.DirectionalLight(16777215,.25),R[P].position.x=50,R[P].position.y=50,R[P].position.z=-50,R[P].castShadow=!0,E.add(R[P]),P=4,R[P]=new THREE.DirectionalLight(16777215,.25),R[P].position.x=0,R[P].position.y=-50,R[P].position.z=0,R[P].castShadow=!0,E.add(R[P]),T=new THREE.AmbientLight(5263440),E.add(T),U=[],S=lt.parse({metadata:{},scale:1,materials:[],vertices:[-.1,0,.1,-.1,.01,.1,-.1,0,-.1,-.1,.01,-.1,.1,0,.1,.1,.01,.1,.1,0,-.1,.1,.01,-.1,.0975,.01,.0975,-.0975,.01,.0975,.0975,.01,-.0975,-.0975,.01,-.0975,.095,0,.095,-.095,0,.095,.095,0,-.095,-.095,0,-.095],morphTargets:[],morphColors:[],normals:[-1,0,0,0,0,-1,1,0,0,0,0,1,0,-1,0,0,1,0,-.9701,.2425,0,0,.2425,.9701,0,.2425,-.9701,.9701,.2425,0],colors:[],uvs:[[]],faces:[35,1,3,2,0,0,0,0,0,0,35,3,7,6,2,0,1,1,1,1,35,7,5,4,6,0,2,2,2,2,35,5,1,0,4,0,3,3,3,3,35,0,2,6,4,0,4,4,4,4,35,9,11,3,1,0,5,5,5,5,35,5,8,9,1,0,5,5,5,5,35,5,7,10,8,0,5,5,5,5,35,8,10,14,12,0,6,6,6,6,35,10,7,3,11,0,5,5,5,5,35,12,14,15,13,0,5,5,5,5,35,10,11,15,14,0,7,7,7,7,35,9,8,12,13,0,8,8,8,8,35,11,9,13,15,0,9,9,9,9]}).geometry,G=0,$=ft;$>G;G++)for(U[G]=[],j=0,J=Et;J>j;j++)V=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),M=new THREE.Mesh(S,V),M.position.x=G*pt-ft*pt/2+pt/2,M.position.z=j*ht-Et*ht/2+ht/2,M.castShadow=!0,M.receiveShadow=!1,M.userData.xIndex=G,M.userData.zIndex=j,M.userData.block=null,M.userData.square=null,U[G][j]=M,E.add(M),t.state.board[G]||(t.state.board[G]=[]),t.state.board[G][j]||(t.state.board[G][j]={b:0});A=new THREE.BoxGeometry(ft*pt,wt,Et*ht),I=new THREE.MeshPhongMaterial({color:16579836,shininess:50,side:THREE.DoubleSide}),O=new THREE.Mesh(A,I),O.position.y=-(wt/2)-1e-4,E.add(O);var bt,mt,Dt,kt,Rt,Pt,Tt;for(at in t.state.colors)for(nt=t.state.colors[at],F=0,_=ct.length;_>F;F++){for(mt=ct[F],bt=new THREE.Group,bt.userData.id=nt.id+"-"+mt.id,bt.userData.layout=JSON.parse(JSON.stringify(mt.layout)),bt.userData.squareCount=mt.squareCount,bt.userData.colorAgent=nt,bt.userData.color=at,Dt=bt.userData.layout.length,kt=bt.userData.layout[0].length,G=0,$=mt.layout.length;$>G;G++)for(Rt=mt.layout[G],j=0,J=Rt.length;J>j;j++)Pt=Rt[j],Pt&&(L=lt.parse({metadata:{},scale:1,materials:[],vertices:[.1,.01,-.1,-.1,.01,.1,.1,.01,.1,-.1,.01,-.1,-.1,.03,.1,.1,.03,.1,-.1,.03,-.1,.1,.03,-.1,-.0925,.03,.0925,-.0925,.03,-.0925,.0925,.03,.0925,.0925,.03,-.0925,-.0925,.04,.0925,-.0925,.04,-.0925,.0925,.04,.0925,.0925,.04,-.0925,-.0925,.01,.0925,.0925,.01,.0925,-.0925,.01,-.0925,.0925,.01,-.0925,-.0925,0,.0925,.0925,0,.0925,-.0925,0,-.0925,.0925,0,-.0925,-.065,.04,.065,-.065,.04,-.065,.065,.04,.065,.065,.04,-.065,-.065,.03,.065,-.065,.03,-.065,.065,.03,.065,.065,.03,-.065,-.065,0,.065,.065,0,.065,-.065,0,-.065,.065,0,-.065,-.065,.01,.065,.065,.01,.065,-.065,.01,-.065,.065,.01,-.065],morphTargets:[],morphColors:[],normals:[0,0,-1,0,0,1,1,0,0,-1,0,0,0,1,0,0,-1,0],colors:[],uvs:[[]],faces:[35,0,3,6,7,0,0,0,0,0,35,1,2,5,4,0,1,1,1,1,35,2,0,7,5,0,2,2,2,2,35,3,1,4,6,0,3,3,3,3,35,9,11,7,6,0,4,4,4,4,35,4,8,9,6,0,4,4,4,4,35,4,5,10,8,0,4,4,4,4,35,11,9,13,15,0,0,0,0,0,35,10,5,7,11,0,4,4,4,4,35,10,11,15,14,0,2,2,2,2,35,9,8,12,13,0,3,3,3,3,35,8,10,14,12,0,1,1,1,1,35,17,19,0,2,0,5,5,5,5,35,1,16,17,2,0,5,5,5,5,35,1,3,18,16,0,5,5,5,5,35,17,16,20,21,0,1,1,1,1,35,18,3,0,19,0,5,5,5,5,35,16,18,22,20,0,3,3,3,3,35,19,17,21,23,0,2,2,2,2,35,18,19,23,22,0,0,0,0,0,35,25,27,15,13,0,4,4,4,4,35,12,24,25,13,0,4,4,4,4,35,12,14,26,24,0,4,4,4,4,35,24,26,30,28,0,0,0,0,0,35,26,14,15,27,0,4,4,4,4,35,28,30,31,29,0,4,4,4,4,35,26,27,31,30,0,3,3,3,3,35,27,25,29,31,0,1,1,1,1,35,25,24,28,29,0,2,2,2,2,35,33,35,23,21,0,5,5,5,5,35,20,32,33,21,0,5,5,5,5,35,20,22,34,32,0,5,5,5,5,35,33,32,36,37,0,0,0,0,0,35,34,22,23,35,0,5,5,5,5,35,36,38,39,37,0,5,5,5,5,35,32,34,38,36,0,2,2,2,2,35,34,35,39,38,0,1,1,1,1,35,35,33,37,39,0,3,3,3,3]}).geometry,N=new THREE.MeshPhongMaterial({color:bt.userData.colorAgent.hex,transparent:!0,opacity:.75,shininess:75,side:THREE.DoubleSide}),q=new THREE.Mesh(L,N),q.position.x=G*pt-Dt*pt/2+pt/2,q.position.z=j*ht-kt*ht/2+ht/2,q.position.y=-gt/2,q.userData.xIndex=G,q.userData.zIndex=j,bt.add(q));bt.startPosition=new THREE.Vector3,bt.startRotation=new THREE.Vector3,bt.upperBoundary=new THREE.Vector3,bt.lowerBoundary=new THREE.Vector3,bt.isRotated=!1,"blue"===at?(bt.startPosition.x=mt.startPosition.x,bt.startPosition.y=mt.startPosition.y,bt.startPosition.z=mt.startPosition.z,bt.upperBoundary.x=8,bt.lowerBoundary.x=2.2,bt.upperBoundary.z=2.4,bt.lowerBoundary.z=-2.4,bt.startRotation.y=0):"green"===at?(bt.startPosition.x=-mt.startPosition.x,bt.startPosition.y=mt.startPosition.y,bt.startPosition.z=-mt.startPosition.z,bt.upperBoundary.x=-2.2,bt.lowerBoundary.x=-8,bt.upperBoundary.z=2.4,bt.lowerBoundary.z=-2.4,bt.startRotation.y=Math.PI,bt.userData.layout=n(n(bt.userData.layout))):"red"===at?(bt.startPosition.x=-mt.startPosition.z,bt.startPosition.y=mt.startPosition.y,bt.startPosition.z=mt.startPosition.x,bt.upperBoundary.x=2.4,bt.lowerBoundary.x=-2.4,bt.upperBoundary.z=8,bt.lowerBoundary.z=2.2,bt.startRotation.y=Math.PI+Math.PI/2,bt.userData.layout=r(bt.userData.layout),bt.isRotated=!0):"yellow"===at&&(bt.startPosition.x=mt.startPosition.z,bt.startPosition.y=mt.startPosition.y,bt.startPosition.z=-mt.startPosition.x,bt.upperBoundary.x=2.4,bt.lowerBoundary.x=-2.4,bt.upperBoundary.z=-2.2,bt.lowerBoundary.z=-8,bt.startRotation.y=Math.PI/2,bt.userData.layout=n(bt.userData.layout),bt.isRotated=!0),bt.position.x=bt.startPosition.x,bt.position.y=bt.startPosition.y,bt.position.z=bt.startPosition.z,bt.rotation.y=bt.startRotation.y,bt.castShadow=!0,bt.receiveShadow=!1,ut.push(bt),E.add(bt),window.blocks=ut,t.getBlockById(bt.userData.id)?console.log("found it"):(console.log("didnt find it"),"blue"===at?Tt=t.state.blocksBlue:"green"===at?Tt=t.state.blocksGreen:"red"===at?Tt=t.state.blocksRed:"yellow"===at&&(Tt=t.state.blocksYellow),Tt.push({id:bt.userData.id,l:bt.userData.layout,sp:[Math.round(1e3*bt.startPosition.x)/1e3,Math.round(1e3*bt.startPosition.y)/1e3,Math.round(1e3*bt.startPosition.z)/1e3],sr:[Math.round(1e3*bt.startRotation.x)/1e3,Math.round(1e3*bt.startRotation.y)/1e3,Math.round(1e3*bt.startRotation.z)/1e3],p:[Math.round(1e3*bt.position.x)/1e3,Math.round(1e3*bt.position.y)/1e3,Math.round(1e3*bt.position.z)/1e3],r:[Math.round(1e3*bt.rotation.x)/1e3,Math.round(1e3*bt.rotation.y)/1e3,Math.round(1e3*bt.rotation.z)/1e3],ir:bt.isRotated}))}B=new THREE.Raycaster,C=new THREE.Vector2,x=new THREE.Plane(new THREE.Vector3(0,1,0)),v=new THREE.Vector3,z=new THREE.Vector3,k.domElement.addEventListener("mousemove",c,!1),k.domElement.addEventListener("mousedown",d,!1),k.domElement.addEventListener("mouseup",y,!1),document.addEventListener("keydown",p,!1),it.appendChild(k.domElement),g()}]),t}),define("events",[],function(){var t={},o={};return{on:function(e,a,n){if(o[e]){if(!n)return;try{a(o[e])}catch(r){console.error(r)}}t[e]||(t[e]=[]),t[e].push(a)},off:function(o,e){var a;if(t[o]&&t[o].length)for(a=t[o].length-1;a>=0;a--)t[o][a]===e&&t[o][a].splice(a,1)},trigger:function(e,a){var n,r,s;if(o[e]=a,t[e]&&t[e].length)for(n=0,r=t[e].length;r>n;n++)if(s=t[e][n])try{s(a)}catch(i){console.error(i)}return!0}}}),require(["app","events"],function(t,o){var e=new Promise(function(t,o){gapi.hangout.onApiReady.add(function(o){o.isApiReady&&t()})});e.then(function(){angular.bootstrap(document,["app"])})}),define("main",function(){});