define("events",[],function(){var e={},t={};return{on:function(n,a,r){if(t[n]){if(!r)return;try{a(t[n])}catch(i){}}e[n]||(e[n]=[]),e[n].push(a)},off:function(t,n){var a;if(e[t]&&e[t].length)for(a=e[t].length-1;a>=0;a--)e[t][a]===n&&e[t][a].splice(a,1)},trigger:function(n,a){var r,i,o;if(t[n]=a,e[n]&&e[n].length)for(r=0,i=e[n].length;i>r;r++)if(o=e[n][r])try{o(a)}catch(g){}return!0}}}),define("player",["events"],function(){var e=function(e){var t=this;if(!e.type)throw new Error("config.type was not provided");if(t.type=e.type,"human"===t.type){if(!e.id)throw new Error("config.id was not provided");if(t.id=e.id,!e.name)throw new Error("config.name was not provided");t.name=e.name}else if("computer"!==t.type)throw new Error('config.type is not a supported type (either "human", or "computer")')},t=e.prototype;return t.takeTurn=function(){},e}),define("game",["player","events"],function(e,t){var n;return n={players:[],addPlayer:function(n){var a,r=this;return n.player&&r.players.length<4?(a=new e(n.player),r.setHost(a),r.players.push(a),n.supressEvent||t.trigger("game.addPlayer",{game:r}),!0):!1},removePlayer:function(e){var t,n=this;for(t=n.players.length-1;t>=0;t--)if(n.players[t]===e)return n.players.splice(t,1),!0;return!1},reconcilePlayers:function(e){var t,n,a,r,i,o,g,u=this;for(t=0,n=e.length;n>t;t++){for(g=!1,i=e[t],a=0,r=u.players.length;r>a;a++)o=u.players[a],i.id===o.id&&(g=!0);g||u.addPlayer({player:i,supressEvent:!0})}},host:null,setHost:function(e){var t=this;return 0===t.players.length&&"human"===e.type?(t.host=e,!0):!1},STAGES:{LOBBY:1,LOADING:2,PLAY:3,DETERMINE_WINNER:4,CONGRATULATIONS:5},currentStage:0,startStage:function(e){var n=this;n.currentStage=e,n.currentStage===n.STAGES.LOBBY||n.currentStage===n.STAGES.LOADING,t.trigger("game.startStage",{game:n})},start:function(e){var t=this;e.currentStage===t.STAGES.LOBBY||e.currentStage===t.STAGES.LOADING}}}),define("ui",["events"],function(e){var t=document,n=t.getElementById("buttonJoin");return n.addEventListener("click",function(){e.trigger("ui.1.button.join.click")}),e.on("ui.1.game.players.changed",function(e){var n,a,r,i;for(n=0,a=e.players.length;a>n;n++)r=e.players[n],i=t.getElementById("player"+n),i.text=r.name}),{}}),require(["game","player","events","ui"],function(e,t,n,a){var r,i,o=new Promise(function(e,t){gapi.hangout.onApiReady.add(function(t){t.isApiReady&&e()})}),g=function(e){var t;for(t in e)if(e.hasOwnProperty(t))try{e[t]=JSON.parse(e[t])}catch(n){}return e},u=function(e){var t;for(t in e)if(e.hasOwnProperty(t))try{e[t]=JSON.stringify(e[t])}catch(n){}return e},s=function(){r.writerId=i.id,gapi.hangout.data.submitDelta(u(r))};o.then(function(){i=gapi.hangout.getLocalParticipant(),r=g(gapi.hangout.data.getState()),r.game?n.trigger("game.initalize",{game:r.game}):(n.trigger("game.initalize",{game:{currentStage:e.STAGES.LOBBY}}),gapi.hangout.data.submitDelta(u(r)))}).then(function(){n.on("game.initalize",function(t){e.initalize(t)},!0),gapi.hangout.data.onStateChanged.add(function(t){var a=g(t.state);a.writerId!==i.id&&"game.addPlayer"===t.state.eventName&&(e.reconcilePlayers(a.game.players),n.trigger("ui.1.game.players.changed",{players:e.players}))}),gapi.hangout.onParticipantsDisabled.add(function(e){var t,n;for(t=0,n=e.enabledParticipants.length;n>t;t++);}),n.on("game.addPlayer",function(e){r.game.players=e.game.players,r.eventName="game.addPlayer",s()}),n.on("game.startStage",function(e){r.game.stage=e.game.stage,r.eventName="game.startStage",s()}),n.on("ui.1.button.join.click",function(){e.addPlayer({player:{type:"human",id:i.id,name:i.person.displayName}})})})}),define("main",function(){});